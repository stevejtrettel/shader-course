<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>2&nbsp; Day 2: Dynamics – GPU-Accelerated Mathematical Illustration</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../lectures/day3.html" rel="next">
<link href="../lectures/day1.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e62aa0a8c28b52a0e19b1cebeabd7fd3.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-f0463eacbf7faa50df92658b97a72515.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e62aa0a8c28b52a0e19b1cebeabd7fd3.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-8dac8edbcb53bfd9d06979fcd2049297.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-12e35c1957ac53844ba804103a0e9c05.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-8dac8edbcb53bfd9d06979fcd2049297.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../lectures/day2.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Day 2: Dynamics</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">GPU-Accelerated Mathematical Illustration</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/stevejtrettel/shader-course" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="../GPU-Accelerated-Mathematical-Illustration.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/day1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Day 1: Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/day2.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Day 2: Dynamics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/day3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Day 3: Tilings</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/shaders/day1-shaders.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Appendix: Day 1 Shader Code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/shaders/day2-shaders.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Appendix: Day 2 Shader Code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/shaders/day3-shaders.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Day 3: Complete Shader Code</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><span class="header-section-number">2.1</span> Overview</a></li>
  <li><a href="#complex-numbers-in-glsl" id="toc-complex-numbers-in-glsl" class="nav-link" data-scroll-target="#complex-numbers-in-glsl"><span class="header-section-number">2.2</span> Complex Numbers in GLSL</a>
  <ul class="collapse">
  <li><a href="#representation" id="toc-representation" class="nav-link" data-scroll-target="#representation">Representation</a></li>
  <li><a href="#arithmetic" id="toc-arithmetic" class="nav-link" data-scroll-target="#arithmetic">Arithmetic</a></li>
  <li><a href="#magnitude" id="toc-magnitude" class="nav-link" data-scroll-target="#magnitude">Magnitude</a></li>
  </ul></li>
  <li><a href="#the-mandelbrot-set" id="toc-the-mandelbrot-set" class="nav-link" data-scroll-target="#the-mandelbrot-set"><span class="header-section-number">2.3</span> The Mandelbrot Set</a>
  <ul class="collapse">
  <li><a href="#definition" id="toc-definition" class="nav-link" data-scroll-target="#definition">Definition</a></li>
  <li><a href="#rendering-strategy" id="toc-rendering-strategy" class="nav-link" data-scroll-target="#rendering-strategy">Rendering Strategy</a></li>
  <li><a href="#the-escape-radius" id="toc-the-escape-radius" class="nav-link" data-scroll-target="#the-escape-radius">The Escape Radius</a></li>
  <li><a href="#the-escape-time-algorithm" id="toc-the-escape-time-algorithm" class="nav-link" data-scroll-target="#the-escape-time-algorithm">The Escape-Time Algorithm</a></li>
  <li><a href="#binary-coloring" id="toc-binary-coloring" class="nav-link" data-scroll-target="#binary-coloring">Binary Coloring</a></li>
  <li><a href="#full-implementation" id="toc-full-implementation" class="nav-link" data-scroll-target="#full-implementation">Full Implementation</a></li>
  <li><a href="#coloring-by-iteration-count" id="toc-coloring-by-iteration-count" class="nav-link" data-scroll-target="#coloring-by-iteration-count">Coloring by Iteration Count</a></li>
  <li><a href="#color-palettes" id="toc-color-palettes" class="nav-link" data-scroll-target="#color-palettes">Color Palettes</a></li>
  </ul></li>
  <li><a href="#other-escape-time-fractals" id="toc-other-escape-time-fractals" class="nav-link" data-scroll-target="#other-escape-time-fractals"><span class="header-section-number">2.4</span> Other Escape-Time Fractals</a>
  <ul class="collapse">
  <li><a href="#julia-sets" id="toc-julia-sets" class="nav-link" data-scroll-target="#julia-sets">Julia Sets</a></li>
  <li><a href="#others" id="toc-others" class="nav-link" data-scroll-target="#others">Others</a></li>
  <li><a href="#the-pattern" id="toc-the-pattern" class="nav-link" data-scroll-target="#the-pattern">The Pattern</a></li>
  </ul></li>
  <li><a href="#circle-inversion" id="toc-circle-inversion" class="nav-link" data-scroll-target="#circle-inversion"><span class="header-section-number">2.5</span> Circle Inversion</a>
  <ul class="collapse">
  <li><a href="#definition-1" id="toc-definition-1" class="nav-link" data-scroll-target="#definition-1">Definition</a></li>
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation">Implementation</a></li>
  <li><a href="#visualizing-inversion" id="toc-visualizing-inversion" class="nav-link" data-scroll-target="#visualizing-inversion">Visualizing Inversion</a></li>
  <li><a href="#key-properties" id="toc-key-properties" class="nav-link" data-scroll-target="#key-properties">Key Properties</a></li>
  <li><a href="#inverting-a-grid" id="toc-inverting-a-grid" class="nav-link" data-scroll-target="#inverting-a-grid">Inverting a Grid</a></li>
  </ul></li>
  <li><a href="#structs" id="toc-structs" class="nav-link" data-scroll-target="#structs"><span class="header-section-number">2.6</span> Structs</a>
  <ul class="collapse">
  <li><a href="#general-circle-inversion" id="toc-general-circle-inversion" class="nav-link" data-scroll-target="#general-circle-inversion">General Circle Inversion</a></li>
  <li><a href="#defining-a-struct" id="toc-defining-a-struct" class="nav-link" data-scroll-target="#defining-a-struct">Defining a Struct</a></li>
  <li><a href="#inversion-with-structs" id="toc-inversion-with-structs" class="nav-link" data-scroll-target="#inversion-with-structs">Inversion with Structs</a></li>
  <li><a href="#demo-moving-circle" id="toc-demo-moving-circle" class="nav-link" data-scroll-target="#demo-moving-circle">Demo: Moving Circle</a></li>
  </ul></li>
  <li><a href="#the-apollonian-gasket" id="toc-the-apollonian-gasket" class="nav-link" data-scroll-target="#the-apollonian-gasket"><span class="header-section-number">2.7</span> The Apollonian Gasket</a>
  <ul class="collapse">
  <li><a href="#the-setup" id="toc-the-setup" class="nav-link" data-scroll-target="#the-setup">The Setup</a></li>
  <li><a href="#from-drawing-to-iteration" id="toc-from-drawing-to-iteration" class="nav-link" data-scroll-target="#from-drawing-to-iteration">From Drawing to Iteration</a></li>
  <li><a href="#full-implementation-1" id="toc-full-implementation-1" class="nav-link" data-scroll-target="#full-implementation-1">Full Implementation</a></li>
  <li><a href="#visualizing-the-limit-set" id="toc-visualizing-the-limit-set" class="nav-link" data-scroll-target="#visualizing-the-limit-set">Visualizing the Limit Set</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">2.8</span> Exercises</a>
  <ul class="collapse">
  <li><a href="#checkpoints" id="toc-checkpoints" class="nav-link" data-scroll-target="#checkpoints">Checkpoints</a></li>
  <li><a href="#explorations" id="toc-explorations" class="nav-link" data-scroll-target="#explorations">Explorations</a></li>
  <li><a href="#challenges" id="toc-challenges" class="nav-link" data-scroll-target="#challenges">Challenges</a></li>
  <li><a href="#projects" id="toc-projects" class="nav-link" data-scroll-target="#projects">Projects</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Day 2: Dynamics</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="overview" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="overview"><span class="header-section-number">2.1</span> Overview</h2>
<p>Today we’ll learn how to do per-pixel computation in shaders, to quickly produce images of compelx mathematical objects. In the homework today, you’ll create your own version of the classic mandelbrot fractal zoom:</p>
<figure class="shader-demo figure">
  <div id="demo-day2-mandelbrot-zoom" style="width: 100%; height: ;"></div>
  <script type="module">
    import { embed } from '/demos/day2/mandelbrot-zoom/embed.js';
    await embed({ container: '#demo-day2-mandelbrot-zoom' });
  </script>
  
</figure>

<p>Today we explore two kinds of iterative systems:</p>
<ol type="1">
<li><strong>Complex dynamics</strong>: Iterating holomorphic maps gives us the Mandelbrot set, Julia sets, and their cousins</li>
<li><strong>Circle inversion</strong>: Iterating geometric transformations gives us the Apollonian gasket</li>
</ol>
<p>Both share the same GPU-friendly structure: each pixel asks “what happens when I iterate from here?” No pixel depends on any other—perfect for parallel computation.</p>
<p>Along the way, we’ll learn to implement complex arithmetic in GLSL and organize geometric data using structs.</p>
</section>
<section id="complex-numbers-in-glsl" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="complex-numbers-in-glsl"><span class="header-section-number">2.2</span> Complex Numbers in GLSL</h2>
<p>The complex numbers <span class="math inline">\(\mathbb{C}\)</span> are the plane equipped with a multiplication operation. Today we implement that algebra in GLSL.</p>
<section id="representation" class="level3">
<h3 class="anchored" data-anchor-id="representation">Representation</h3>
<p>A complex number <span class="math inline">\(z = a + bi\)</span> is naturally represented as a 2D vector:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> z <span class="op">=</span> <span class="dt">vec2</span><span class="op">(</span>a<span class="op">,</span> b<span class="op">);</span>  <span class="co">// represents a + bi</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>We’ll consistently use the convention that <code>z.x</code> is the real part and <code>z.y</code> is the imaginary part.</p>
</section>
<section id="arithmetic" class="level3">
<h3 class="anchored" data-anchor-id="arithmetic">Arithmetic</h3>
<p><strong>Addition</strong> of complex numbers is componentwise—exactly what GLSL’s built-in <code>+</code> does for vectors. No helper function needed.</p>
<p><strong>Multiplication</strong> is more interesting. In GLSL, the <code>*</code> operator on vectors is componentwise: <code>vec2(a,b) * vec2(c,d)</code> gives <code>vec2(a*c, b*d)</code>. This is <em>not</em> complex multiplication! We need to implement the correct formula ourselves.</p>
<p>Recall <span class="math inline">\((a + bi)(c + di) = (ac - bd) + (ad + bc)i\)</span>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> <span class="fu">cmul</span><span class="op">(</span><span class="dt">vec2</span> z<span class="op">,</span> <span class="dt">vec2</span> w<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="dt">vec2</span><span class="op">(</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>        z<span class="op">.</span><span class="fu">x</span> <span class="op">*</span> w<span class="op">.</span><span class="fu">x</span> <span class="op">-</span> z<span class="op">.</span><span class="fu">y</span> <span class="op">*</span> w<span class="op">.</span><span class="fu">y</span><span class="op">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        z<span class="op">.</span><span class="fu">x</span> <span class="op">*</span> w<span class="op">.</span><span class="fu">y</span> <span class="op">+</span> z<span class="op">.</span><span class="fu">y</span> <span class="op">*</span> w<span class="op">.</span><span class="fu">x</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This is the FOIL pattern with <span class="math inline">\(i^2 = -1\)</span> giving the minus sign in the real part.</p>
</section>
<section id="magnitude" class="level3">
<h3 class="anchored" data-anchor-id="magnitude">Magnitude</h3>
<p>The magnitude of <span class="math inline">\(z = a + bi\)</span> is the distance from the origin: <span class="math display">\[|z| = \sqrt{a^2 + b^2}\]</span></p>
<p>We can implement this directly:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> <span class="fu">cabs</span><span class="op">(</span><span class="dt">vec2</span> z<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="bu">sqrt</span><span class="op">(</span>z<span class="op">.</span><span class="fu">x</span> <span class="op">*</span> z<span class="op">.</span><span class="fu">x</span> <span class="op">+</span> z<span class="op">.</span><span class="fu">y</span> <span class="op">*</span> z<span class="op">.</span><span class="fu">y</span><span class="op">);</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>But consider: we’ll often have conditions like “is <span class="math inline">\(|z|\)</span> bigger than 2?” rather than needing the actual magnitude. In these cases, we can check <span class="math inline">\(|z|^2 &gt; 4\)</span> instead of <span class="math inline">\(|z| &gt; 2\)</span>—same answer, but no square root. When you’re doing this check millions of times per frame (once per pixel, 60 frames per second), avoiding unnecessary square roots adds up.</p>
<p>So we define the squared magnitude:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> <span class="fu">cabs2</span><span class="op">(</span><span class="dt">vec2</span> z<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> z<span class="op">.</span><span class="fu">x</span> <span class="op">*</span> z<span class="op">.</span><span class="fu">x</span> <span class="op">+</span> z<span class="op">.</span><span class="fu">y</span> <span class="op">*</span> z<span class="op">.</span><span class="fu">y</span><span class="op">;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If we want to be even more efficient, we can use GLSL’s built-in dot product, which computes exactly this sum of products:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> <span class="fu">cabs2</span><span class="op">(</span><span class="dt">vec2</span> z<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="bu">dot</span><span class="op">(</span>z<span class="op">,</span> z<span class="op">);</span>  <span class="co">// a² + b²</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="the-mandelbrot-set" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="the-mandelbrot-set"><span class="header-section-number">2.3</span> The Mandelbrot Set</h2>
<p>The Mandelbrot set is perhaps the most iconic fractal—its shape is instantly recognizable, and its discovery in 1980 helped launch the era of computer-generated mathematical visualization. The definition is remarkably simple.</p>
<section id="definition" class="level3">
<h3 class="anchored" data-anchor-id="definition">Definition</h3>
<p>Fix a complex number <span class="math inline">\(c\)</span>. Starting from <span class="math inline">\(z_0 = 0\)</span>, define a sequence by iterating: <span class="math display">\[z_{n+1} = z_n^2 + c\]</span></p>
<p>For some values of <span class="math inline">\(c\)</span>, this sequence stays bounded forever. For others, it escapes to infinity. The <strong>Mandelbrot set</strong> <span class="math inline">\(\mathcal{M}\)</span> is the set of all <span class="math inline">\(c\)</span> for which the sequence remains bounded.</p>
<p>That’s it! One quadratic formula, iterated. The intricate structure of the Mandelbrot set emerges entirely from this simple rule.</p>
</section>
<section id="rendering-strategy" class="level3">
<h3 class="anchored" data-anchor-id="rendering-strategy">Rendering Strategy</h3>
<p>To draw the Mandelbrot set, we test each pixel: is this value of <span class="math inline">\(c\)</span> in <span class="math inline">\(\mathcal{M}\)</span> or not?</p>
<p>This is exactly the kind of question shaders excel at. Each pixel performs its own independent calculation—no pixel needs information from any other pixel. The entire image can be computed in parallel, with thousands of GPU cores each testing their own value of <span class="math inline">\(c\)</span> simultaneously.</p>
<p>But there’s a problem: the definition involves iterating “forever” and checking if the sequence “stays bounded.” We can’t iterate infinitely, and we can’t wait forever to decide. We need a practical criterion for when to stop.</p>
</section>
<section id="the-escape-radius" class="level3">
<h3 class="anchored" data-anchor-id="the-escape-radius">The Escape Radius</h3>
<p>We need two facts that make efficient rendering possible.</p>
<p><strong>Fact 1.</strong> The Mandelbrot set is contained in the disk of radius 2. That is, if <span class="math inline">\(|c| &gt; 2\)</span>, then <span class="math inline">\(c \notin \mathcal{M}\)</span>.</p>
<p><em>Proof.</em> [TODO] <span class="math inline">\(\square\)</span></p>
<p><strong>Fact 2.</strong> If <span class="math inline">\(|c| \leq 2\)</span> and <span class="math inline">\(|z_n| &gt; 2\)</span> for some <span class="math inline">\(n\)</span>, then the orbit escapes to infinity (so <span class="math inline">\(c \notin \mathcal{M}\)</span>).</p>
<p><em>Proof.</em> [TODO] <span class="math inline">\(\square\)</span></p>
<p>This gives us a stopping criterion: once <span class="math inline">\(|z_n| &gt; 2\)</span>, we know <span class="math inline">\(c\)</span> is not in the Mandelbrot set. We don’t need to keep iterating.</p>
<p>Together, these facts justify the <strong>escape-time algorithm</strong>: iterate until either <span class="math inline">\(|z_n| &gt; 2\)</span> (escaped, not in <span class="math inline">\(\mathcal{M}\)</span>) or we hit a maximum iteration count (probably in <span class="math inline">\(\mathcal{M}\)</span>).</p>
</section>
<section id="the-escape-time-algorithm" class="level3">
<h3 class="anchored" data-anchor-id="the-escape-time-algorithm">The Escape-Time Algorithm</h3>
<p>These two facts give us our algorithm:</p>
<ol type="1">
<li>For each pixel, let <span class="math inline">\(c\)</span> be the corresponding complex number</li>
<li>Start with <span class="math inline">\(z = 0\)</span></li>
<li>Iterate <span class="math inline">\(z \mapsto z^2 + c\)</span></li>
<li>If <span class="math inline">\(|z| &gt; 2\)</span>, stop—this point escapes (not in <span class="math inline">\(\mathcal{M}\)</span>)</li>
<li>If we reach a maximum iteration count without escaping, assume bounded (in <span class="math inline">\(\mathcal{M}\)</span>)</li>
</ol>
<p>The core of this is a loop:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> z <span class="op">=</span> <span class="dt">vec2</span><span class="op">(</span><span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">);</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> max_iter <span class="op">=</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> iter<span class="op">;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> <span class="op">(</span>iter <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> iter <span class="op">&lt;</span> max_iter<span class="op">;</span> iter<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span><span class="fu">cabs2</span><span class="op">(</span>z<span class="op">)</span> <span class="op">&gt;</span> <span class="fl">4.0</span><span class="op">)</span> <span class="kw">break</span><span class="op">;</span>  <span class="co">// |z|² &gt; 4 means |z| &gt; 2</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> <span class="fu">cmul</span><span class="op">(</span>z<span class="op">,</span> z<span class="op">)</span> <span class="op">+</span> c<span class="op">;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>After this loop, <code>iter</code> tells us what happened: if <code>iter == max_iter</code>, we never escaped (probably in <span class="math inline">\(\mathcal{M}\)</span>). Otherwise, we escaped on iteration <code>iter</code>.</p>
</section>
<section id="binary-coloring" class="level3">
<h3 class="anchored" data-anchor-id="binary-coloring">Binary Coloring</h3>
<p>The simplest approach: color points black if they’re in the set, white if they escaped.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec3</span> color<span class="op">;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span>iter <span class="op">==</span> max_iter<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.0</span><span class="op">);</span>  <span class="co">// In the set: black</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">1.0</span><span class="op">);</span>  <span class="co">// Escaped: white</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="full-implementation" class="level3">
<h3 class="anchored" data-anchor-id="full-implementation">Full Implementation</h3>
<p>Putting it together with our coordinate setup:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> <span class="fu">cmul</span><span class="op">(</span><span class="dt">vec2</span> z<span class="op">,</span> <span class="dt">vec2</span> w<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="dt">vec2</span><span class="op">(</span>z<span class="op">.</span><span class="fu">x</span> <span class="op">*</span> w<span class="op">.</span><span class="fu">x</span> <span class="op">-</span> z<span class="op">.</span><span class="fu">y</span> <span class="op">*</span> w<span class="op">.</span><span class="fu">y</span><span class="op">,</span> z<span class="op">.</span><span class="fu">x</span> <span class="op">*</span> w<span class="op">.</span><span class="fu">y</span> <span class="op">+</span> z<span class="op">.</span><span class="fu">y</span> <span class="op">*</span> w<span class="op">.</span><span class="fu">x</span><span class="op">);</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> <span class="fu">cabs2</span><span class="op">(</span><span class="dt">vec2</span> z<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="bu">dot</span><span class="op">(</span>z<span class="op">,</span> z<span class="op">);</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">mainImage</span><span class="op">(</span><span class="dt">out</span> <span class="dt">vec4</span> fragColor<span class="op">,</span> <span class="dt">in</span> <span class="dt">vec2</span> fragCoord<span class="op">)</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Coordinate setup</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> uv <span class="op">=</span> fragCoord <span class="op">/</span> iResolution<span class="op">.</span><span class="fu">xy</span><span class="op">;</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    uv <span class="op">=</span> uv <span class="op">-</span> <span class="dt">vec2</span><span class="op">(</span><span class="fl">0.5</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">);</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    uv<span class="op">.</span><span class="fu">x</span> <span class="op">*=</span> iResolution<span class="op">.</span><span class="fu">x</span> <span class="op">/</span> iResolution<span class="op">.</span><span class="fu">y</span><span class="op">;</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Scale and center to show the Mandelbrot set</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// By Fact 1, the set lies in |c| ≤ 2</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> c <span class="op">=</span> uv <span class="op">*</span> <span class="fl">4.0</span><span class="op">;</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    c<span class="op">.</span><span class="fu">x</span> <span class="op">-=</span> <span class="fl">0.5</span><span class="op">;</span>  <span class="co">// shift left to center the interesting part</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Mandelbrot iteration</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> z <span class="op">=</span> <span class="dt">vec2</span><span class="op">(</span><span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">);</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> max_iter <span class="op">=</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> iter<span class="op">;</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> <span class="op">(</span>iter <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> iter <span class="op">&lt;</span> max_iter<span class="op">;</span> iter<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span><span class="fu">cabs2</span><span class="op">(</span>z<span class="op">)</span> <span class="op">&gt;</span> <span class="fl">4.0</span><span class="op">)</span> <span class="kw">break</span><span class="op">;</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>        z <span class="op">=</span> <span class="fu">cmul</span><span class="op">(</span>z<span class="op">,</span> z<span class="op">)</span> <span class="op">+</span> c<span class="op">;</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Binary coloring</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec3</span> color<span class="op">;</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>iter <span class="op">==</span> max_iter<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.0</span><span class="op">);</span>  <span class="co">// In the set: black</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">1.0</span><span class="op">);</span>  <span class="co">// Escaped: white</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>    fragColor <span class="op">=</span> <span class="dt">vec4</span><span class="op">(</span>color<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<figure class="shader-demo figure">
  <div id="demo-day2-mandelbrot-bw" style="width: 100%; height: ;"></div>
  <script type="module">
    import { embed } from '/demos/day2/mandelbrot-bw/embed.js';
    await embed({ container: '#demo-day2-mandelbrot-bw' });
  </script>
  
</figure>

<p>There it is—the Mandelbrot set in black and white!</p>
</section>
<section id="coloring-by-iteration-count" class="level3">
<h3 class="anchored" data-anchor-id="coloring-by-iteration-count">Coloring by Iteration Count</h3>
<p>Black and white shows the set, but we’re throwing away information. The number of iterations before escape tells us how “close” a point is to the boundary—points that escape after 5 iterations are different from points that escape after 50.</p>
<p>Let’s use <code>iter</code> to create a gradient:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec3</span> color<span class="op">;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span>iter <span class="op">==</span> max_iter<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.0</span><span class="op">);</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> t <span class="op">=</span> <span class="dt">float</span><span class="op">(</span>iter<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span>max_iter<span class="op">);</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span>t<span class="op">);</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<figure class="shader-demo figure">
  <div id="demo-day2-mandelbrot-gray" style="width: 100%; height: ;"></div>
  <script type="module">
    import { embed } from '/demos/day2/mandelbrot-gray/embed.js';
    await embed({ container: '#demo-day2-mandelbrot-gray' });
  </script>
  
</figure>

<p>Now we see structure! The boundary reveals intricate detail—tendrils, spirals, bulbs. Points near the boundary take many iterations to escape (bright), while points far away escape quickly (dark).</p>
</section>
<section id="color-palettes" class="level3">
<h3 class="anchored" data-anchor-id="color-palettes">Color Palettes</h3>
<p>Grayscale works, but we can do better. A common technique uses cosines to create smooth, cycling color palettes:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec3</span> <span class="fu">palette</span><span class="op">(</span><span class="dt">float</span> t<span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec3</span> a <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.5</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">);</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec3</span> b <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.5</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">);</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec3</span> c <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">1.0</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec3</span> d <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.00</span><span class="op">,</span> <span class="fl">0.33</span><span class="op">,</span> <span class="fl">0.67</span><span class="op">);</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> a <span class="op">+</span> b <span class="op">*</span> <span class="bu">cos</span><span class="op">(</span><span class="fl">6.28318</span> <span class="op">*</span> <span class="op">(</span>c <span class="op">*</span> t <span class="op">+</span> d<span class="op">));</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The parameters <code>a</code>, <code>b</code>, <code>c</code>, <code>d</code> control the palette’s character. The vector <code>d</code> shifts the phase of each color channel, creating different hues. Try <code>d = vec3(0.00, 0.10, 0.20)</code> for blues and purples, or <code>d = vec3(0.30, 0.20, 0.20)</code> for warmer tones.</p>
<figure class="shader-demo figure">
  <div id="demo-day2-mandelbrot-color" style="width: 100%; height: ;"></div>
  <script type="module">
    import { embed } from '/demos/day2/mandelbrot-color/embed.js';
    await embed({ container: '#demo-day2-mandelbrot-color' });
  </script>
  
</figure>

<p>The color bands correspond to iteration counts—regions of the same color escaped after the same number of iterations. You’ll notice the bands have sharp edges. In the exercises, we’ll show you a technique called <em>smooth coloring</em> that interpolates between iteration counts, eliminating the banding for even smoother gradients.</p>
</section>
</section>
<section id="other-escape-time-fractals" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="other-escape-time-fractals"><span class="header-section-number">2.4</span> Other Escape-Time Fractals</h2>
<p>The Mandelbrot set is one example of an escape-time fractal, but the same algorithm works for many other iterated systems. We just swap out the iteration formula (and sometimes the escape condition). Let’s explore a few.</p>
<section id="julia-sets" class="level3">
<h3 class="anchored" data-anchor-id="julia-sets">Julia Sets</h3>
<p>The Mandelbrot set asks: for which values of <span class="math inline">\(c\)</span> does the orbit of <span class="math inline">\(0\)</span> stay bounded? We can ask a different question: for a <em>fixed</em> <span class="math inline">\(c\)</span>, which <em>starting points</em> <span class="math inline">\(z_0\)</span> have bounded orbits?</p>
<p>Fix a complex number <span class="math inline">\(c\)</span>. The <strong>filled Julia set</strong> <span class="math inline">\(K_c\)</span> is the set of all starting points <span class="math inline">\(z_0\)</span> for which the iteration <span class="math display">\[z_{n+1} = z_n^2 + c\]</span> remains bounded.</p>
<p>Same iteration, different question. For the Mandelbrot set, we vary <span class="math inline">\(c\)</span> and always start at <span class="math inline">\(z_0 = 0\)</span>. For a Julia set, we fix <span class="math inline">\(c\)</span> and vary <span class="math inline">\(z_0\)</span>.</p>
<p>The code change is minimal:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Mandelbrot: c varies, z starts at 0</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> c <span class="op">=</span> p<span class="op">;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> z <span class="op">=</span> <span class="dt">vec2</span><span class="op">(</span><span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">);</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Julia: c is fixed, z starts at pixel position</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> c <span class="op">=</span> <span class="dt">vec2</span><span class="op">(-</span><span class="fl">0.7</span><span class="op">,</span> <span class="fl">0.27015</span><span class="op">);</span>  <span class="co">// fixed parameter</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> z <span class="op">=</span> p<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<figure class="shader-demo figure">
  <div id="demo-day2-julia-static" style="width: 100%; height: ;"></div>
  <script type="module">
    import { embed } from '/demos/day2/julia-static/embed.js';
    await embed({ container: '#demo-day2-julia-static' });
  </script>
  
</figure>

<p>Different values of <span class="math inline">\(c\)</span> produce dramatically different Julia sets. In the exercises, you’ll build an interactive explorer that lets you click anywhere on the Mandelbrot set to see the corresponding Julia set:</p>
<figure class="shader-demo figure">
  <div id="demo-day2-julia-explorer" style="width: 100%; height: ;"></div>
  <script type="module">
    import { embed } from '/demos/day2/julia-explorer/embed.js';
    await embed({ container: '#demo-day2-julia-explorer' });
  </script>
  
</figure>

</section>
<section id="others" class="level3">
<h3 class="anchored" data-anchor-id="others">Others</h3>
<p>The Mandelbrot set uses <span class="math inline">\(z^2 + c\)</span>. What about <span class="math inline">\(z^3 + c\)</span>? Or <span class="math inline">\(z^4 + c\)</span>?</p>
<p>For <span class="math inline">\(z^3\)</span>, we can compose our existing <code>cmul</code> function:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> <span class="fu">ccube</span><span class="op">(</span><span class="dt">vec2</span> z<span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="fu">cmul</span><span class="op">(</span><span class="fu">cmul</span><span class="op">(</span>z<span class="op">,</span> z<span class="op">),</span> z<span class="op">);</span>  <span class="co">// z · z · z</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Higher powers give higher-order rotational symmetry: <span class="math inline">\(z^3 + c\)</span> has 3-fold symmetry, <span class="math inline">\(z^4 + c\)</span> has 4-fold symmetry, and so on.</p>
<p>For some more variety, the <strong>Burning Ship fractal</strong> modifies the Mandelbrot iteration by taking the absolute value of the imaginary part after each squaring:</p>
<p><span class="math display">\[z_{n+1} = (\text{Re}(z_n^2) + i|\text{Im}(z_n^2)|) + c\]</span></p>
</section>
<section id="the-pattern" class="level3">
<h3 class="anchored" data-anchor-id="the-pattern">The Pattern</h3>
<p>All these fractals share the same structure:</p>
<ol type="1">
<li><strong>Iterate</strong> some function <span class="math inline">\(f(z, c)\)</span></li>
<li><strong>Check escape</strong>: has <span class="math inline">\(|z|\)</span> exceeded some threshold?</li>
<li><strong>Color</strong> based on iteration count</li>
</ol>
<p>Changing the iteration function changes the fractal. The exercises include more variations for you to try.</p>
</section>
</section>
<section id="circle-inversion" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="circle-inversion"><span class="header-section-number">2.5</span> Circle Inversion</h2>
<p>We shift gears from complex dynamics to geometric transformations. Circle inversion is a classical operation that turns circles into circles (or lines), preserves angles, and creates beautiful fractal patterns when iterated.</p>
<section id="definition-1" class="level3">
<h3 class="anchored" data-anchor-id="definition-1">Definition</h3>
<p><strong>Inversion in the unit circle</strong> maps a point <span class="math inline">\(\mathbf{p}\)</span> to:</p>
<p><span class="math display">\[\text{inv}(\mathbf{p}) = \frac{\mathbf{p}}{|\mathbf{p}|^2}\]</span></p>
<p>What does this do geometrically? The inverted point lies on the same ray from the origin as <span class="math inline">\(\mathbf{p}\)</span>, but at distance <span class="math inline">\(1/r\)</span> instead of <span class="math inline">\(r\)</span>.</p>
<ul>
<li>Points inside the unit circle map to points outside</li>
<li>Points outside map to points inside<br>
</li>
<li>Points on the unit circle stay fixed</li>
<li>The origin maps to “infinity”</li>
</ul>
</section>
<section id="implementation" class="level3">
<h3 class="anchored" data-anchor-id="implementation">Implementation</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> <span class="fu">invert</span><span class="op">(</span><span class="dt">vec2</span> p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> p <span class="op">/</span> <span class="bu">dot</span><span class="op">(</span>p<span class="op">,</span> p<span class="op">);</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="visualizing-inversion" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-inversion">Visualizing Inversion</h3>
<p>To see what inversion does, let’s draw some shapes and their images. We’ll draw the unit circle (gray), plus a vertical line and a circle (yellow). To make it clearer, we’ll toggle between showing the original shapes and their inversions:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">mainImage</span><span class="op">(</span><span class="dt">out</span> <span class="dt">vec4</span> fragColor<span class="op">,</span> <span class="dt">in</span> <span class="dt">vec2</span> fragCoord<span class="op">)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> uv <span class="op">=</span> fragCoord <span class="op">/</span> iResolution<span class="op">.</span><span class="fu">xy</span><span class="op">;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    uv <span class="op">=</span> uv <span class="op">-</span> <span class="dt">vec2</span><span class="op">(</span><span class="fl">0.5</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">);</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    uv<span class="op">.</span><span class="fu">x</span> <span class="op">*=</span> iResolution<span class="op">.</span><span class="fu">x</span> <span class="op">/</span> iResolution<span class="op">.</span><span class="fu">y</span><span class="op">;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> p <span class="op">=</span> uv <span class="op">*</span> <span class="fl">4.0</span><span class="op">;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Compute the inversion of p</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> p_inv <span class="op">=</span> <span class="fu">invert</span><span class="op">(</span>p<span class="op">);</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Toggle between original and inverted every second</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> time <span class="op">=</span> <span class="bu">fract</span><span class="op">(</span>iTime <span class="op">*</span> <span class="fl">0.5</span><span class="op">);</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> q<span class="op">;</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>time <span class="op">&lt;</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>        q <span class="op">=</span> p<span class="op">;</span>      <span class="co">// original</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>        q <span class="op">=</span> p_inv<span class="op">;</span>  <span class="co">// inverted</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec3</span> color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.15</span><span class="op">);</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Draw the unit circle (the inversion circle)</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> d_unit <span class="op">=</span> <span class="bu">abs</span><span class="op">(</span><span class="bu">length</span><span class="op">(</span>p<span class="op">)</span> <span class="op">-</span> <span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>d_unit <span class="op">&lt;</span> <span class="fl">0.02</span><span class="op">)</span> color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.5</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">);</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Draw a vertical line at x = 2</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span><span class="bu">abs</span><span class="op">(</span>q<span class="op">.</span><span class="fu">x</span> <span class="op">-</span> <span class="fl">2.0</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.02</span><span class="op">)</span> color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">1.0</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">);</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Draw a horizontal line at y = 1.5</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span><span class="bu">abs</span><span class="op">(</span>q<span class="op">.</span><span class="fu">y</span> <span class="op">-</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.02</span><span class="op">)</span> color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">1.0</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">);</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Draw a circle centered at (2, 0) with radius 0.5</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> d_circle <span class="op">=</span> <span class="bu">abs</span><span class="op">(</span><span class="bu">length</span><span class="op">(</span>q <span class="op">-</span> <span class="dt">vec2</span><span class="op">(</span><span class="fl">2.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">))</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">);</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>d_circle <span class="op">&lt;</span> <span class="fl">0.02</span><span class="op">)</span> color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">1.0</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">);</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>    fragColor <span class="op">=</span> <span class="dt">vec4</span><span class="op">(</span>color<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<figure class="shader-demo figure">
  <div id="demo-day2-inversion-toggle" style="width: 100%; height: ;"></div>
  <script type="module">
    import { embed } from '/demos/day2/inversion-toggle/embed.js';
    await embed({ container: '#demo-day2-inversion-toggle' });
  </script>
  
</figure>

<p>Watch the lines become circles! A line not passing through the origin inverts to a circle that <em>does</em> pass through the origin. The circle inverts to another circle (with a different center and radius).</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>GLSL Shortcuts: mix and step
</div>
</div>
<div class="callout-body-container callout-body">
<p>The toggle logic can be written more compactly using built-in functions:</p>
<ul>
<li><code>step(edge, x)</code> returns 0 if <code>x &lt; edge</code>, otherwise 1</li>
<li><code>mix(a, b, t)</code> linearly interpolates: returns <code>a</code> when <code>t = 0</code>, <code>b</code> when <code>t = 1</code></li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> t <span class="op">=</span> <span class="bu">step</span><span class="op">(</span><span class="fl">0.5</span><span class="op">,</span> <span class="bu">fract</span><span class="op">(</span>iTime <span class="op">*</span> <span class="fl">0.5</span><span class="op">));</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> q <span class="op">=</span> <span class="bu">mix</span><span class="op">(</span>p<span class="op">,</span> p_inv<span class="op">,</span> t<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This is a common pattern for toggling or smoothly transitioning between states.</p>
</div>
</div>
</section>
<section id="key-properties" class="level3">
<h3 class="anchored" data-anchor-id="key-properties">Key Properties</h3>
<p>Circle inversion maps circles to circles (or to lines, if the circle passes through the center). It’s <em>conformal</em>—it preserves angles between curves. And it’s <em>involutive</em>: applying inversion twice returns to the original point.</p>
</section>
<section id="inverting-a-grid" class="level3">
<h3 class="anchored" data-anchor-id="inverting-a-grid">Inverting a Grid</h3>
<p>For a more dramatic visualization, let’s invert a whole grid of lines. The function <code>mod(q, 0.5)</code> gives the position of <code>q</code> within a repeating <span class="math inline">\(0.5 \times 0.5\)</span> cell—when either component is near zero, we’re on a grid line:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> grid <span class="op">=</span> <span class="bu">mod</span><span class="op">(</span>q<span class="op">,</span> <span class="fl">0.5</span><span class="op">);</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span>grid<span class="op">.</span><span class="fu">x</span> <span class="op">&lt;</span> <span class="fl">0.02</span> <span class="op">||</span> grid<span class="op">.</span><span class="fu">y</span> <span class="op">&lt;</span> <span class="fl">0.02</span><span class="op">)</span> color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">1.0</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>(If you did the grid project from Day 1, this is familiar!)</p>
<p>Using the same toggle shader structure as before, just replacing the individual shapes with this grid:</p>
<figure class="shader-demo figure">
  <div id="demo-day2-inversion-grid" style="width: 100%; height: ;"></div>
  <script type="module">
    import { embed } from '/demos/day2/inversion-grid/embed.js';
    await embed({ container: '#demo-day2-inversion-grid' });
  </script>
  
</figure>

</section>
</section>
<section id="structs" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="structs"><span class="header-section-number">2.6</span> Structs</h2>
<p>So far our <code>invert</code> function only works for the unit circle at the origin. What if we want to invert through a different circle?</p>
<section id="general-circle-inversion" class="level3">
<h3 class="anchored" data-anchor-id="general-circle-inversion">General Circle Inversion</h3>
<p>For a circle with center <span class="math inline">\(\mathbf{c}\)</span> and radius <span class="math inline">\(R\)</span>, inversion maps a point <span class="math inline">\(\mathbf{p}\)</span> to:</p>
<p><span class="math display">\[\text{inv}(\mathbf{p}) = \mathbf{c} + R^2 \frac{\mathbf{p} - \mathbf{c}}{|\mathbf{p} - \mathbf{c}|^2}\]</span></p>
<p>The idea is the same as before: the inverted point lies on the ray from <span class="math inline">\(\mathbf{c}\)</span> through <span class="math inline">\(\mathbf{p}\)</span>, at distance <span class="math inline">\(R^2/r\)</span> from the center (where <span class="math inline">\(r = |\mathbf{p} - \mathbf{c}|\)</span>). When <span class="math inline">\(\mathbf{c} = \mathbf{0}\)</span> and <span class="math inline">\(R = 1\)</span>, this reduces to our earlier formula <span class="math inline">\(\mathbf{p}/|\mathbf{p}|^2\)</span>.</p>
<p>In code:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> <span class="fu">invertInCircle</span><span class="op">(</span><span class="dt">vec2</span> p<span class="op">,</span> <span class="dt">vec2</span> center<span class="op">,</span> <span class="dt">float</span> radius<span class="op">)</span> <span class="op">{</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> d <span class="op">=</span> p <span class="op">-</span> center<span class="op">;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> center <span class="op">+</span> radius <span class="op">*</span> radius <span class="op">*</span> d <span class="op">/</span> <span class="bu">dot</span><span class="op">(</span>d<span class="op">,</span> d<span class="op">);</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This works, but notice we need to pass <em>two</em> things (<code>center</code> and <code>radius</code>) to describe <em>one</em> object (a circle). If we’re working with multiple circles, every function call needs <code>center1, radius1, center2, radius2, ...</code>—it gets verbose and error-prone.</p>
</section>
<section id="defining-a-struct" class="level3">
<h3 class="anchored" data-anchor-id="defining-a-struct">Defining a Struct</h3>
<p>GLSL lets us bundle related data into a <strong>struct</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Circle <span class="op">{</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> center<span class="op">;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> radius<span class="op">;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now <code>Circle</code> is a type, just like <code>vec2</code> or <code>float</code>. We can create circles and access their fields:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>Circle c<span class="op">;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>c<span class="op">.</span><span class="fu">center</span> <span class="op">=</span> <span class="dt">vec2</span><span class="op">(</span><span class="fl">1.0</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">);</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>c<span class="op">.</span><span class="fu">radius</span> <span class="op">=</span> <span class="fl">0.7</span><span class="op">;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Or initialize directly:</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>Circle c <span class="op">=</span> <span class="fu">Circle</span><span class="op">(</span><span class="dt">vec2</span><span class="op">(</span><span class="fl">1.0</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">),</span> <span class="fl">0.7</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="inversion-with-structs" class="level3">
<h3 class="anchored" data-anchor-id="inversion-with-structs">Inversion with Structs</h3>
<p>Now our inversion function takes a <code>Circle</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> <span class="fu">invert</span><span class="op">(</span><span class="dt">vec2</span> p<span class="op">,</span> Circle c<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> d <span class="op">=</span> p <span class="op">-</span> c<span class="op">.</span><span class="fu">center</span><span class="op">;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> c<span class="op">.</span><span class="fu">center</span> <span class="op">+</span> c<span class="op">.</span><span class="fu">radius</span> <span class="op">*</span> c<span class="op">.</span><span class="fu">radius</span> <span class="op">*</span> d <span class="op">/</span> <span class="bu">dot</span><span class="op">(</span>d<span class="op">,</span> d<span class="op">);</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Much cleaner! And when we’re working with multiple circles, we can pass them around as single objects.</p>
</section>
<section id="demo-moving-circle" class="level3">
<h3 class="anchored" data-anchor-id="demo-moving-circle">Demo: Moving Circle</h3>
<p>Let’s animate a circle moving around and watch how the inversion changes. The key new elements are animating the circle’s center and radius:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Animate the inversion circle</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>Circle inv_circle<span class="op">;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>inv_circle<span class="op">.</span><span class="fu">center</span> <span class="op">=</span> <span class="dt">vec2</span><span class="op">(</span><span class="bu">sin</span><span class="op">(</span>iTime<span class="op">)</span> <span class="op">*</span> <span class="fl">0.5</span><span class="op">,</span> <span class="bu">cos</span><span class="op">(</span>iTime <span class="op">*</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.5</span><span class="op">);</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>inv_circle<span class="op">.</span><span class="fu">radius</span> <span class="op">=</span> <span class="fl">1.0</span> <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> <span class="bu">sin</span><span class="op">(</span>iTime <span class="op">*</span> <span class="fl">1.3</span><span class="op">);</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Compute inversion</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> p_inv <span class="op">=</span> <span class="fu">invert</span><span class="op">(</span>p<span class="op">,</span> inv_circle<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<figure class="shader-demo figure">
  <div id="demo-day2-inversion-moving" style="width: 100%; height: ;"></div>
  <script type="module">
    import { embed } from '/demos/day2/inversion-moving/embed.js';
    await embed({ container: '#demo-day2-inversion-moving' });
  </script>
  
</figure>

<p>As the circle moves and breathes, the inverted grid warps and flows.</p>
</section>
</section>
<section id="the-apollonian-gasket" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="the-apollonian-gasket"><span class="header-section-number">2.7</span> The Apollonian Gasket</h2>
<p>The Apollonian gasket is a classical fractal arising from circle packing. It’s named after Apollonius of Perga (~200 BCE), who studied the problem of finding circles tangent to three given circles.</p>
<section id="the-setup" class="level3">
<h3 class="anchored" data-anchor-id="the-setup">The Setup</h3>
<p>Start with four mutually tangent circles: three “inner” circles that touch each other pairwise, all enclosed by one “outer” circle that touches all three.</p>
<p>Let’s define these circles using our <code>Circle</code> struct. We’ll place three circles of radius <span class="math inline">\(r\)</span> with centers forming an equilateral triangle, all tangent to each other and to an outer circle:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Three inner circles, mutually tangent, plus outer circle</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co">// For circles of radius r to be mutually tangent, their centers</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">// must be 2r apart. This forms an equilateral triangle with side 2r.</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> r <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> triSide <span class="op">=</span> <span class="fl">2.0</span> <span class="op">*</span> r<span class="op">;</span>  <span class="co">// distance between inner circle centers</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> circumradius <span class="op">=</span> triSide <span class="op">/</span> <span class="bu">sqrt</span><span class="op">(</span><span class="fl">3.0</span><span class="op">);</span>  <span class="co">// distance from origin to centers</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>Circle c1 <span class="op">=</span> <span class="fu">Circle</span><span class="op">(</span><span class="dt">vec2</span><span class="op">(</span><span class="fl">0.0</span><span class="op">,</span> circumradius<span class="op">),</span> r<span class="op">);</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>Circle c2 <span class="op">=</span> <span class="fu">Circle</span><span class="op">(</span><span class="dt">vec2</span><span class="op">(-</span>circumradius <span class="op">*</span> <span class="fl">0.866</span><span class="op">,</span> <span class="op">-</span>circumradius <span class="op">*</span> <span class="fl">0.5</span><span class="op">),</span> r<span class="op">);</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>Circle c3 <span class="op">=</span> <span class="fu">Circle</span><span class="op">(</span><span class="dt">vec2</span><span class="op">(</span>circumradius <span class="op">*</span> <span class="fl">0.866</span><span class="op">,</span> <span class="op">-</span>circumradius <span class="op">*</span> <span class="fl">0.5</span><span class="op">),</span> r<span class="op">);</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>Circle outer <span class="op">=</span> <span class="fu">Circle</span><span class="op">(</span><span class="dt">vec2</span><span class="op">(</span><span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">),</span> circumradius <span class="op">+</span> r<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>To draw these circles, we need a distance function:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> <span class="fu">distToCircle</span><span class="op">(</span><span class="dt">vec2</span> p<span class="op">,</span> Circle c<span class="op">)</span> <span class="op">{</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="bu">abs</span><span class="op">(</span><span class="bu">length</span><span class="op">(</span>p <span class="op">-</span> c<span class="op">.</span><span class="fu">center</span><span class="op">)</span> <span class="op">-</span> c<span class="op">.</span><span class="fu">radius</span><span class="op">);</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This returns the distance from <code>p</code> to the circle’s boundary—zero on the circle, positive elsewhere.</p>
<p>Let’s draw our starting configuration:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec3</span> color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.15</span><span class="op">);</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Draw all four circles</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span><span class="fu">distToCircle</span><span class="op">(</span>p<span class="op">,</span> c1<span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.03</span><span class="op">)</span> color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">1.0</span><span class="op">,</span> <span class="fl">0.3</span><span class="op">,</span> <span class="fl">0.3</span><span class="op">);</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span><span class="fu">distToCircle</span><span class="op">(</span>p<span class="op">,</span> c2<span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.03</span><span class="op">)</span> color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.3</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">,</span> <span class="fl">0.3</span><span class="op">);</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span><span class="fu">distToCircle</span><span class="op">(</span>p<span class="op">,</span> c3<span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.03</span><span class="op">)</span> color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.3</span><span class="op">,</span> <span class="fl">0.3</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span><span class="fu">distToCircle</span><span class="op">(</span>p<span class="op">,</span> outer<span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.03</span><span class="op">)</span> color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">1.0</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<figure class="shader-demo figure">
  <div id="demo-day2-apollonian-setup" style="width: 100%; height: ;"></div>
  <script type="module">
    import { embed } from '/demos/day2/apollonian-setup/embed.js';
    await embed({ container: '#demo-day2-apollonian-setup' });
  </script>
  
</figure>

<p>Three colored circles inside a white outer circle, all mutually tangent.</p>
</section>
<section id="from-drawing-to-iteration" class="level3">
<h3 class="anchored" data-anchor-id="from-drawing-to-iteration">From Drawing to Iteration</h3>
<p>The gaps between circles are curvilinear triangles. The Apollonian gasket fills each gap with a circle tangent to its three neighbors, then fills the new gaps, and so on forever.</p>
<p>Here’s the key insight: we can generate this structure by <em>iterating inversions</em>. If a point is inside one of the inner circles, invert through that circle—this “pushes” it out. If a point is outside the outer circle, invert through the outer circle—this “pulls” it in.</p>
<p>We need to check: - Is <span class="math inline">\(\mathbf{p}\)</span> inside circle <code>c1</code>, <code>c2</code>, or <code>c3</code>? (distance from center &lt; radius) - Is <span class="math inline">\(\mathbf{p}\)</span> outside circle <code>outer</code>? (distance from center &gt; radius)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> <span class="fu">isInside</span><span class="op">(</span><span class="dt">vec2</span> p<span class="op">,</span> Circle c<span class="op">)</span> <span class="op">{</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="bu">length</span><span class="op">(</span>p <span class="op">-</span> c<span class="op">.</span><span class="fu">center</span><span class="op">)</span> <span class="op">&lt;</span> c<span class="op">.</span><span class="fu">radius</span><span class="op">;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> <span class="fu">isOutside</span><span class="op">(</span><span class="dt">vec2</span> p<span class="op">,</span> Circle c<span class="op">)</span> <span class="op">{</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="bu">length</span><span class="op">(</span>p <span class="op">-</span> c<span class="op">.</span><span class="fu">center</span><span class="op">)</span> <span class="op">&gt;</span> c<span class="op">.</span><span class="fu">radius</span><span class="op">;</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The iteration: keep inverting until the point lands in a “gap” (inside outer, outside all inner circles) or we hit a maximum iteration count.</p>
</section>
<section id="full-implementation-1" class="level3">
<h3 class="anchored" data-anchor-id="full-implementation-1">Full Implementation</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Circle <span class="op">{</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> center<span class="op">;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> radius<span class="op">;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> <span class="fu">invert</span><span class="op">(</span><span class="dt">vec2</span> p<span class="op">,</span> Circle c<span class="op">)</span> <span class="op">{</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> d <span class="op">=</span> p <span class="op">-</span> c<span class="op">.</span><span class="fu">center</span><span class="op">;</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> c<span class="op">.</span><span class="fu">center</span> <span class="op">+</span> c<span class="op">.</span><span class="fu">radius</span> <span class="op">*</span> c<span class="op">.</span><span class="fu">radius</span> <span class="op">*</span> d <span class="op">/</span> <span class="bu">dot</span><span class="op">(</span>d<span class="op">,</span> d<span class="op">);</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> <span class="fu">distToCircle</span><span class="op">(</span><span class="dt">vec2</span> p<span class="op">,</span> Circle c<span class="op">)</span> <span class="op">{</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="bu">abs</span><span class="op">(</span><span class="bu">length</span><span class="op">(</span>p <span class="op">-</span> c<span class="op">.</span><span class="fu">center</span><span class="op">)</span> <span class="op">-</span> c<span class="op">.</span><span class="fu">radius</span><span class="op">);</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> <span class="fu">isInside</span><span class="op">(</span><span class="dt">vec2</span> p<span class="op">,</span> Circle c<span class="op">)</span> <span class="op">{</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="bu">length</span><span class="op">(</span>p <span class="op">-</span> c<span class="op">.</span><span class="fu">center</span><span class="op">)</span> <span class="op">&lt;</span> c<span class="op">.</span><span class="fu">radius</span><span class="op">;</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">mainImage</span><span class="op">(</span><span class="dt">out</span> <span class="dt">vec4</span> fragColor<span class="op">,</span> <span class="dt">in</span> <span class="dt">vec2</span> fragCoord<span class="op">)</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> uv <span class="op">=</span> fragCoord <span class="op">/</span> iResolution<span class="op">.</span><span class="fu">xy</span><span class="op">;</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>    uv <span class="op">=</span> uv <span class="op">-</span> <span class="dt">vec2</span><span class="op">(</span><span class="fl">0.5</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">);</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>    uv<span class="op">.</span><span class="fu">x</span> <span class="op">*=</span> iResolution<span class="op">.</span><span class="fu">x</span> <span class="op">/</span> iResolution<span class="op">.</span><span class="fu">y</span><span class="op">;</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> p <span class="op">=</span> uv <span class="op">*</span> <span class="fl">6.0</span><span class="op">;</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Setup circles with correct geometry</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> r <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> triSide <span class="op">=</span> <span class="fl">2.0</span> <span class="op">*</span> r<span class="op">;</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> circumradius <span class="op">=</span> triSide <span class="op">/</span> <span class="bu">sqrt</span><span class="op">(</span><span class="fl">3.0</span><span class="op">);</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>    Circle c1 <span class="op">=</span> <span class="fu">Circle</span><span class="op">(</span><span class="dt">vec2</span><span class="op">(</span><span class="fl">0.0</span><span class="op">,</span> circumradius<span class="op">),</span> r<span class="op">);</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>    Circle c2 <span class="op">=</span> <span class="fu">Circle</span><span class="op">(</span><span class="dt">vec2</span><span class="op">(-</span>circumradius <span class="op">*</span> <span class="fl">0.866</span><span class="op">,</span> <span class="op">-</span>circumradius <span class="op">*</span> <span class="fl">0.5</span><span class="op">),</span> r<span class="op">);</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>    Circle c3 <span class="op">=</span> <span class="fu">Circle</span><span class="op">(</span><span class="dt">vec2</span><span class="op">(</span>circumradius <span class="op">*</span> <span class="fl">0.866</span><span class="op">,</span> <span class="op">-</span>circumradius <span class="op">*</span> <span class="fl">0.5</span><span class="op">),</span> r<span class="op">);</span></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>    Circle outer <span class="op">=</span> <span class="fu">Circle</span><span class="op">(</span><span class="dt">vec2</span><span class="op">(</span><span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">),</span> circumradius <span class="op">+</span> r<span class="op">);</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Iterate inversions</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> max_iter <span class="op">=</span> <span class="dv">50</span><span class="op">;</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> iter<span class="op">;</span></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> <span class="op">(</span>iter <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> iter <span class="op">&lt;</span> max_iter<span class="op">;</span> iter<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span><span class="fu">isInside</span><span class="op">(</span>p<span class="op">,</span> c1<span class="op">))</span> <span class="op">{</span></span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>            p <span class="op">=</span> <span class="fu">invert</span><span class="op">(</span>p<span class="op">,</span> c1<span class="op">);</span></span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu">isInside</span><span class="op">(</span>p<span class="op">,</span> c2<span class="op">))</span> <span class="op">{</span></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>            p <span class="op">=</span> <span class="fu">invert</span><span class="op">(</span>p<span class="op">,</span> c2<span class="op">);</span></span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu">isInside</span><span class="op">(</span>p<span class="op">,</span> c3<span class="op">))</span> <span class="op">{</span></span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>            p <span class="op">=</span> <span class="fu">invert</span><span class="op">(</span>p<span class="op">,</span> c3<span class="op">);</span></span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(!</span><span class="fu">isInside</span><span class="op">(</span>p<span class="op">,</span> outer<span class="op">))</span> <span class="op">{</span></span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a>            p <span class="op">=</span> <span class="fu">invert</span><span class="op">(</span>p<span class="op">,</span> outer<span class="op">);</span></span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a>            <span class="kw">break</span><span class="op">;</span>  <span class="co">// In the gap—done!</span></span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Color by iteration count</span></span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> t <span class="op">=</span> <span class="dt">float</span><span class="op">(</span>iter<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span>max_iter<span class="op">);</span></span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec3</span> color <span class="op">=</span> <span class="fu">palette</span><span class="op">(</span>t<span class="op">);</span></span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Draw circle boundaries</span></span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> dMin <span class="op">=</span> <span class="bu">min</span><span class="op">(</span><span class="bu">min</span><span class="op">(</span><span class="fu">distToCircle</span><span class="op">(</span>p<span class="op">,</span> c1<span class="op">),</span> <span class="fu">distToCircle</span><span class="op">(</span>p<span class="op">,</span> c2<span class="op">)),</span> </span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a>                     <span class="bu">min</span><span class="op">(</span><span class="fu">distToCircle</span><span class="op">(</span>p<span class="op">,</span> c3<span class="op">),</span> <span class="fu">distToCircle</span><span class="op">(</span>p<span class="op">,</span> outer<span class="op">)));</span></span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>dMin <span class="op">&lt;</span> <span class="fl">0.02</span><span class="op">)</span> color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a>    fragColor <span class="op">=</span> <span class="dt">vec4</span><span class="op">(</span>color<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<figure class="shader-demo figure">
  <div id="demo-day2-apollonian-iterated" style="width: 100%; height: ;"></div>
  <script type="module">
    import { embed } from '/demos/day2/apollonian-iterated/embed.js';
    await embed({ container: '#demo-day2-apollonian-iterated' });
  </script>
  
</figure>

</section>
<section id="visualizing-the-limit-set" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-the-limit-set">Visualizing the Limit Set</h3>
<p>The <strong>limit set</strong> of the Apollonian gasket is the fractal boundary—the set of points that never escape to the fundamental domain, no matter how many iterations. Points near the limit set take many iterations before landing in a gap.</p>
<p>We can emphasize the limit set by adjusting our coloring. Instead of using a color palette, we use a nonlinear function that suppresses low iteration counts (the “background”) and brightens high iteration counts (near the fractal):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> t <span class="op">=</span> <span class="dt">float</span><span class="op">(</span>iter<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span>max_iter<span class="op">);</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="dt">vec3</span> color <span class="op">=</span> <span class="fl">30.0</span> <span class="op">*</span> <span class="dt">vec3</span><span class="op">(</span><span class="bu">pow</span><span class="op">(</span>t<span class="op">,</span> <span class="fl">2.0</span><span class="op">));</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The squaring suppresses points that escape quickly, while the factor of 30 boosts the brightness of points near the limit set.</p>
<figure class="shader-demo figure">
  <div id="demo-day2-apollonian-final" style="width: 100%; height: ;"></div>
  <script type="module">
    import { embed } from '/demos/day2/apollonian-final/embed.js';
    await embed({ container: '#demo-day2-apollonian-final' });
  </script>
  
</figure>

</section>
</section>
<section id="exercises" class="level2" data-number="2.8">
<h2 data-number="2.8" class="anchored" data-anchor-id="exercises"><span class="header-section-number">2.8</span> Exercises</h2>
<section id="checkpoints" class="level3">
<h3 class="anchored" data-anchor-id="checkpoints">Checkpoints</h3>
<p><strong>C1. Julia Set.</strong> Modify the Mandelbrot shader to render a Julia set. Fix <code>c = vec2(-0.7, 0.27015)</code> and initialize <code>z</code> from the pixel position instead of zero. Verify you get an intricate, connected fractal.</p>
<p><strong>C2. Cubic Mandelbrot.</strong> Change the iteration from <span class="math inline">\(z^2 + c\)</span> to <span class="math inline">\(z^3 + c\)</span>. You’ll need to implement complex cubing:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb28"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> <span class="fu">ccube</span><span class="op">(</span><span class="dt">vec2</span> z<span class="op">)</span> <span class="op">{</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="fu">cmul</span><span class="op">(</span><span class="fu">cmul</span><span class="op">(</span>z<span class="op">,</span> z<span class="op">),</span> z<span class="op">);</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>What symmetry do you observe?</p>
<p><strong>C3. Apollonian Animation.</strong> Animate the Apollonian gasket by letting the maximum iteration count grow with time. Use <code>int max_iter = int(mod(iTime * 5.0, 50.0)) + 1;</code> so the fractal “builds up” from the four starting circles to the full gasket, then resets. Watch how each iteration reveals a new layer of circles in the gaps.</p>
<p><strong>C4. Colorize a Fractal.</strong> Take any of the black-and-white fractals from today (Mandelbrot, Julia, Burning Ship, or Apollonian) and add color using the cosine palette:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec3</span> <span class="fu">palette</span><span class="op">(</span><span class="dt">float</span> t<span class="op">)</span> <span class="op">{</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec3</span> a <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.5</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">);</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec3</span> b <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.5</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">);</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec3</span> c <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">1.0</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec3</span> d <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.00</span><span class="op">,</span> <span class="fl">0.33</span><span class="op">,</span> <span class="fl">0.67</span><span class="op">);</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> a <span class="op">+</span> b <span class="op">*</span> <span class="bu">cos</span><span class="op">(</span><span class="fl">6.28318</span> <span class="op">*</span> <span class="op">(</span>c <span class="op">*</span> t <span class="op">+</span> d<span class="op">));</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Experiment with different values of <code>d</code> to shift the hues.</p>
<p><strong>C5. Circle Art.</strong> Create an image with several circles of different sizes scattered across the screen. Color a pixel based on whether it’s inside zero, one, two, or more circles. (Hint: use <code>isInside</code> and count how many circles contain each point.)</p>
</section>
<section id="explorations" class="level3">
<h3 class="anchored" data-anchor-id="explorations">Explorations</h3>
<p><strong>E1. Julia Explorer (Mouse).</strong> Make the Julia parameter <code>c</code> follow the mouse position. Map <code>iMouse.xy</code> to a reasonable region of the complex plane (say, <span class="math inline">\([-2, 2] \times [-2, 2]\)</span>). Drag around and watch the Julia set morph!</p>
<p><strong>E2. Julia Animation.</strong> Animate the parameter <code>c</code> along a path in the complex plane. Try a circle:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb30"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> angle <span class="op">=</span> iTime <span class="op">*</span> <span class="fl">0.3</span><span class="op">;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> c <span class="op">=</span> <span class="fl">0.7885</span> <span class="op">*</span> <span class="dt">vec2</span><span class="op">(</span><span class="bu">cos</span><span class="op">(</span>angle<span class="op">),</span> <span class="bu">sin</span><span class="op">(</span>angle<span class="op">));</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Or trace the boundary of the main cardioid of the Mandelbrot set—every point on this curve gives a Julia set with a parabolic fixed point:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb31"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> <span class="fu">cardioid</span><span class="op">(</span><span class="dt">float</span> t<span class="op">)</span> <span class="op">{</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> eit <span class="op">=</span> <span class="dt">vec2</span><span class="op">(</span><span class="bu">cos</span><span class="op">(</span>t<span class="op">),</span> <span class="bu">sin</span><span class="op">(</span>t<span class="op">));</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> z <span class="op">=</span> <span class="op">(</span><span class="dt">vec2</span><span class="op">(</span><span class="fl">2.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">)</span> <span class="op">-</span> eit<span class="op">)</span> <span class="op">/</span> <span class="fl">4.0</span><span class="op">;</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="fu">cmul</span><span class="op">(</span>eit<span class="op">,</span> z<span class="op">);</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> c <span class="op">=</span> <span class="fu">cardioid</span><span class="op">(</span>iTime <span class="op">*</span> <span class="fl">0.5</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Watch the Julia set continuously transform. What happens when <code>c</code> crosses from inside to outside the Mandelbrot set?</p>
<p><strong>E3. Other Escape-Time Fractals.</strong> Implement one or more of these variations on the Mandelbrot iteration:</p>
<ul>
<li><strong>Burning Ship</strong>: <span class="math inline">\(z \leftarrow z^2\)</span>, then <span class="math inline">\(\text{Im}(z) \leftarrow |\text{Im}(z)|\)</span>, then <span class="math inline">\(z \leftarrow z + c\)</span></li>
<li><strong>Tricorn</strong> (Mandelbar): <span class="math inline">\(z_{n+1} = \bar{z}_n^2 + c\)</span> where <span class="math inline">\(\bar{z}\)</span> is the complex conjugate</li>
<li><strong>Celtic</strong>: <span class="math inline">\(z_{n+1} = |\text{Re}(z_n^2)| + i\,\text{Im}(z_n^2) + c\)</span></li>
</ul>
<p>For each, figure out how to translate the mathematical formula into GLSL. The escape condition (<span class="math inline">\(|z| &gt; 2\)</span>) stays the same.</p>
<p><strong>E4. Smooth Coloring.</strong> The iteration count is an integer, so coloring by iteration gives discrete bands. But when a point escapes, it doesn’t land exactly on the escape radius—it overshoots. We can use <em>how much</em> it overshot to interpolate between iteration counts.</p>
<p>The idea: if <span class="math inline">\(|z_n| &gt; 2\)</span>, the “true” fractional iteration where <span class="math inline">\(|z| = 2\)</span> is approximately: <span class="math display">\[n_{\text{smooth}} = n - \frac{\log(\log|z_n|/\log 2)}{\log 2}\]</span></p>
<p>This comes from the fact that near escape, <span class="math inline">\(|z_{n+1}| \approx |z_n|^2\)</span>, so <span class="math inline">\(\log|z|\)</span> roughly doubles each iteration.</p>
<p>Implement this for the Mandelbrot set:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb32"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span>iter <span class="op">&lt;</span> max_iter<span class="op">)</span> <span class="op">{</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> log_zn <span class="op">=</span> <span class="bu">log</span><span class="op">(</span><span class="fu">cabs2</span><span class="op">(</span>z<span class="op">))</span> <span class="op">/</span> <span class="fl">2.0</span><span class="op">;</span>  <span class="co">// log|z|</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> nu <span class="op">=</span> <span class="bu">log</span><span class="op">(</span>log_zn <span class="op">/</span> <span class="bu">log</span><span class="op">(</span><span class="fl">2.0</span><span class="op">))</span> <span class="op">/</span> <span class="bu">log</span><span class="op">(</span><span class="fl">2.0</span><span class="op">);</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> smooth_iter <span class="op">=</span> <span class="dt">float</span><span class="op">(</span>iter<span class="op">)</span> <span class="op">+</span> <span class="fl">1.0</span> <span class="op">-</span> nu<span class="op">;</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> smooth_iter <span class="op">/</span> <span class="dt">float</span><span class="op">(</span>max_iter<span class="op">);</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The bands should disappear, replaced by smooth gradients.</p>
<p><strong>E5. Apollonian Coloring.</strong> Modify the Apollonian gasket to color by <em>which circle</em> was last inverted through, instead of iteration count. Use a different color for each of the four circles. What patterns emerge?</p>
<p><strong>E6. Apollonian Variations.</strong> The Apollonian gasket works with <em>any</em> four mutually tangent circles—the symmetric configuration we used is just one example. Descartes’ Circle Theorem tells us: if four circles are mutually tangent with curvatures <span class="math inline">\(k_1, k_2, k_3, k_4\)</span> (where curvature = 1/radius, negative for the outer circle), then: <span class="math display">\[(k_1 + k_2 + k_3 + k_4)^2 = 2(k_1^2 + k_2^2 + k_3^2 + k_4^2)\]</span> Experiment with different configurations: - Change the radii of the three inner circles (they don’t have to be equal!) - Use Descartes’ theorem to find an outer circle tangent to three given inner circles - What happens if the circles overlap instead of being tangent?</p>
</section>
<section id="challenges" class="level3">
<h3 class="anchored" data-anchor-id="challenges">Challenges</h3>
<p><strong>H1. Julia Explorer (Full).</strong> Build an interactive tool: display the Mandelbrot set, and wherever the user clicks, show the Julia set for that parameter overlaid or side-by-side. This requires: - Rendering Mandelbrot in one region - Reading click position from <code>iMouse</code> - Rendering Julia for that <code>c</code> in another region (or blended on top)</p>
<p><strong>H2. Newton Fractal.</strong> The Newton fractal comes from applying Newton’s method to find roots of a polynomial. For <span class="math inline">\(f(z) = z^3 - 1\)</span>, Newton’s iteration is: <span class="math display">\[z_{n+1} = z_n - \frac{f(z_n)}{f'(z_n)} = z_n - \frac{z_n^3 - 1}{3z_n^2} = \frac{2z_n^3 + 1}{3z_n^2}\]</span> Iterate this and color based on <em>which root</em> the orbit converges to (the three cube roots of unity: <span class="math inline">\(1\)</span>, <span class="math inline">\(e^{2\pi i/3}\)</span>, <span class="math inline">\(e^{4\pi i/3}\)</span>). Check convergence by testing if <span class="math inline">\(|z^3 - 1| &lt; \epsilon\)</span>.</p>
<p><strong>H3. Higher-Power Mandelbrot.</strong> Implement <span class="math inline">\(z^n + c\)</span> for general <span class="math inline">\(n\)</span>. Use the polar form: if <span class="math inline">\(z = re^{i\theta}\)</span>, then <span class="math inline">\(z^n = r^n e^{in\theta}\)</span>. In code:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb33"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> <span class="fu">cpow</span><span class="op">(</span><span class="dt">vec2</span> z<span class="op">,</span> <span class="dt">float</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> r <span class="op">=</span> <span class="bu">length</span><span class="op">(</span>z<span class="op">);</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> theta <span class="op">=</span> <span class="bu">atan</span><span class="op">(</span>z<span class="op">.</span><span class="fu">y</span><span class="op">,</span> z<span class="op">.</span><span class="fu">x</span><span class="op">);</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> rn <span class="op">=</span> <span class="bu">pow</span><span class="op">(</span>r<span class="op">,</span> n<span class="op">);</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> rn <span class="op">*</span> <span class="dt">vec2</span><span class="op">(</span><span class="bu">cos</span><span class="op">(</span>n <span class="op">*</span> theta<span class="op">),</span> <span class="bu">sin</span><span class="op">(</span>n <span class="op">*</span> theta<span class="op">));</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Try non-integer values of <span class="math inline">\(n\)</span>! What happens at <span class="math inline">\(n = 2.5\)</span>?</p>
</section>
<section id="projects" class="level3">
<h3 class="anchored" data-anchor-id="projects">Projects</h3>
<p><strong>Project 1: Grid of Julia Sets</strong></p>
<p>Create a grid where each cell shows the Julia set for a different value of <span class="math inline">\(c\)</span>. The position in the grid determines <span class="math inline">\(c\)</span>—effectively, each cell samples a point in the Mandelbrot parameter space.</p>
<p>When you zoom out, the overall pattern should reveal the Mandelbrot set: cells with connected Julia sets (solid regions) correspond to <span class="math inline">\(c \in \mathcal{M}\)</span>, while cells with dust-like Julia sets correspond to <span class="math inline">\(c \notin \mathcal{M}\)</span>.</p>
<p>Use the grid technique from Day 1:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb34"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> grid_size <span class="op">=</span> <span class="fl">8.0</span><span class="op">;</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> cell_id <span class="op">=</span> <span class="bu">floor</span><span class="op">((</span>p <span class="op">+</span> <span class="fl">2.0</span><span class="op">)</span> <span class="op">*</span> grid_size <span class="op">/</span> <span class="fl">4.0</span><span class="op">);</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> cell_p <span class="op">=</span> <span class="bu">fract</span><span class="op">((</span>p <span class="op">+</span> <span class="fl">2.0</span><span class="op">)</span> <span class="op">*</span> grid_size <span class="op">/</span> <span class="fl">4.0</span><span class="op">)</span> <span class="op">*</span> <span class="fl">4.0</span> <span class="op">-</span> <span class="fl">2.0</span><span class="op">;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">// c comes from which cell we're in</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> c <span class="op">=</span> <span class="op">(</span>cell_id <span class="op">/</span> grid_size<span class="op">)</span> <span class="op">*</span> <span class="fl">4.0</span> <span class="op">-</span> <span class="fl">2.0</span><span class="op">;</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co">// z starts from position within the cell</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> z <span class="op">=</span> cell_p<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Project 2: Orbit Visualization</strong></p>
<p>Instead of just coloring by iteration count, visualize the actual orbit of a point. Make the starting point draggable with the mouse:</p>
<ul>
<li>Let <span class="math inline">\(z_0\)</span> be the mouse position (normalized to the complex plane)</li>
<li>Fix a parameter <span class="math inline">\(c\)</span> (or let it be controllable too)</li>
<li>Compute the first <span class="math inline">\(N\)</span> iterates: <span class="math inline">\(z_0, z_1, z_2, \ldots, z_N\)</span></li>
<li>Draw small circles at each iterate position</li>
<li>Connect consecutive iterates with lines (use the segment SDF from Day 1!)</li>
<li>Color by iteration index (early iterates one color, later iterates another)</li>
</ul>
<p>This reveals the dynamics directly: bounded orbits stay in a region and may converge to a cycle, while escaping orbits spiral outward. Drag the starting point around and watch how the orbit changes—you’ll see the sensitive dependence on initial conditions that makes chaos!</p>
<p>For Julia sets, fix <code>c</code> and drag <code>z_0</code>. For the Mandelbrot perspective, fix <code>z_0 = 0</code> and drag <code>c</code>.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../lectures/day1.html" class="pagination-link" aria-label="Day 1: Introduction">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Day 1: Introduction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../lectures/day3.html" class="pagination-link" aria-label="Day 3: Tilings">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Day 3: Tilings</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>