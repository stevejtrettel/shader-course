<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Appendix C — Folding Fractals – GPU-Accelerated Mathematical Illustration</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./debug-reference.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-86daaaaad7353f9cc0c554efc1dd6d94.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-f8dc6eab18fde03278982b0b35885446.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-ed04f5f1653af6df52378e13bfdac05e.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-d37bfdfd9a2222927534875c15a9020f.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./glsl-reference.html">Appendices</a></li><li class="breadcrumb-item"><a href="./folding-fractals.html"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Folding Fractals</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">GPU-Accelerated Mathematical Illustration</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/yourusername/shader-course" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./GPU-Accelerated-Mathematical-Illustration.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./outline.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Outline</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./day1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Day 1: Introduction to Shader Programming</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./day2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Day 2: Complex Dynamics and Iterated Inversions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./day3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Day 3: Geometric Tilings in Euclidean and Hyperbolic Space</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./day4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Day 4: Introduction to 3D Rendering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./day5a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Day 5a</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./day5b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Day 5bs</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./glsl-reference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">GLSL</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./debug-reference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Debugging</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./folding-fractals.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Folding Fractals</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><span class="header-section-number">C.1</span> Overview</a></li>
  <li><a href="#fundamental-concept-folding-scaling-fractals" id="toc-fundamental-concept-folding-scaling-fractals" class="nav-link" data-scroll-target="#fundamental-concept-folding-scaling-fractals"><span class="header-section-number">C.2</span> Fundamental Concept: Folding + Scaling = Fractals</a>
  <ul class="collapse">
  <li><a href="#the-general-pattern" id="toc-the-general-pattern" class="nav-link" data-scroll-target="#the-general-pattern">The General Pattern</a></li>
  <li><a href="#connection-to-tilings" id="toc-connection-to-tilings" class="nav-link" data-scroll-target="#connection-to-tilings">Connection to Tilings</a></li>
  </ul></li>
  <li><a href="#sierpinski-triangle" id="toc-sierpinski-triangle" class="nav-link" data-scroll-target="#sierpinski-triangle"><span class="header-section-number">C.3</span> Sierpinski Triangle</a>
  <ul class="collapse">
  <li><a href="#mathematical-description" id="toc-mathematical-description" class="nav-link" data-scroll-target="#mathematical-description">Mathematical Description</a></li>
  <li><a href="#mathematical-foundation-reflection-across-a-line" id="toc-mathematical-foundation-reflection-across-a-line" class="nav-link" data-scroll-target="#mathematical-foundation-reflection-across-a-line">Mathematical Foundation: Reflection Across a Line</a></li>
  <li><a href="#line-struct" id="toc-line-struct" class="nav-link" data-scroll-target="#line-struct">Line Struct</a></li>
  <li><a href="#setting-up-the-triangle" id="toc-setting-up-the-triangle" class="nav-link" data-scroll-target="#setting-up-the-triangle">Setting Up the Triangle</a></li>
  <li><a href="#the-folding-algorithm" id="toc-the-folding-algorithm" class="nav-link" data-scroll-target="#the-folding-algorithm">The Folding Algorithm</a></li>
  <li><a href="#the-folding-algorithm-1" id="toc-the-folding-algorithm-1" class="nav-link" data-scroll-target="#the-folding-algorithm-1">The Folding Algorithm</a></li>
  <li><a href="#adding-the-scaling-step" id="toc-adding-the-scaling-step" class="nav-link" data-scroll-target="#adding-the-scaling-step">Adding the Scaling Step</a></li>
  <li><a href="#determining-if-point-is-in-fractal" id="toc-determining-if-point-is-in-fractal" class="nav-link" data-scroll-target="#determining-if-point-is-in-fractal">Determining if Point is in Fractal</a></li>
  <li><a href="#complete-implementation" id="toc-complete-implementation" class="nav-link" data-scroll-target="#complete-implementation">Complete Implementation</a></li>
  <li><a href="#visualization" id="toc-visualization" class="nav-link" data-scroll-target="#visualization">Visualization</a></li>
  </ul></li>
  <li><a href="#sierpinski-carpet" id="toc-sierpinski-carpet" class="nav-link" data-scroll-target="#sierpinski-carpet"><span class="header-section-number">C.4</span> Sierpinski Carpet</a>
  <ul class="collapse">
  <li><a href="#mathematical-description-1" id="toc-mathematical-description-1" class="nav-link" data-scroll-target="#mathematical-description-1">Mathematical Description</a></li>
  <li><a href="#the-algorithm" id="toc-the-algorithm" class="nav-link" data-scroll-target="#the-algorithm">The Algorithm</a></li>
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation">Implementation</a></li>
  <li><a href="#more-robust-version" id="toc-more-robust-version" class="nav-link" data-scroll-target="#more-robust-version">More Robust Version</a></li>
  <li><a href="#clean-implementation" id="toc-clean-implementation" class="nav-link" data-scroll-target="#clean-implementation">Clean Implementation</a></li>
  <li><a href="#visualization-1" id="toc-visualization-1" class="nav-link" data-scroll-target="#visualization-1">Visualization</a></li>
  </ul></li>
  <li><a href="#menger-sponge-3d-extension" id="toc-menger-sponge-3d-extension" class="nav-link" data-scroll-target="#menger-sponge-3d-extension"><span class="header-section-number">C.5</span> Menger Sponge (3D Extension)</a>
  <ul class="collapse">
  <li><a href="#mathematical-description-2" id="toc-mathematical-description-2" class="nav-link" data-scroll-target="#mathematical-description-2">Mathematical Description</a></li>
  <li><a href="#the-algorithm-1" id="toc-the-algorithm-1" class="nav-link" data-scroll-target="#the-algorithm-1">The Algorithm</a></li>
  <li><a href="#implementation-1" id="toc-implementation-1" class="nav-link" data-scroll-target="#implementation-1">Implementation</a></li>
  <li><a href="#alternative-using-sdf-approach" id="toc-alternative-using-sdf-approach" class="nav-link" data-scroll-target="#alternative-using-sdf-approach">Alternative: Using SDF Approach</a></li>
  <li><a href="#rendering-with-raymarching" id="toc-rendering-with-raymarching" class="nav-link" data-scroll-target="#rendering-with-raymarching">Rendering with Raymarching</a></li>
  </ul></li>
  <li><a href="#general-principles-of-folding-fractals" id="toc-general-principles-of-folding-fractals" class="nav-link" data-scroll-target="#general-principles-of-folding-fractals"><span class="header-section-number">C.6</span> General Principles of Folding Fractals</a>
  <ul class="collapse">
  <li><a href="#key-ingredients" id="toc-key-ingredients" class="nav-link" data-scroll-target="#key-ingredients">Key Ingredients</a></li>
  <li><a href="#fractal-dimension" id="toc-fractal-dimension" class="nav-link" data-scroll-target="#fractal-dimension">Fractal Dimension</a></li>
  </ul></li>
  <li><a href="#coloring-strategies" id="toc-coloring-strategies" class="nav-link" data-scroll-target="#coloring-strategies"><span class="header-section-number">C.7</span> Coloring Strategies</a>
  <ul class="collapse">
  <li><a href="#by-iteration-depth" id="toc-by-iteration-depth" class="nav-link" data-scroll-target="#by-iteration-depth">By Iteration Depth</a></li>
  <li><a href="#by-distance-after-folding" id="toc-by-distance-after-folding" class="nav-link" data-scroll-target="#by-distance-after-folding">By Distance After Folding</a></li>
  <li><a href="#by-cell-position" id="toc-by-cell-position" class="nav-link" data-scroll-target="#by-cell-position">By Cell Position</a></li>
  <li><a href="#hybrid-distance-field-fractal" id="toc-hybrid-distance-field-fractal" class="nav-link" data-scroll-target="#hybrid-distance-field-fractal">Hybrid: Distance Field + Fractal</a></li>
  </ul></li>
  <li><a href="#variations-and-experiments" id="toc-variations-and-experiments" class="nav-link" data-scroll-target="#variations-and-experiments"><span class="header-section-number">C.8</span> Variations and Experiments</a>
  <ul class="collapse">
  <li><a href="#different-folding-operations" id="toc-different-folding-operations" class="nav-link" data-scroll-target="#different-folding-operations">Different Folding Operations</a></li>
  <li><a href="#different-scale-factors" id="toc-different-scale-factors" class="nav-link" data-scroll-target="#different-scale-factors">Different Scale Factors</a></li>
  <li><a href="#animated-parameters" id="toc-animated-parameters" class="nav-link" data-scroll-target="#animated-parameters">Animated Parameters</a></li>
  <li><a href="#color-by-orbit" id="toc-color-by-orbit" class="nav-link" data-scroll-target="#color-by-orbit">Color by Orbit</a></li>
  <li><a href="#d-variations" id="toc-d-variations" class="nav-link" data-scroll-target="#d-variations">3D Variations</a></li>
  </ul></li>
  <li><a href="#connection-to-course-topics" id="toc-connection-to-course-topics" class="nav-link" data-scroll-target="#connection-to-course-topics"><span class="header-section-number">C.9</span> Connection to Course Topics</a>
  <ul class="collapse">
  <li><a href="#day-2-iteration-creates-fractals" id="toc-day-2-iteration-creates-fractals" class="nav-link" data-scroll-target="#day-2-iteration-creates-fractals">Day 2: Iteration Creates Fractals</a></li>
  <li><a href="#day-3-folding-without-scaling" id="toc-day-3-folding-without-scaling" class="nav-link" data-scroll-target="#day-3-folding-without-scaling">Day 3: Folding Without Scaling</a></li>
  <li><a href="#day-4-3d-rendering" id="toc-day-4-3d-rendering" class="nav-link" data-scroll-target="#day-4-3d-rendering">Day 4: 3D Rendering</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">C.10</span> Exercises</a>
  <ul class="collapse">
  <li><a href="#exercise-1-hexagonal-sierpinski" id="toc-exercise-1-hexagonal-sierpinski" class="nav-link" data-scroll-target="#exercise-1-hexagonal-sierpinski">Exercise 1: Hexagonal Sierpinski</a></li>
  <li><a href="#exercise-2-animate-the-scale-factor" id="toc-exercise-2-animate-the-scale-factor" class="nav-link" data-scroll-target="#exercise-2-animate-the-scale-factor">Exercise 2: Animate the Scale Factor</a></li>
  <li><a href="#exercise-3-3d-cross" id="toc-exercise-3-3d-cross" class="nav-link" data-scroll-target="#exercise-3-3d-cross">Exercise 3: 3D Cross</a></li>
  <li><a href="#exercise-4-hybrid-fractal" id="toc-exercise-4-hybrid-fractal" class="nav-link" data-scroll-target="#exercise-4-hybrid-fractal">Exercise 4: Hybrid Fractal</a></li>
  <li><a href="#exercise-5-distance-colored-sponge" id="toc-exercise-5-distance-colored-sponge" class="nav-link" data-scroll-target="#exercise-5-distance-colored-sponge">Exercise 5: Distance-Colored Sponge</a></li>
  </ul></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading"><span class="header-section-number">C.11</span> Further Reading</a>
  <ul class="collapse">
  <li><a href="#mathematical-theory" id="toc-mathematical-theory" class="nav-link" data-scroll-target="#mathematical-theory">Mathematical Theory</a></li>
  <li><a href="#computational-techniques" id="toc-computational-techniques" class="nav-link" data-scroll-target="#computational-techniques">Computational Techniques</a></li>
  <li><a href="#applications" id="toc-applications" class="nav-link" data-scroll-target="#applications">Applications</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">C.12</span> Summary</a></li>
  <li><a href="#complete-example-animated-sierpinski-carpet" id="toc-complete-example-animated-sierpinski-carpet" class="nav-link" data-scroll-target="#complete-example-animated-sierpinski-carpet"><span class="header-section-number">C.13</span> Complete Example: Animated Sierpinski Carpet</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./glsl-reference.html">Appendices</a></li><li class="breadcrumb-item"><a href="./folding-fractals.html"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Folding Fractals</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Appendix C — Folding Fractals</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="overview" class="level2" data-number="C.1">
<h2 data-number="C.1" class="anchored" data-anchor-id="overview"><span class="header-section-number">C.1</span> Overview</h2>
<p>This appendix explores a fascinating technique for generating fractals: <strong>iterated folding with scaling</strong>. While reflection-based tiling (Days 2-3) fills space with copies of a fundamental domain, folding fractals add scaling at each iteration, creating self-similar structures that exhibit fractal geometry.</p>
<p>We’ll explore three classic examples: 1. <strong>Sierpinski Triangle</strong> (2D, triangle-based) 2. <strong>Sierpinski Carpet</strong> (2D, square-based) 3. <strong>Menger Sponge</strong> (3D, cube-based)</p>
<p>These connect naturally to course content: the folding operations use techniques from Day 2-3 (reflection, <code>abs()</code>), and the Menger sponge extends to 3D using Day 4’s coordinate systems.</p>
<hr>
</section>
<section id="fundamental-concept-folding-scaling-fractals" class="level2" data-number="C.2">
<h2 data-number="C.2" class="anchored" data-anchor-id="fundamental-concept-folding-scaling-fractals"><span class="header-section-number">C.2</span> Fundamental Concept: Folding + Scaling = Fractals</h2>
<section id="the-general-pattern" class="level3">
<h3 class="anchored" data-anchor-id="the-general-pattern">The General Pattern</h3>
<p>All folding fractals follow this pattern:</p>
<ol type="1">
<li><strong>Fold</strong>: Use geometric operations (reflection, <code>abs()</code>) to bring the point into a fundamental region</li>
<li><strong>Scale</strong>: Zoom in by some factor (typically 2 or 3)</li>
<li><strong>Repeat</strong>: Iterate this process</li>
<li><strong>Classify</strong>: After <span class="math inline">\(n\)</span> iterations, check if the point is in a “removed” region or “kept” region</li>
</ol>
<p>After <span class="math inline">\(n\)</span> iterations: - We’ve zoomed in by factor <span class="math inline">\(s^n\)</span> (where <span class="math inline">\(s\)</span> is the scale factor) - The fractal structure emerges from the removal pattern - The result is self-similar: zooming in reveals the same pattern</p>
</section>
<section id="connection-to-tilings" class="level3">
<h3 class="anchored" data-anchor-id="connection-to-tilings">Connection to Tilings</h3>
<p>Recall from Day 3: - <strong>Tiling</strong>: Fold → repeat (fills space with copies) - <strong>Fractal</strong>: Fold → scale → repeat (creates self-similar structure with removed regions)</p>
<p>The key difference is the scaling step!</p>
<hr>
</section>
</section>
<section id="sierpinski-triangle" class="level2" data-number="C.3">
<h2 data-number="C.3" class="anchored" data-anchor-id="sierpinski-triangle"><span class="header-section-number">C.3</span> Sierpinski Triangle</h2>
<section id="mathematical-description" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-description">Mathematical Description</h3>
<p>The Sierpinski triangle is constructed by: 1. Start with an equilateral triangle 2. Remove the middle triangle (formed by connecting edge midpoints) 3. Recursively repeat on each remaining sub-triangle</p>
<p>Equivalently: iteratively fold into the triangle and scale by 2.</p>
</section>
<section id="mathematical-foundation-reflection-across-a-line" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-foundation-reflection-across-a-line">Mathematical Foundation: Reflection Across a Line</h3>
<p>Before implementing the fractal, we need the correct reflection formula.</p>
<p>A line in the plane can be written as <span class="math inline">\(ax + by = c\)</span>, with normal vector <span class="math inline">\(\mathbf{n} = (a, b)\)</span>.</p>
<p><strong>Reflection formula:</strong> For a point <span class="math inline">\(\mathbf{p} = (x, y)\)</span>, the reflection <span class="math inline">\(\mathbf{p}'\)</span> across the line is:</p>
<p><span class="math display">\[\mathbf{p}' = \mathbf{p} - 2d\hat{\mathbf{n}}\]</span></p>
<p>where: - <span class="math inline">\(d = \frac{ax + by - c}{\sqrt{a^2 + b^2}}\)</span> is the signed distance to the line - <span class="math inline">\(\hat{\mathbf{n}} = \frac{(a,b)}{\sqrt{a^2 + b^2}}\)</span> is the unit normal</p>
<p>Combining these: <span class="math display">\[\mathbf{p}' = \mathbf{p} - \frac{2(ax + by - c)}{a^2 + b^2}(a, b)\]</span></p>
</section>
<section id="line-struct" class="level3">
<h3 class="anchored" data-anchor-id="line-struct">Line Struct</h3>
<p>Let’s organize line data properly:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Line <span class="op">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> a<span class="op">,</span> b<span class="op">,</span> c<span class="op">;</span>  <span class="co">// Line equation: ax + by = c</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> <span class="fu">reflectAcrossLine</span><span class="op">(</span><span class="dt">vec2</span> p<span class="op">,</span> Line line<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Signed distance from point to line (unnormalized)</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> dist <span class="op">=</span> line<span class="op">.</span><span class="fu">a</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">x</span> <span class="op">+</span> line<span class="op">.</span><span class="fu">b</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">y</span> <span class="op">-</span> line<span class="op">.</span><span class="fu">c</span><span class="op">;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Normal vector squared length</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> normSq <span class="op">=</span> line<span class="op">.</span><span class="fu">a</span> <span class="op">*</span> line<span class="op">.</span><span class="fu">a</span> <span class="op">+</span> line<span class="op">.</span><span class="fu">b</span> <span class="op">*</span> line<span class="op">.</span><span class="fu">b</span><span class="op">;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Reflection formula</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> normal <span class="op">=</span> <span class="dt">vec2</span><span class="op">(</span>line<span class="op">.</span><span class="fu">a</span><span class="op">,</span> line<span class="op">.</span><span class="fu">b</span><span class="op">);</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> p <span class="op">-</span> <span class="op">(</span><span class="fl">2.0</span> <span class="op">*</span> dist <span class="op">/</span> normSq<span class="op">)</span> <span class="op">*</span> normal<span class="op">;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="setting-up-the-triangle" class="level3">
<h3 class="anchored" data-anchor-id="setting-up-the-triangle">Setting Up the Triangle</h3>
<p>For an equilateral triangle with vertices: <span class="math display">\[v_0 = (0, 1), \quad v_1 = \left(-\frac{\sqrt{3}}{2}, -\frac{1}{2}\right), \quad v_2 = \left(\frac{\sqrt{3}}{2}, -\frac{1}{2}\right)\]</span></p>
<p>We need the three edge lines:</p>
<p><strong>Edge from <span class="math inline">\(v_0\)</span> to <span class="math inline">\(v_1\)</span>:</strong> Direction vector: <span class="math inline">\(v_1 - v_0 = (-\frac{\sqrt{3}}{2}, -\frac{3}{2})\)</span> Normal (perpendicular): <span class="math inline">\((\frac{3}{2}, -\frac{\sqrt{3}}{2})\)</span> or simplified: <span class="math inline">\((3, -\sqrt{3})\)</span> Line equation: <span class="math inline">\(3x - \sqrt{3}y = c\)</span>, passing through <span class="math inline">\(v_0 = (0,1)\)</span>: <span class="math inline">\(c = -\sqrt{3}\)</span></p>
<p><strong>Edge from <span class="math inline">\(v_1\)</span> to <span class="math inline">\(v_2\)</span>:</strong> This is horizontal: <span class="math inline">\(y = -\frac{1}{2}\)</span> Line equation: <span class="math inline">\(0x + 1y = -\frac{1}{2}\)</span> or <span class="math inline">\((0, 1, -0.5)\)</span></p>
<p><strong>Edge from <span class="math inline">\(v_2\)</span> to <span class="math inline">\(v_0\)</span>:</strong> By symmetry: <span class="math inline">\(-3x - \sqrt{3}y = -\sqrt{3}\)</span></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">setupTriangleEdges</span><span class="op">(</span><span class="dt">out</span> Line e1<span class="op">,</span> <span class="dt">out</span> Line e2<span class="op">,</span> <span class="dt">out</span> Line e3<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> sqrt3 <span class="op">=</span> <span class="fl">1.732</span><span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Edge v0 to v1</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    e1<span class="op">.</span><span class="fu">a</span> <span class="op">=</span> <span class="fl">3.0</span><span class="op">;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    e1<span class="op">.</span><span class="fu">b</span> <span class="op">=</span> <span class="op">-</span>sqrt3<span class="op">;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    e1<span class="op">.</span><span class="fu">c</span> <span class="op">=</span> <span class="op">-</span>sqrt3<span class="op">;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Edge v1 to v2 (horizontal)</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    e2<span class="op">.</span><span class="fu">a</span> <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    e2<span class="op">.</span><span class="fu">b</span> <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    e2<span class="op">.</span><span class="fu">c</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Edge v2 to v0</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    e3<span class="op">.</span><span class="fu">a</span> <span class="op">=</span> <span class="op">-</span><span class="fl">3.0</span><span class="op">;</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    e3<span class="op">.</span><span class="fu">b</span> <span class="op">=</span> <span class="op">-</span>sqrt3<span class="op">;</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    e3<span class="op">.</span><span class="fu">c</span> <span class="op">=</span> <span class="op">-</span>sqrt3<span class="op">;</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="the-folding-algorithm" class="level3">
<h3 class="anchored" data-anchor-id="the-folding-algorithm">The Folding Algorithm</h3>
<p>Now we can properly fold into the triangle:</p>
</section>
<section id="the-folding-algorithm-1" class="level3">
<h3 class="anchored" data-anchor-id="the-folding-algorithm-1">The Folding Algorithm</h3>
<p>Now we can properly fold into the triangle:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> <span class="fu">foldIntoTriangle</span><span class="op">(</span><span class="dt">vec2</span> p<span class="op">,</span> Line e1<span class="op">,</span> Line e2<span class="op">,</span> Line e3<span class="op">,</span> <span class="dt">int</span> maxIter<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> maxIter<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        <span class="dt">vec2</span> p_old <span class="op">=</span> p<span class="op">;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Reflect across each edge if we're on the wrong side</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Check sign of distance: if negative, we're on wrong side</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> d1 <span class="op">=</span> e1<span class="op">.</span><span class="fu">a</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">x</span> <span class="op">+</span> e1<span class="op">.</span><span class="fu">b</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">y</span> <span class="op">-</span> e1<span class="op">.</span><span class="fu">c</span><span class="op">;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span>d1 <span class="op">&lt;</span> <span class="fl">0.0</span><span class="op">)</span> p <span class="op">=</span> <span class="fu">reflectAcrossLine</span><span class="op">(</span>p<span class="op">,</span> e1<span class="op">);</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> d2 <span class="op">=</span> e2<span class="op">.</span><span class="fu">a</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">x</span> <span class="op">+</span> e2<span class="op">.</span><span class="fu">b</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">y</span> <span class="op">-</span> e2<span class="op">.</span><span class="fu">c</span><span class="op">;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span>d2 <span class="op">&lt;</span> <span class="fl">0.0</span><span class="op">)</span> p <span class="op">=</span> <span class="fu">reflectAcrossLine</span><span class="op">(</span>p<span class="op">,</span> e2<span class="op">);</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> d3 <span class="op">=</span> e3<span class="op">.</span><span class="fu">a</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">x</span> <span class="op">+</span> e3<span class="op">.</span><span class="fu">b</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">y</span> <span class="op">-</span> e3<span class="op">.</span><span class="fu">c</span><span class="op">;</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span>d3 <span class="op">&lt;</span> <span class="fl">0.0</span><span class="op">)</span> p <span class="op">=</span> <span class="fu">reflectAcrossLine</span><span class="op">(</span>p<span class="op">,</span> e3<span class="op">);</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Converged? (no more reflections)</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span><span class="bu">length</span><span class="op">(</span>p <span class="op">-</span> p_old<span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.0001</span><span class="op">)</span> <span class="kw">break</span><span class="op">;</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> p<span class="op">;</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="adding-the-scaling-step" class="level3">
<h3 class="anchored" data-anchor-id="adding-the-scaling-step">Adding the Scaling Step</h3>
<p>For the Sierpinski fractal, we fold and then scale:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> <span class="fu">sierpinskiTriangle</span><span class="op">(</span><span class="dt">vec2</span> p<span class="op">,</span> <span class="dt">int</span> iterations<span class="op">,</span> <span class="dt">out</span> <span class="dt">int</span> depth<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    Line e1<span class="op">,</span> e2<span class="op">,</span> e3<span class="op">;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setupTriangleEdges</span><span class="op">(</span>e1<span class="op">,</span> e2<span class="op">,</span> e3<span class="op">);</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    depth <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> iterations<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Fold into fundamental triangle</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="fu">foldIntoTriangle</span><span class="op">(</span>p<span class="op">,</span> e1<span class="op">,</span> e2<span class="op">,</span> e3<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Scale by 2 toward center</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">vec2</span> center <span class="op">=</span> <span class="dt">vec2</span><span class="op">(</span><span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">);</span>  <span class="co">// Approximate center</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="op">(</span>p <span class="op">-</span> center<span class="op">)</span> <span class="op">*</span> <span class="fl">2.0</span> <span class="op">+</span> center<span class="op">;</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        depth<span class="op">++;</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Optional: early exit if escaped</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span><span class="bu">length</span><span class="op">(</span>p<span class="op">)</span> <span class="op">&gt;</span> <span class="fl">100.0</span><span class="op">)</span> <span class="kw">break</span><span class="op">;</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> p<span class="op">;</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="determining-if-point-is-in-fractal" class="level3">
<h3 class="anchored" data-anchor-id="determining-if-point-is-in-fractal">Determining if Point is in Fractal</h3>
<p>After folding, we need to check if we’re in the “removed” middle triangle. Using barycentric coordinates:</p>
<pre><code>
### Determining if Point is in Fractal

After folding, we need to check if we're in the "removed" middle triangle. The middle triangle has vertices at the midpoints of the original triangle's edges.

For an equilateral triangle with vertices $v_0, v_1, v_2$, the midpoints are:
$$m_{01} = \frac{v_0 + v_1}{2}, \quad m_{12} = \frac{v_1 + v_2}{2}, \quad m_{20} = \frac{v_2 + v_0}{2}$$

We can check if point $p$ is inside this middle triangle using barycentric coordinates:

```glsl
bool inMiddleTriangle(vec2 p) {
    // Vertices of original triangle
    vec2 v0 = vec2(0.0, 1.0);
    vec2 v1 = vec2(-0.866, -0.5);
    vec2 v2 = vec2(0.866, -0.5);
    
    // Midpoints (vertices of removed triangle)
    vec2 m01 = (v0 + v1) * 0.5;
    vec2 m12 = (v1 + v2) * 0.5;
    vec2 m20 = (v2 + v0) * 0.5;
    
    // Check if p is inside triangle m01-m12-m20
    // Using sign of cross products
    vec2 e0 = m12 - m01;
    vec2 e1 = m20 - m12;
    vec2 e2 = m01 - m20;
    
    vec2 p0 = p - m01;
    vec2 p1 = p - m12;
    vec2 p2 = p - m20;
    
    float s0 = e0.x * p0.y - e0.y * p0.x;
    float s1 = e1.x * p1.y - e1.y * p1.x;
    float s2 = e2.x * p2.y - e2.y * p2.x;
    
    // All same sign means inside
    return (s0 &gt;= 0.0 &amp;&amp; s1 &gt;= 0.0 &amp;&amp; s2 &gt;= 0.0) || 
           (s0 &lt;= 0.0 &amp;&amp; s1 &lt;= 0.0 &amp;&amp; s2 &lt;= 0.0);
}</code></pre>
</section>
<section id="complete-implementation" class="level3">
<h3 class="anchored" data-anchor-id="complete-implementation">Complete Implementation</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Line <span class="op">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> a<span class="op">,</span> b<span class="op">,</span> c<span class="op">;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> <span class="fu">reflectAcrossLine</span><span class="op">(</span><span class="dt">vec2</span> p<span class="op">,</span> Line line<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> dist <span class="op">=</span> line<span class="op">.</span><span class="fu">a</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">x</span> <span class="op">+</span> line<span class="op">.</span><span class="fu">b</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">y</span> <span class="op">-</span> line<span class="op">.</span><span class="fu">c</span><span class="op">;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> normSq <span class="op">=</span> line<span class="op">.</span><span class="fu">a</span> <span class="op">*</span> line<span class="op">.</span><span class="fu">a</span> <span class="op">+</span> line<span class="op">.</span><span class="fu">b</span> <span class="op">*</span> line<span class="op">.</span><span class="fu">b</span><span class="op">;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> normal <span class="op">=</span> <span class="dt">vec2</span><span class="op">(</span>line<span class="op">.</span><span class="fu">a</span><span class="op">,</span> line<span class="op">.</span><span class="fu">b</span><span class="op">);</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> p <span class="op">-</span> <span class="op">(</span><span class="fl">2.0</span> <span class="op">*</span> dist <span class="op">/</span> normSq<span class="op">)</span> <span class="op">*</span> normal<span class="op">;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">setupTriangleEdges</span><span class="op">(</span><span class="dt">out</span> Line e1<span class="op">,</span> <span class="dt">out</span> Line e2<span class="op">,</span> <span class="dt">out</span> Line e3<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> sqrt3 <span class="op">=</span> <span class="fl">1.732</span><span class="op">;</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    e1 <span class="op">=</span> <span class="fu">Line</span><span class="op">(</span><span class="fl">3.0</span><span class="op">,</span> <span class="op">-</span>sqrt3<span class="op">,</span> <span class="op">-</span>sqrt3<span class="op">);</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    e2 <span class="op">=</span> <span class="fu">Line</span><span class="op">(</span><span class="fl">0.0</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">);</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    e3 <span class="op">=</span> <span class="fu">Line</span><span class="op">(-</span><span class="fl">3.0</span><span class="op">,</span> <span class="op">-</span>sqrt3<span class="op">,</span> <span class="op">-</span>sqrt3<span class="op">);</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> <span class="fu">sierpinskiTriangle</span><span class="op">(</span><span class="dt">vec2</span> p<span class="op">,</span> <span class="dt">int</span> iterations<span class="op">,</span> <span class="dt">out</span> <span class="dt">bool</span> inFractal<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    Line e1<span class="op">,</span> e2<span class="op">,</span> e3<span class="op">;</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setupTriangleEdges</span><span class="op">(</span>e1<span class="op">,</span> e2<span class="op">,</span> e3<span class="op">);</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    inFractal <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> iterations<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Fold into triangle</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span><span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>            <span class="dt">float</span> d1 <span class="op">=</span> e1<span class="op">.</span><span class="fu">a</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">x</span> <span class="op">+</span> e1<span class="op">.</span><span class="fu">b</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">y</span> <span class="op">-</span> e1<span class="op">.</span><span class="fu">c</span><span class="op">;</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span><span class="op">(</span>d1 <span class="op">&lt;</span> <span class="fl">0.0</span><span class="op">)</span> p <span class="op">=</span> <span class="fu">reflectAcrossLine</span><span class="op">(</span>p<span class="op">,</span> e1<span class="op">);</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>            <span class="dt">float</span> d2 <span class="op">=</span> e2<span class="op">.</span><span class="fu">a</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">x</span> <span class="op">+</span> e2<span class="op">.</span><span class="fu">b</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">y</span> <span class="op">-</span> e2<span class="op">.</span><span class="fu">c</span><span class="op">;</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span><span class="op">(</span>d2 <span class="op">&lt;</span> <span class="fl">0.0</span><span class="op">)</span> p <span class="op">=</span> <span class="fu">reflectAcrossLine</span><span class="op">(</span>p<span class="op">,</span> e2<span class="op">);</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>            <span class="dt">float</span> d3 <span class="op">=</span> e3<span class="op">.</span><span class="fu">a</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">x</span> <span class="op">+</span> e3<span class="op">.</span><span class="fu">b</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">y</span> <span class="op">-</span> e3<span class="op">.</span><span class="fu">c</span><span class="op">;</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span><span class="op">(</span>d3 <span class="op">&lt;</span> <span class="fl">0.0</span><span class="op">)</span> p <span class="op">=</span> <span class="fu">reflectAcrossLine</span><span class="op">(</span>p<span class="op">,</span> e3<span class="op">);</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Check if in removed region</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span><span class="fu">inMiddleTriangle</span><span class="op">(</span>p<span class="op">))</span> <span class="op">{</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>            inFractal <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Scale by 2</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> p <span class="op">*</span> <span class="fl">2.0</span><span class="op">;</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> p<span class="op">;</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="visualization" class="level3">
<h3 class="anchored" data-anchor-id="visualization">Visualization</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">mainImage</span><span class="op">(</span><span class="dt">out</span> <span class="dt">vec4</span> fragColor<span class="op">,</span> <span class="dt">in</span> <span class="dt">vec2</span> fragCoord<span class="op">)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> uv <span class="op">=</span> fragCoord <span class="op">/</span> iResolution<span class="op">.</span><span class="fu">xy</span><span class="op">;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    uv <span class="op">=</span> <span class="op">(</span>uv <span class="op">-</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">*</span> <span class="fl">3.0</span><span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    uv<span class="op">.</span><span class="fu">x</span> <span class="op">*=</span> iResolution<span class="op">.</span><span class="fu">x</span> <span class="op">/</span> iResolution<span class="op">.</span><span class="fu">y</span><span class="op">;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> inFractal<span class="op">;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> p_final <span class="op">=</span> <span class="fu">sierpinskiTriangle</span><span class="op">(</span>uv<span class="op">,</span> <span class="dv">6</span><span class="op">,</span> inFractal<span class="op">);</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec3</span> color<span class="op">;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span><span class="op">(</span>inFractal<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Color by final position</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> t <span class="op">=</span> <span class="bu">length</span><span class="op">(</span>p_final<span class="op">)</span> <span class="op">*</span> <span class="fl">0.1</span><span class="op">;</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> <span class="fu">palette</span><span class="op">(</span>t<span class="op">);</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Removed region</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.2</span><span class="op">);</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    fragColor <span class="op">=</span> <span class="dt">vec4</span><span class="op">(</span>color<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The Sierpinski triangle should now render with mathematically correct reflections!</p>
<hr>
</section>
</section>
<section id="sierpinski-carpet" class="level2" data-number="C.4">
<h2 data-number="C.4" class="anchored" data-anchor-id="sierpinski-carpet"><span class="header-section-number">C.4</span> Sierpinski Carpet</h2>
<section id="mathematical-description-1" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-description-1">Mathematical Description</h3>
<p>The Sierpinski carpet is the square analog: 1. Start with a square 2. Divide into a 3×3 grid of sub-squares 3. Remove the central sub-square 4. Recursively repeat on each remaining sub-square</p>
<p><strong>Note:</strong> Unlike the triangle, the carpet uses axis-aligned divisions, so the implementation is both simpler AND mathematically exact—no approximations needed!</p>
</section>
<section id="the-algorithm" class="level3">
<h3 class="anchored" data-anchor-id="the-algorithm">The Algorithm</h3>
<p>Much simpler than the triangle because we can use axis-aligned operations!</p>
<p>At each iteration: 1. <strong>Fold</strong> using <code>abs()</code> to create 4-fold symmetry (all quadrants map to first quadrant) 2. <strong>Scale</strong> by factor of 3 3. <strong>Check</strong> if we’re in the removed middle region</p>
</section>
<section id="implementation" class="level3">
<h3 class="anchored" data-anchor-id="implementation">Implementation</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> <span class="fu">sierpinskiCarpet</span><span class="op">(</span><span class="dt">vec2</span> p<span class="op">,</span> <span class="dt">int</span> iterations<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> iterations<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Fold to first quadrant (creates 4-fold symmetry)</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="bu">abs</span><span class="op">(</span>p<span class="op">);</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Scale by 3 and recenter</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> p <span class="op">*</span> <span class="fl">3.0</span> <span class="op">-</span> <span class="dt">vec2</span><span class="op">(</span><span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// After this transformation, the "removed" region is</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// approximately where both |p.x| &lt; 1 and |p.y| &lt; 1</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check if in removed region</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// After n iterations, if we're in the central square, we're removed</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="op">(</span><span class="bu">abs</span><span class="op">(</span>p<span class="op">.</span><span class="fu">x</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1.0</span> <span class="op">&amp;&amp;</span> <span class="bu">abs</span><span class="op">(</span>p<span class="op">.</span><span class="fu">y</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="more-robust-version" class="level3">
<h3 class="anchored" data-anchor-id="more-robust-version">More Robust Version</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> <span class="fu">carpetFold</span><span class="op">(</span><span class="dt">vec2</span> p<span class="op">,</span> <span class="dt">int</span> iterations<span class="op">,</span> <span class="dt">out</span> <span class="dt">bool</span> inFractal<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    inFractal <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> iterations<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Fold to first quadrant</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="bu">abs</span><span class="op">(</span>p<span class="op">);</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Check if in middle third in both dimensions</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// In normalized [0,1] space, middle third is [1/3, 2/3]</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">vec2</span> normalizedP <span class="op">=</span> <span class="bu">fract</span><span class="op">(</span>p<span class="op">);</span>  <span class="co">// Get fractional part</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">bool</span> inMiddleX <span class="op">=</span> <span class="op">(</span>normalizedP<span class="op">.</span><span class="fu">x</span> <span class="op">&gt;</span> <span class="fl">0.33</span> <span class="op">&amp;&amp;</span> normalizedP<span class="op">.</span><span class="fu">x</span> <span class="op">&lt;</span> <span class="fl">0.67</span><span class="op">);</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">bool</span> inMiddleY <span class="op">=</span> <span class="op">(</span>normalizedP<span class="op">.</span><span class="fu">y</span> <span class="op">&gt;</span> <span class="fl">0.33</span> <span class="op">&amp;&amp;</span> normalizedP<span class="op">.</span><span class="fu">y</span> <span class="op">&lt;</span> <span class="fl">0.67</span><span class="op">);</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span>inMiddleX <span class="op">&amp;&amp;</span> inMiddleY<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>            inFractal <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Scale by 3</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> p <span class="op">*</span> <span class="fl">3.0</span><span class="op">;</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> p<span class="op">;</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="clean-implementation" class="level3">
<h3 class="anchored" data-anchor-id="clean-implementation">Clean Implementation</h3>
<p>A cleaner approach using the subdivision pattern:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> <span class="fu">inSierpinskiCarpet</span><span class="op">(</span><span class="dt">vec2</span> p<span class="op">,</span> <span class="dt">int</span> iterations<span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Normalize to [0, 1]</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> p <span class="op">*</span> <span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> iterations<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Which cell of 3×3 grid are we in?</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">vec2</span> cell <span class="op">=</span> <span class="bu">floor</span><span class="op">(</span>p <span class="op">*</span> <span class="fl">3.0</span><span class="op">);</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Middle cell (1,1) is removed</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span>cell<span class="op">.</span><span class="fu">x</span> <span class="op">==</span> <span class="fl">1.0</span> <span class="op">&amp;&amp;</span> cell<span class="op">.</span><span class="fu">y</span> <span class="op">==</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">false</span><span class="op">;</span>  <span class="co">// In removed region</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Zoom into current cell</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="bu">fract</span><span class="op">(</span>p <span class="op">*</span> <span class="fl">3.0</span><span class="op">);</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="kw">true</span><span class="op">;</span>  <span class="co">// In fractal</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="visualization-1" class="level3">
<h3 class="anchored" data-anchor-id="visualization-1">Visualization</h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">mainImage</span><span class="op">(</span><span class="dt">out</span> <span class="dt">vec4</span> fragColor<span class="op">,</span> <span class="dt">in</span> <span class="dt">vec2</span> fragCoord<span class="op">)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> uv <span class="op">=</span> fragCoord <span class="op">/</span> iResolution<span class="op">.</span><span class="fu">xy</span><span class="op">;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    uv <span class="op">=</span> <span class="op">(</span>uv <span class="op">-</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2.0</span><span class="op">;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    uv<span class="op">.</span><span class="fu">x</span> <span class="op">*=</span> iResolution<span class="op">.</span><span class="fu">x</span> <span class="op">/</span> iResolution<span class="op">.</span><span class="fu">y</span><span class="op">;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> inFractal <span class="op">=</span> <span class="fu">inSierpinskiCarpet</span><span class="op">(</span>uv<span class="op">,</span> <span class="dv">6</span><span class="op">);</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec3</span> color <span class="op">=</span> inFractal <span class="op">?</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">1.0</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">,</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">:</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.2</span><span class="op">);</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    fragColor <span class="op">=</span> <span class="dt">vec4</span><span class="op">(</span>color<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
<section id="menger-sponge-3d-extension" class="level2" data-number="C.5">
<h2 data-number="C.5" class="anchored" data-anchor-id="menger-sponge-3d-extension"><span class="header-section-number">C.5</span> Menger Sponge (3D Extension)</h2>
<section id="mathematical-description-2" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-description-2">Mathematical Description</h3>
<p>The Menger sponge is the 3D analog of the Sierpinski carpet: 1. Start with a cube 2. Divide into a 3×3×3 grid of sub-cubes (27 total) 3. Remove the central sub-cube and the 6 face-centered sub-cubes (7 removed, 20 remain) 4. Recursively repeat on each remaining sub-cube</p>
<p><strong>Note:</strong> Like the carpet, the sponge uses axis-aligned divisions, giving us an exact, mathematically precise implementation.</p>
</section>
<section id="the-algorithm-1" class="level3">
<h3 class="anchored" data-anchor-id="the-algorithm-1">The Algorithm</h3>
<p>Same pattern as the carpet, but in 3D!</p>
<ol type="1">
<li><strong>Fold</strong> using <code>abs(p)</code> to create octahedral symmetry</li>
<li><strong>Scale</strong> by factor of 3</li>
<li><strong>Check</strong> if we’re in a removed region (middle cross pattern)</li>
</ol>
</section>
<section id="implementation-1" class="level3">
<h3 class="anchored" data-anchor-id="implementation-1">Implementation</h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> <span class="fu">inMengerSponge</span><span class="op">(</span><span class="dt">vec3</span> p<span class="op">,</span> <span class="dt">int</span> iterations<span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> iterations<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Fold to first octant</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="bu">abs</span><span class="op">(</span>p<span class="op">);</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Which cell of 3×3×3 grid?</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">vec3</span> cell <span class="op">=</span> <span class="bu">floor</span><span class="op">(</span>p <span class="op">*</span> <span class="fl">3.0</span><span class="op">);</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Removed regions: center cube and face centers</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Center: (1,1,1)</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Face centers: (1,1,0), (1,1,2), (1,0,1), (1,2,1), (0,1,1), (2,1,1)</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Pattern: at least 2 coordinates equal to 1</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> ones <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span>cell<span class="op">.</span><span class="fu">x</span> <span class="op">==</span> <span class="fl">1.0</span><span class="op">)</span> ones <span class="op">+=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span>cell<span class="op">.</span><span class="fu">y</span> <span class="op">==</span> <span class="fl">1.0</span><span class="op">)</span> ones <span class="op">+=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span>cell<span class="op">.</span><span class="fu">z</span> <span class="op">==</span> <span class="fl">1.0</span><span class="op">)</span> ones <span class="op">+=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span>ones <span class="op">&gt;=</span> <span class="fl">2.0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">false</span><span class="op">;</span>  <span class="co">// Removed region</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Zoom into cell</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="bu">fract</span><span class="op">(</span>p <span class="op">*</span> <span class="fl">3.0</span><span class="op">);</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="alternative-using-sdf-approach" class="level3">
<h3 class="anchored" data-anchor-id="alternative-using-sdf-approach">Alternative: Using SDF Approach</h3>
<p>We can also implement the Menger sponge as a signed distance function for use with Day 4’s raymarching:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> <span class="fu">sdBox</span><span class="op">(</span><span class="dt">vec3</span> p<span class="op">,</span> <span class="dt">vec3</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec3</span> q <span class="op">=</span> <span class="bu">abs</span><span class="op">(</span>p<span class="op">)</span> <span class="op">-</span> b<span class="op">;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="bu">length</span><span class="op">(</span><span class="bu">max</span><span class="op">(</span>q<span class="op">,</span> <span class="fl">0.0</span><span class="op">))</span> <span class="op">+</span> <span class="bu">min</span><span class="op">(</span><span class="bu">max</span><span class="op">(</span>q<span class="op">.</span><span class="fu">x</span><span class="op">,</span> <span class="bu">max</span><span class="op">(</span>q<span class="op">.</span><span class="fu">y</span><span class="op">,</span> q<span class="op">.</span><span class="fu">z</span><span class="op">)),</span> <span class="fl">0.0</span><span class="op">);</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> <span class="fu">sdMengerSponge</span><span class="op">(</span><span class="dt">vec3</span> p<span class="op">,</span> <span class="dt">int</span> iterations<span class="op">)</span> <span class="op">{</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> d <span class="op">=</span> <span class="fu">sdBox</span><span class="op">(</span>p<span class="op">,</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">1.0</span><span class="op">));</span>  <span class="co">// Start with unit cube</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> scale <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> iterations<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Fold to first octant</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">vec3</span> a <span class="op">=</span> <span class="bu">mod</span><span class="op">(</span>p <span class="op">*</span> scale<span class="op">,</span> <span class="fl">2.0</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        scale <span class="op">*=</span> <span class="fl">3.0</span><span class="op">;</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">vec3</span> r <span class="op">=</span> <span class="bu">abs</span><span class="op">(</span><span class="fl">1.0</span> <span class="op">-</span> <span class="fl">3.0</span> <span class="op">*</span> <span class="bu">abs</span><span class="op">(</span>a<span class="op">));</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Distance to cross (removed region)</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> da <span class="op">=</span> <span class="bu">max</span><span class="op">(</span>r<span class="op">.</span><span class="fu">x</span><span class="op">,</span> r<span class="op">.</span><span class="fu">y</span><span class="op">);</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> db <span class="op">=</span> <span class="bu">max</span><span class="op">(</span>r<span class="op">.</span><span class="fu">y</span><span class="op">,</span> r<span class="op">.</span><span class="fu">z</span><span class="op">);</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> dc <span class="op">=</span> <span class="bu">max</span><span class="op">(</span>r<span class="op">.</span><span class="fu">z</span><span class="op">,</span> r<span class="op">.</span><span class="fu">x</span><span class="op">);</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> c <span class="op">=</span> <span class="op">(</span><span class="bu">min</span><span class="op">(</span>da<span class="op">,</span> <span class="bu">min</span><span class="op">(</span>db<span class="op">,</span> dc<span class="op">))</span> <span class="op">-</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">/</span> scale<span class="op">;</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>        d <span class="op">=</span> <span class="bu">max</span><span class="op">(</span>d<span class="op">,</span> c<span class="op">);</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> d<span class="op">;</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="rendering-with-raymarching" class="level3">
<h3 class="anchored" data-anchor-id="rendering-with-raymarching">Rendering with Raymarching</h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">mainImage</span><span class="op">(</span><span class="dt">out</span> <span class="dt">vec4</span> fragColor<span class="op">,</span> <span class="dt">in</span> <span class="dt">vec2</span> fragCoord<span class="op">)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Setup ray (using Day 4 techniques)</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    Ray ray <span class="op">=</span> <span class="fu">getRay</span><span class="op">(</span>fragCoord<span class="op">,</span> iResolution<span class="op">.</span><span class="fu">xy</span><span class="op">,</span> <span class="fl">45.0</span><span class="op">);</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Raymarch</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> t <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">100</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">vec3</span> pos <span class="op">=</span> ray<span class="op">.</span><span class="fu">origin</span> <span class="op">+</span> t <span class="op">*</span> ray<span class="op">.</span><span class="fu">direction</span><span class="op">;</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> d <span class="op">=</span> <span class="fu">sdMengerSponge</span><span class="op">(</span>pos<span class="op">,</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span><span class="bu">abs</span><span class="op">(</span>d<span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.001</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Hit!</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>            <span class="dt">vec3</span> normal <span class="op">=</span> <span class="fu">estimateNormal</span><span class="op">(</span>pos<span class="op">);</span>  <span class="co">// Day 4 technique</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>            <span class="dt">vec3</span> lightDir <span class="op">=</span> <span class="bu">normalize</span><span class="op">(</span><span class="dt">vec3</span><span class="op">(</span><span class="fl">1.0</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">));</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>            <span class="dt">float</span> diffuse <span class="op">=</span> <span class="bu">max</span><span class="op">(</span><span class="fl">0.0</span><span class="op">,</span> <span class="bu">dot</span><span class="op">(</span>normal<span class="op">,</span> lightDir<span class="op">));</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>            <span class="dt">vec3</span> color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">1.0</span><span class="op">,</span> <span class="fl">0.8</span><span class="op">,</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">*</span> diffuse <span class="op">+</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.1</span><span class="op">);</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>            fragColor <span class="op">=</span> <span class="dt">vec4</span><span class="op">(</span>color<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span><span class="op">;</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>        t <span class="op">+=</span> d<span class="op">;</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span>t <span class="op">&gt;</span> <span class="fl">100.0</span><span class="op">)</span> <span class="kw">break</span><span class="op">;</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Miss</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    fragColor <span class="op">=</span> <span class="dt">vec4</span><span class="op">(</span><span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.2</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
<section id="general-principles-of-folding-fractals" class="level2" data-number="C.6">
<h2 data-number="C.6" class="anchored" data-anchor-id="general-principles-of-folding-fractals"><span class="header-section-number">C.6</span> General Principles of Folding Fractals</h2>
<section id="key-ingredients" class="level3">
<h3 class="anchored" data-anchor-id="key-ingredients">Key Ingredients</h3>
<ol type="1">
<li><strong>Symmetry operations</strong>:
<ul>
<li><code>abs()</code> for axis-aligned symmetry</li>
<li>Reflections for arbitrary symmetry</li>
</ul></li>
<li><strong>Scaling factor</strong>:
<ul>
<li>Factor of 2: Sierpinski triangle</li>
<li>Factor of 3: Sierpinski carpet, Menger sponge</li>
<li>General factor <span class="math inline">\(s\)</span>: determines fractal dimension</li>
</ul></li>
<li><strong>Removal pattern</strong>:
<ul>
<li>Which regions get removed at each level</li>
<li>Defines the fractal’s structure</li>
</ul></li>
<li><strong>Iteration</strong>:
<ul>
<li>More iterations = more detail</li>
<li>Computational cost grows linearly</li>
<li>Visual complexity grows exponentially</li>
</ul></li>
</ol>
</section>
<section id="fractal-dimension" class="level3">
<h3 class="anchored" data-anchor-id="fractal-dimension">Fractal Dimension</h3>
<p>The fractal dimension <span class="math inline">\(D\)</span> can be computed from the scaling factor <span class="math inline">\(s\)</span> and the number of remaining pieces <span class="math inline">\(N\)</span>:</p>
<p><span class="math display">\[D = \frac{\log N}{\log s}\]</span></p>
<p><strong>Examples:</strong> - <strong>Sierpinski triangle</strong>: <span class="math inline">\(N = 3\)</span> pieces, scale factor <span class="math inline">\(s = 2\)</span> <span class="math display">\[D = \frac{\log 3}{\log 2} \approx 1.585\]</span></p>
<ul>
<li><p><strong>Sierpinski carpet</strong>: <span class="math inline">\(N = 8\)</span> pieces, scale factor <span class="math inline">\(s = 3\)</span> <span class="math display">\[D = \frac{\log 8}{\log 3} \approx 1.893\]</span></p></li>
<li><p><strong>Menger sponge</strong>: <span class="math inline">\(N = 20\)</span> pieces, scale factor <span class="math inline">\(s = 3\)</span> <span class="math display">\[D = \frac{\log 20}{\log 3} \approx 2.727\]</span></p></li>
</ul>
<p>The fractal dimension is between the topological dimension and the embedding dimension, reflecting the fractal’s “in-between” nature!</p>
<hr>
</section>
</section>
<section id="coloring-strategies" class="level2" data-number="C.7">
<h2 data-number="C.7" class="anchored" data-anchor-id="coloring-strategies"><span class="header-section-number">C.7</span> Coloring Strategies</h2>
<section id="by-iteration-depth" class="level3">
<h3 class="anchored" data-anchor-id="by-iteration-depth">By Iteration Depth</h3>
<p>Track which iteration first identifies a point as removed:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> firstRemovedIter <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> iterations<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// [Folding and scaling]</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span><span class="op">([</span><span class="dt">in</span> removed region<span class="op">]</span> <span class="op">&amp;&amp;</span> firstRemovedIter <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>        firstRemovedIter <span class="op">=</span> i<span class="op">;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> t <span class="op">=</span> <span class="dt">float</span><span class="op">(</span>firstRemovedIter<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span>iterations<span class="op">);</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="dt">vec3</span> color <span class="op">=</span> <span class="fu">palette</span><span class="op">(</span>t<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="by-distance-after-folding" class="level3">
<h3 class="anchored" data-anchor-id="by-distance-after-folding">By Distance After Folding</h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> p_final <span class="op">=</span> <span class="op">[</span>after <span class="bu">all</span> folding<span class="op">];</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> d <span class="op">=</span> <span class="bu">length</span><span class="op">(</span>p_final<span class="op">);</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="dt">vec3</span> color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span>d <span class="op">*</span> <span class="fl">0.5</span><span class="op">);</span>  <span class="co">// Grayscale by distance</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="by-cell-position" class="level3">
<h3 class="anchored" data-anchor-id="by-cell-position">By Cell Position</h3>
<p>For grid-based fractals (carpet, sponge), color by which sub-cell the point lands in:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec3</span> cell <span class="op">=</span> <span class="bu">floor</span><span class="op">(</span>p <span class="op">*</span> <span class="fl">3.0</span><span class="op">);</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="dt">vec3</span> color <span class="op">=</span> cell <span class="op">/</span> <span class="fl">3.0</span><span class="op">;</span>  <span class="co">// RGB from cell coordinates</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="hybrid-distance-field-fractal" class="level3">
<h3 class="anchored" data-anchor-id="hybrid-distance-field-fractal">Hybrid: Distance Field + Fractal</h3>
<p>For 3D fractals, combine distance estimation with fractal membership:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> d <span class="op">=</span> <span class="fu">sdMengerSponge</span><span class="op">(</span>p<span class="op">,</span> iterations<span class="op">);</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="dt">vec3</span> color<span class="op">;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span><span class="op">(</span>d <span class="op">&lt;</span> <span class="fl">0.0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Inside sponge</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">1.0</span><span class="op">,</span> <span class="fl">0.8</span><span class="op">,</span> <span class="fl">0.6</span><span class="op">);</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Outside, but show distance</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1.0</span> <span class="op">+</span> d<span class="op">);</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
<section id="variations-and-experiments" class="level2" data-number="C.8">
<h2 data-number="C.8" class="anchored" data-anchor-id="variations-and-experiments"><span class="header-section-number">C.8</span> Variations and Experiments</h2>
<section id="different-folding-operations" class="level3">
<h3 class="anchored" data-anchor-id="different-folding-operations">Different Folding Operations</h3>
<p>Try different symmetry groups: - Hexagonal symmetry (6-fold) - Octahedral symmetry (for 3D) - Custom reflection patterns</p>
</section>
<section id="different-scale-factors" class="level3">
<h3 class="anchored" data-anchor-id="different-scale-factors">Different Scale Factors</h3>
<ul>
<li>Scale by 4: sparser fractal</li>
<li>Scale by 1.5: denser fractal</li>
<li>Non-integer scales: unusual structures</li>
</ul>
</section>
<section id="animated-parameters" class="level3">
<h3 class="anchored" data-anchor-id="animated-parameters">Animated Parameters</h3>
<div class="sourceCode" id="cb19"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> scale <span class="op">=</span> <span class="fl">2.0</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="bu">sin</span><span class="op">(</span>iTime<span class="op">);</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> p <span class="op">*</span> scale<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Watch the fractal morph as the scale factor changes!</p>
</section>
<section id="color-by-orbit" class="level3">
<h3 class="anchored" data-anchor-id="color-by-orbit">Color by Orbit</h3>
<p>Track the “orbit” of the point through the folding process:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> orbit <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> iterations<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    orbit <span class="op">+=</span> <span class="bu">length</span><span class="op">(</span>p<span class="op">);</span>  <span class="co">// Accumulate total distance traveled</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// [Folding operations]</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="dt">vec3</span> color <span class="op">=</span> <span class="fu">palette</span><span class="op">(</span>orbit <span class="op">/</span> <span class="fl">10.0</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="d-variations" class="level3">
<h3 class="anchored" data-anchor-id="d-variations">3D Variations</h3>
<ul>
<li><strong>Cross-Menger</strong>: Different removal pattern (only center)</li>
<li><strong>Jerusalem Cube</strong>: Variation with different symmetry</li>
<li><strong>Hybrid fractals</strong>: Combine different removal patterns at different scales</li>
</ul>
<hr>
</section>
</section>
<section id="connection-to-course-topics" class="level2" data-number="C.9">
<h2 data-number="C.9" class="anchored" data-anchor-id="connection-to-course-topics"><span class="header-section-number">C.9</span> Connection to Course Topics</h2>
<section id="day-2-iteration-creates-fractals" class="level3">
<h3 class="anchored" data-anchor-id="day-2-iteration-creates-fractals">Day 2: Iteration Creates Fractals</h3>
<p>Both folding fractals and the Mandelbrot set/Apollonian gasket share the principle: <strong>simple operations iterated create complex structure</strong>.</p>
<ul>
<li><strong>Mandelbrot</strong>: <span class="math inline">\(z \to z^2 + c\)</span> (complex arithmetic iteration)</li>
<li><strong>Apollonian</strong>: Repeated circle inversions (geometric iteration)</li>
<li><strong>Sierpinski</strong>: Fold + scale (geometric iteration with scaling)</li>
</ul>
</section>
<section id="day-3-folding-without-scaling" class="level3">
<h3 class="anchored" data-anchor-id="day-3-folding-without-scaling">Day 3: Folding Without Scaling</h3>
<p>Euclidean and hyperbolic tilings use folding <strong>without</strong> scaling: - Reflection brings points into fundamental domain - No scaling → fills space with copies - With scaling → creates fractal structure</p>
</section>
<section id="day-4-3d-rendering" class="level3">
<h3 class="anchored" data-anchor-id="day-4-3d-rendering">Day 4: 3D Rendering</h3>
<p>The Menger sponge naturally extends to 3D: - Can be rendered as SDF (raymarching) - Can be rendered as boolean test (simple ray casting) - Demonstrates 3D coordinate folding</p>
<hr>
</section>
</section>
<section id="exercises" class="level2" data-number="C.10">
<h2 data-number="C.10" class="anchored" data-anchor-id="exercises"><span class="header-section-number">C.10</span> Exercises</h2>
<section id="exercise-1-hexagonal-sierpinski" class="level3">
<h3 class="anchored" data-anchor-id="exercise-1-hexagonal-sierpinski">Exercise 1: Hexagonal Sierpinski</h3>
<p>Create a Sierpinski gasket based on a hexagon instead of a triangle: - Use 6-fold symmetry - Scale by factor of 3 - Remove appropriate regions</p>
</section>
<section id="exercise-2-animate-the-scale-factor" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2-animate-the-scale-factor">Exercise 2: Animate the Scale Factor</h3>
<p>Modify the Sierpinski carpet to have a time-varying scale factor:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> scale <span class="op">=</span> <span class="fl">3.0</span> <span class="op">+</span> <span class="bu">sin</span><span class="op">(</span>iTime<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Watch how the fractal structure changes!</p>
</section>
<section id="exercise-3-3d-cross" class="level3">
<h3 class="anchored" data-anchor-id="exercise-3-3d-cross">Exercise 3: 3D Cross</h3>
<p>Implement a 3D fractal using only cross-shaped removal (remove only the center cube, not the face centers). Compare to the standard Menger sponge.</p>
</section>
<section id="exercise-4-hybrid-fractal" class="level3">
<h3 class="anchored" data-anchor-id="exercise-4-hybrid-fractal">Exercise 4: Hybrid Fractal</h3>
<p>Combine two different fractals: - First 3 iterations: Sierpinski triangle folding - Next 3 iterations: Sierpinski carpet folding - Observe the unusual resulting structure</p>
</section>
<section id="exercise-5-distance-colored-sponge" class="level3">
<h3 class="anchored" data-anchor-id="exercise-5-distance-colored-sponge">Exercise 5: Distance-Colored Sponge</h3>
<p>Render the Menger sponge with colors based on distance from the surface: - Use <code>sdMengerSponge</code> as a distance field - Color by distance for points outside - Different color for points inside</p>
<hr>
</section>
</section>
<section id="further-reading" class="level2" data-number="C.11">
<h2 data-number="C.11" class="anchored" data-anchor-id="further-reading"><span class="header-section-number">C.11</span> Further Reading</h2>
<section id="mathematical-theory" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-theory">Mathematical Theory</h3>
<ul>
<li>Hausdorff dimension and box-counting dimension</li>
<li>Iterated function systems (IFS)</li>
<li>Self-similar sets and scaling symmetries</li>
</ul>
</section>
<section id="computational-techniques" class="level3">
<h3 class="anchored" data-anchor-id="computational-techniques">Computational Techniques</h3>
<ul>
<li>Escape-time algorithms</li>
<li>Distance estimation for fractals</li>
<li>Efficient rendering of fractal geometry</li>
</ul>
</section>
<section id="applications" class="level3">
<h3 class="anchored" data-anchor-id="applications">Applications</h3>
<ul>
<li>Procedural generation in games/graphics</li>
<li>Antenna design (fractal antennas)</li>
<li>Modeling natural phenomena (coastlines, plants)</li>
<li>Compression algorithms</li>
</ul>
<hr>
</section>
</section>
<section id="summary" class="level2" data-number="C.12">
<h2 data-number="C.12" class="anchored" data-anchor-id="summary"><span class="header-section-number">C.12</span> Summary</h2>
<p>Folding fractals demonstrate: 1. <strong>Iteration + scaling</strong> creates self-similar structure 2. <strong>Simple operations</strong> produce complex results 3. <strong>GPU parallelism</strong> enables real-time fractal rendering 4. <strong>Fractals connect</strong> to many course topics (iteration, symmetry, 3D)</p>
<p>The techniques here—folding, scaling, iteration—are fundamental to both mathematical fractals and computer graphics. These methods extend naturally from 2D to 3D, and from static to animated, making them powerful tools for mathematical visualization.</p>
<p><strong>Key takeaway</strong>: Fractals aren’t just beautiful—they’re computationally accessible. A few dozen lines of shader code can generate infinite complexity!</p>
<hr>
</section>
<section id="complete-example-animated-sierpinski-carpet" class="level2" data-number="C.13">
<h2 data-number="C.13" class="anchored" data-anchor-id="complete-example-animated-sierpinski-carpet"><span class="header-section-number">C.13</span> Complete Example: Animated Sierpinski Carpet</h2>
<div class="sourceCode" id="cb22"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec3</span> <span class="fu">palette</span><span class="op">(</span><span class="dt">float</span> t<span class="op">)</span> <span class="op">{</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec3</span> a <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.5</span><span class="op">);</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec3</span> b <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.5</span><span class="op">);</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec3</span> c <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec3</span> d <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.33</span><span class="op">,</span> <span class="fl">0.67</span><span class="op">);</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> a <span class="op">+</span> b <span class="op">*</span> <span class="bu">cos</span><span class="op">(</span><span class="fl">6.28318</span> <span class="op">*</span> <span class="op">(</span>c <span class="op">*</span> t <span class="op">+</span> d<span class="op">));</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> <span class="fu">inCarpet</span><span class="op">(</span><span class="dt">vec2</span> p<span class="op">,</span> <span class="dt">int</span> iterations<span class="op">)</span> <span class="op">{</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> p <span class="op">*</span> <span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> iterations<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">vec2</span> cell <span class="op">=</span> <span class="bu">floor</span><span class="op">(</span>p <span class="op">*</span> <span class="fl">3.0</span><span class="op">);</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span>cell<span class="op">.</span><span class="fu">x</span> <span class="op">==</span> <span class="fl">1.0</span> <span class="op">&amp;&amp;</span> cell<span class="op">.</span><span class="fu">y</span> <span class="op">==</span> <span class="fl">1.0</span><span class="op">)</span> <span class="kw">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="bu">fract</span><span class="op">(</span>p <span class="op">*</span> <span class="fl">3.0</span><span class="op">);</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">mainImage</span><span class="op">(</span><span class="dt">out</span> <span class="dt">vec4</span> fragColor<span class="op">,</span> <span class="dt">in</span> <span class="dt">vec2</span> fragCoord<span class="op">)</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> uv <span class="op">=</span> fragCoord <span class="op">/</span> iResolution<span class="op">.</span><span class="fu">xy</span><span class="op">;</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    uv <span class="op">=</span> <span class="op">(</span>uv <span class="op">-</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2.0</span><span class="op">;</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>    uv<span class="op">.</span><span class="fu">x</span> <span class="op">*=</span> iResolution<span class="op">.</span><span class="fu">x</span> <span class="op">/</span> iResolution<span class="op">.</span><span class="fu">y</span><span class="op">;</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Zoom animation</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> zoom <span class="op">=</span> <span class="bu">exp</span><span class="op">(</span><span class="bu">sin</span><span class="op">(</span>iTime <span class="op">*</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2.0</span><span class="op">);</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>    uv <span class="op">*=</span> zoom<span class="op">;</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Rotation animation</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> angle <span class="op">=</span> iTime <span class="op">*</span> <span class="fl">0.2</span><span class="op">;</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> c <span class="op">=</span> <span class="bu">cos</span><span class="op">(</span>angle<span class="op">),</span> s <span class="op">=</span> <span class="bu">sin</span><span class="op">(</span>angle<span class="op">);</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>    uv <span class="op">=</span> <span class="dt">vec2</span><span class="op">(</span>c <span class="op">*</span> uv<span class="op">.</span><span class="fu">x</span> <span class="op">-</span> s <span class="op">*</span> uv<span class="op">.</span><span class="fu">y</span><span class="op">,</span> s <span class="op">*</span> uv<span class="op">.</span><span class="fu">x</span> <span class="op">+</span> c <span class="op">*</span> uv<span class="op">.</span><span class="fu">y</span><span class="op">);</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> iterations <span class="op">=</span> <span class="dv">6</span><span class="op">;</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> inFractal <span class="op">=</span> <span class="fu">inCarpet</span><span class="op">(</span>uv<span class="op">,</span> iterations<span class="op">);</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec3</span> color<span class="op">;</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span><span class="op">(</span>inFractal<span class="op">)</span> <span class="op">{</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Color based on distance from center</span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> d <span class="op">=</span> <span class="bu">length</span><span class="op">(</span>uv<span class="op">);</span></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> <span class="fu">palette</span><span class="op">(</span>d <span class="op">*</span> <span class="fl">0.5</span> <span class="op">+</span> iTime <span class="op">*</span> <span class="fl">0.1</span><span class="op">);</span></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.05</span><span class="op">,</span> <span class="fl">0.05</span><span class="op">,</span> <span class="fl">0.1</span><span class="op">);</span></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>    fragColor <span class="op">=</span> <span class="dt">vec4</span><span class="op">(</span>color<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This creates a beautiful, animated Sierpinski carpet that zooms and rotates, with colors flowing through the fractal structure!</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./debug-reference.html" class="pagination-link" aria-label="Debugging">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Debugging</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb23" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Folding Fractals</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>This appendix explores a fascinating technique for generating fractals: **iterated folding with scaling**. While reflection-based tiling (Days 2-3) fills space with copies of a fundamental domain, folding fractals add scaling at each iteration, creating self-similar structures that exhibit fractal geometry.</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>We'll explore three classic examples:</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Sierpinski Triangle** (2D, triangle-based)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Sierpinski Carpet** (2D, square-based)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Menger Sponge** (3D, cube-based)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>These connect naturally to course content: the folding operations use techniques from Day 2-3 (reflection, <span class="in">`abs()`</span>), and the Menger sponge extends to 3D using Day 4's coordinate systems.</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fundamental Concept: Folding + Scaling = Fractals</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="fu">### The General Pattern</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>All folding fractals follow this pattern:</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Fold**: Use geometric operations (reflection, <span class="in">`abs()`</span>) to bring the point into a fundamental region</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Scale**: Zoom in by some factor (typically 2 or 3)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Repeat**: Iterate this process</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Classify**: After $n$ iterations, check if the point is in a "removed" region or "kept" region</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>After $n$ iterations:</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We've zoomed in by factor $s^n$ (where $s$ is the scale factor)</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The fractal structure emerges from the removal pattern</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The result is self-similar: zooming in reveals the same pattern</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a><span class="fu">### Connection to Tilings</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>Recall from Day 3:</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Tiling**: Fold → repeat (fills space with copies)</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Fractal**: Fold → scale → repeat (creates self-similar structure with removed regions)</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>The key difference is the scaling step!</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a><span class="fu">## Sierpinski Triangle</span></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a><span class="fu">### Mathematical Description</span></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>The Sierpinski triangle is constructed by:</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Start with an equilateral triangle</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Remove the middle triangle (formed by connecting edge midpoints)</span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Recursively repeat on each remaining sub-triangle</span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>Equivalently: iteratively fold into the triangle and scale by 2.</span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a><span class="fu">### Mathematical Foundation: Reflection Across a Line</span></span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>Before implementing the fractal, we need the correct reflection formula.</span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a>A line in the plane can be written as $ax + by = c$, with normal vector $\mathbf{n} = (a, b)$.</span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a>**Reflection formula:** For a point $\mathbf{p} = (x, y)$, the reflection $\mathbf{p}'$ across the line is:</span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a>$$\mathbf{p}' = \mathbf{p} - 2d\hat{\mathbf{n}}$$</span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$d = \frac{ax + by - c}{\sqrt{a^2 + b^2}}$ is the signed distance to the line</span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\hat{\mathbf{n}} = \frac{(a,b)}{\sqrt{a^2 + b^2}}$ is the unit normal</span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a>Combining these:</span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a>$$\mathbf{p}' = \mathbf{p} - \frac{2(ax + by - c)}{a^2 + b^2}(a, b)$$</span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a><span class="fu">### Line Struct</span></span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a>Let's organize line data properly:</span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a><span class="in">```glsl</span></span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a><span class="in">struct Line {</span></span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a><span class="in">    float a, b, c;  // Line equation: ax + by = c</span></span>
<span id="cb23-77"><a href="#cb23-77" aria-hidden="true" tabindex="-1"></a><span class="in">};</span></span>
<span id="cb23-78"><a href="#cb23-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-79"><a href="#cb23-79" aria-hidden="true" tabindex="-1"></a><span class="in">vec2 reflectAcrossLine(vec2 p, Line line) {</span></span>
<span id="cb23-80"><a href="#cb23-80" aria-hidden="true" tabindex="-1"></a><span class="in">    // Signed distance from point to line (unnormalized)</span></span>
<span id="cb23-81"><a href="#cb23-81" aria-hidden="true" tabindex="-1"></a><span class="in">    float dist = line.a * p.x + line.b * p.y - line.c;</span></span>
<span id="cb23-82"><a href="#cb23-82" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-83"><a href="#cb23-83" aria-hidden="true" tabindex="-1"></a><span class="in">    // Normal vector squared length</span></span>
<span id="cb23-84"><a href="#cb23-84" aria-hidden="true" tabindex="-1"></a><span class="in">    float normSq = line.a * line.a + line.b * line.b;</span></span>
<span id="cb23-85"><a href="#cb23-85" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-86"><a href="#cb23-86" aria-hidden="true" tabindex="-1"></a><span class="in">    // Reflection formula</span></span>
<span id="cb23-87"><a href="#cb23-87" aria-hidden="true" tabindex="-1"></a><span class="in">    vec2 normal = vec2(line.a, line.b);</span></span>
<span id="cb23-88"><a href="#cb23-88" aria-hidden="true" tabindex="-1"></a><span class="in">    return p - (2.0 * dist / normSq) * normal;</span></span>
<span id="cb23-89"><a href="#cb23-89" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb23-90"><a href="#cb23-90" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-91"><a href="#cb23-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-92"><a href="#cb23-92" aria-hidden="true" tabindex="-1"></a><span class="fu">### Setting Up the Triangle</span></span>
<span id="cb23-93"><a href="#cb23-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-94"><a href="#cb23-94" aria-hidden="true" tabindex="-1"></a>For an equilateral triangle with vertices:</span>
<span id="cb23-95"><a href="#cb23-95" aria-hidden="true" tabindex="-1"></a>$$v_0 = (0, 1), \quad v_1 = \left(-\frac{\sqrt{3}}{2}, -\frac{1}{2}\right), \quad v_2 = \left(\frac{\sqrt{3}}{2}, -\frac{1}{2}\right)$$</span>
<span id="cb23-96"><a href="#cb23-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-97"><a href="#cb23-97" aria-hidden="true" tabindex="-1"></a>We need the three edge lines:</span>
<span id="cb23-98"><a href="#cb23-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-99"><a href="#cb23-99" aria-hidden="true" tabindex="-1"></a>**Edge from $v_0$ to $v_1$:**</span>
<span id="cb23-100"><a href="#cb23-100" aria-hidden="true" tabindex="-1"></a>Direction vector: $v_1 - v_0 = (-\frac{\sqrt{3}}{2}, -\frac{3}{2})$</span>
<span id="cb23-101"><a href="#cb23-101" aria-hidden="true" tabindex="-1"></a>Normal (perpendicular): $(\frac{3}{2}, -\frac{\sqrt{3}}{2})$ or simplified: $(3, -\sqrt{3})$</span>
<span id="cb23-102"><a href="#cb23-102" aria-hidden="true" tabindex="-1"></a>Line equation: $3x - \sqrt{3}y = c$, passing through $v_0 = (0,1)$: $c = -\sqrt{3}$</span>
<span id="cb23-103"><a href="#cb23-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-104"><a href="#cb23-104" aria-hidden="true" tabindex="-1"></a>**Edge from $v_1$ to $v_2$:**</span>
<span id="cb23-105"><a href="#cb23-105" aria-hidden="true" tabindex="-1"></a>This is horizontal: $y = -\frac{1}{2}$</span>
<span id="cb23-106"><a href="#cb23-106" aria-hidden="true" tabindex="-1"></a>Line equation: $0x + 1y = -\frac{1}{2}$ or $(0, 1, -0.5)$</span>
<span id="cb23-107"><a href="#cb23-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-108"><a href="#cb23-108" aria-hidden="true" tabindex="-1"></a>**Edge from $v_2$ to $v_0$:**</span>
<span id="cb23-109"><a href="#cb23-109" aria-hidden="true" tabindex="-1"></a>By symmetry: $-3x - \sqrt{3}y = -\sqrt{3}$</span>
<span id="cb23-110"><a href="#cb23-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-111"><a href="#cb23-111" aria-hidden="true" tabindex="-1"></a><span class="in">```glsl</span></span>
<span id="cb23-112"><a href="#cb23-112" aria-hidden="true" tabindex="-1"></a><span class="in">void setupTriangleEdges(out Line e1, out Line e2, out Line e3) {</span></span>
<span id="cb23-113"><a href="#cb23-113" aria-hidden="true" tabindex="-1"></a><span class="in">    float sqrt3 = 1.732;</span></span>
<span id="cb23-114"><a href="#cb23-114" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-115"><a href="#cb23-115" aria-hidden="true" tabindex="-1"></a><span class="in">    // Edge v0 to v1</span></span>
<span id="cb23-116"><a href="#cb23-116" aria-hidden="true" tabindex="-1"></a><span class="in">    e1.a = 3.0;</span></span>
<span id="cb23-117"><a href="#cb23-117" aria-hidden="true" tabindex="-1"></a><span class="in">    e1.b = -sqrt3;</span></span>
<span id="cb23-118"><a href="#cb23-118" aria-hidden="true" tabindex="-1"></a><span class="in">    e1.c = -sqrt3;</span></span>
<span id="cb23-119"><a href="#cb23-119" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-120"><a href="#cb23-120" aria-hidden="true" tabindex="-1"></a><span class="in">    // Edge v1 to v2 (horizontal)</span></span>
<span id="cb23-121"><a href="#cb23-121" aria-hidden="true" tabindex="-1"></a><span class="in">    e2.a = 0.0;</span></span>
<span id="cb23-122"><a href="#cb23-122" aria-hidden="true" tabindex="-1"></a><span class="in">    e2.b = 1.0;</span></span>
<span id="cb23-123"><a href="#cb23-123" aria-hidden="true" tabindex="-1"></a><span class="in">    e2.c = -0.5;</span></span>
<span id="cb23-124"><a href="#cb23-124" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-125"><a href="#cb23-125" aria-hidden="true" tabindex="-1"></a><span class="in">    // Edge v2 to v0</span></span>
<span id="cb23-126"><a href="#cb23-126" aria-hidden="true" tabindex="-1"></a><span class="in">    e3.a = -3.0;</span></span>
<span id="cb23-127"><a href="#cb23-127" aria-hidden="true" tabindex="-1"></a><span class="in">    e3.b = -sqrt3;</span></span>
<span id="cb23-128"><a href="#cb23-128" aria-hidden="true" tabindex="-1"></a><span class="in">    e3.c = -sqrt3;</span></span>
<span id="cb23-129"><a href="#cb23-129" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb23-130"><a href="#cb23-130" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-131"><a href="#cb23-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-132"><a href="#cb23-132" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Folding Algorithm</span></span>
<span id="cb23-133"><a href="#cb23-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-134"><a href="#cb23-134" aria-hidden="true" tabindex="-1"></a>Now we can properly fold into the triangle:</span>
<span id="cb23-135"><a href="#cb23-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-136"><a href="#cb23-136" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Folding Algorithm</span></span>
<span id="cb23-137"><a href="#cb23-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-138"><a href="#cb23-138" aria-hidden="true" tabindex="-1"></a>Now we can properly fold into the triangle:</span>
<span id="cb23-139"><a href="#cb23-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-140"><a href="#cb23-140" aria-hidden="true" tabindex="-1"></a><span class="in">```glsl</span></span>
<span id="cb23-141"><a href="#cb23-141" aria-hidden="true" tabindex="-1"></a><span class="in">vec2 foldIntoTriangle(vec2 p, Line e1, Line e2, Line e3, int maxIter) {</span></span>
<span id="cb23-142"><a href="#cb23-142" aria-hidden="true" tabindex="-1"></a><span class="in">    for(int i = 0; i &lt; maxIter; i++) {</span></span>
<span id="cb23-143"><a href="#cb23-143" aria-hidden="true" tabindex="-1"></a><span class="in">        vec2 p_old = p;</span></span>
<span id="cb23-144"><a href="#cb23-144" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb23-145"><a href="#cb23-145" aria-hidden="true" tabindex="-1"></a><span class="in">        // Reflect across each edge if we're on the wrong side</span></span>
<span id="cb23-146"><a href="#cb23-146" aria-hidden="true" tabindex="-1"></a><span class="in">        // Check sign of distance: if negative, we're on wrong side</span></span>
<span id="cb23-147"><a href="#cb23-147" aria-hidden="true" tabindex="-1"></a><span class="in">        float d1 = e1.a * p.x + e1.b * p.y - e1.c;</span></span>
<span id="cb23-148"><a href="#cb23-148" aria-hidden="true" tabindex="-1"></a><span class="in">        if(d1 &lt; 0.0) p = reflectAcrossLine(p, e1);</span></span>
<span id="cb23-149"><a href="#cb23-149" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb23-150"><a href="#cb23-150" aria-hidden="true" tabindex="-1"></a><span class="in">        float d2 = e2.a * p.x + e2.b * p.y - e2.c;</span></span>
<span id="cb23-151"><a href="#cb23-151" aria-hidden="true" tabindex="-1"></a><span class="in">        if(d2 &lt; 0.0) p = reflectAcrossLine(p, e2);</span></span>
<span id="cb23-152"><a href="#cb23-152" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb23-153"><a href="#cb23-153" aria-hidden="true" tabindex="-1"></a><span class="in">        float d3 = e3.a * p.x + e3.b * p.y - e3.c;</span></span>
<span id="cb23-154"><a href="#cb23-154" aria-hidden="true" tabindex="-1"></a><span class="in">        if(d3 &lt; 0.0) p = reflectAcrossLine(p, e3);</span></span>
<span id="cb23-155"><a href="#cb23-155" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb23-156"><a href="#cb23-156" aria-hidden="true" tabindex="-1"></a><span class="in">        // Converged? (no more reflections)</span></span>
<span id="cb23-157"><a href="#cb23-157" aria-hidden="true" tabindex="-1"></a><span class="in">        if(length(p - p_old) &lt; 0.0001) break;</span></span>
<span id="cb23-158"><a href="#cb23-158" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb23-159"><a href="#cb23-159" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-160"><a href="#cb23-160" aria-hidden="true" tabindex="-1"></a><span class="in">    return p;</span></span>
<span id="cb23-161"><a href="#cb23-161" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb23-162"><a href="#cb23-162" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-163"><a href="#cb23-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-164"><a href="#cb23-164" aria-hidden="true" tabindex="-1"></a><span class="fu">### Adding the Scaling Step</span></span>
<span id="cb23-165"><a href="#cb23-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-166"><a href="#cb23-166" aria-hidden="true" tabindex="-1"></a>For the Sierpinski fractal, we fold and then scale:</span>
<span id="cb23-167"><a href="#cb23-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-168"><a href="#cb23-168" aria-hidden="true" tabindex="-1"></a><span class="in">```glsl</span></span>
<span id="cb23-169"><a href="#cb23-169" aria-hidden="true" tabindex="-1"></a><span class="in">vec2 sierpinskiTriangle(vec2 p, int iterations, out int depth) {</span></span>
<span id="cb23-170"><a href="#cb23-170" aria-hidden="true" tabindex="-1"></a><span class="in">    Line e1, e2, e3;</span></span>
<span id="cb23-171"><a href="#cb23-171" aria-hidden="true" tabindex="-1"></a><span class="in">    setupTriangleEdges(e1, e2, e3);</span></span>
<span id="cb23-172"><a href="#cb23-172" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-173"><a href="#cb23-173" aria-hidden="true" tabindex="-1"></a><span class="in">    depth = 0;</span></span>
<span id="cb23-174"><a href="#cb23-174" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-175"><a href="#cb23-175" aria-hidden="true" tabindex="-1"></a><span class="in">    for(int i = 0; i &lt; iterations; i++) {</span></span>
<span id="cb23-176"><a href="#cb23-176" aria-hidden="true" tabindex="-1"></a><span class="in">        // Fold into fundamental triangle</span></span>
<span id="cb23-177"><a href="#cb23-177" aria-hidden="true" tabindex="-1"></a><span class="in">        p = foldIntoTriangle(p, e1, e2, e3, 10);</span></span>
<span id="cb23-178"><a href="#cb23-178" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb23-179"><a href="#cb23-179" aria-hidden="true" tabindex="-1"></a><span class="in">        // Scale by 2 toward center</span></span>
<span id="cb23-180"><a href="#cb23-180" aria-hidden="true" tabindex="-1"></a><span class="in">        vec2 center = vec2(0.0, 0.0);  // Approximate center</span></span>
<span id="cb23-181"><a href="#cb23-181" aria-hidden="true" tabindex="-1"></a><span class="in">        p = (p - center) * 2.0 + center;</span></span>
<span id="cb23-182"><a href="#cb23-182" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb23-183"><a href="#cb23-183" aria-hidden="true" tabindex="-1"></a><span class="in">        depth++;</span></span>
<span id="cb23-184"><a href="#cb23-184" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb23-185"><a href="#cb23-185" aria-hidden="true" tabindex="-1"></a><span class="in">        // Optional: early exit if escaped</span></span>
<span id="cb23-186"><a href="#cb23-186" aria-hidden="true" tabindex="-1"></a><span class="in">        if(length(p) &gt; 100.0) break;</span></span>
<span id="cb23-187"><a href="#cb23-187" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb23-188"><a href="#cb23-188" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-189"><a href="#cb23-189" aria-hidden="true" tabindex="-1"></a><span class="in">    return p;</span></span>
<span id="cb23-190"><a href="#cb23-190" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb23-191"><a href="#cb23-191" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-192"><a href="#cb23-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-193"><a href="#cb23-193" aria-hidden="true" tabindex="-1"></a><span class="fu">### Determining if Point is in Fractal</span></span>
<span id="cb23-194"><a href="#cb23-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-195"><a href="#cb23-195" aria-hidden="true" tabindex="-1"></a>After folding, we need to check if we're in the "removed" middle triangle. Using barycentric coordinates:</span>
<span id="cb23-196"><a href="#cb23-196" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-197"><a href="#cb23-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-198"><a href="#cb23-198" aria-hidden="true" tabindex="-1"></a><span class="in">### Determining if Point is in Fractal</span></span>
<span id="cb23-199"><a href="#cb23-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-200"><a href="#cb23-200" aria-hidden="true" tabindex="-1"></a><span class="in">After folding, we need to check if we're in the "removed" middle triangle. The middle triangle has vertices at the midpoints of the original triangle's edges.</span></span>
<span id="cb23-201"><a href="#cb23-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-202"><a href="#cb23-202" aria-hidden="true" tabindex="-1"></a><span class="in">For an equilateral triangle with vertices $v_0, v_1, v_2$, the midpoints are:</span></span>
<span id="cb23-203"><a href="#cb23-203" aria-hidden="true" tabindex="-1"></a><span class="in">$$m_{01} = \frac{v_0 + v_1}{2}, \quad m_{12} = \frac{v_1 + v_2}{2}, \quad m_{20} = \frac{v_2 + v_0}{2}$$</span></span>
<span id="cb23-204"><a href="#cb23-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-205"><a href="#cb23-205" aria-hidden="true" tabindex="-1"></a><span class="in">We can check if point $p$ is inside this middle triangle using barycentric coordinates:</span></span>
<span id="cb23-206"><a href="#cb23-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-207"><a href="#cb23-207" aria-hidden="true" tabindex="-1"></a><span class="in">```glsl</span></span>
<span id="cb23-208"><a href="#cb23-208" aria-hidden="true" tabindex="-1"></a><span class="in">bool inMiddleTriangle(vec2 p) {</span></span>
<span id="cb23-209"><a href="#cb23-209" aria-hidden="true" tabindex="-1"></a><span class="in">    // Vertices of original triangle</span></span>
<span id="cb23-210"><a href="#cb23-210" aria-hidden="true" tabindex="-1"></a><span class="in">    vec2 v0 = vec2(0.0, 1.0);</span></span>
<span id="cb23-211"><a href="#cb23-211" aria-hidden="true" tabindex="-1"></a><span class="in">    vec2 v1 = vec2(-0.866, -0.5);</span></span>
<span id="cb23-212"><a href="#cb23-212" aria-hidden="true" tabindex="-1"></a><span class="in">    vec2 v2 = vec2(0.866, -0.5);</span></span>
<span id="cb23-213"><a href="#cb23-213" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-214"><a href="#cb23-214" aria-hidden="true" tabindex="-1"></a><span class="in">    // Midpoints (vertices of removed triangle)</span></span>
<span id="cb23-215"><a href="#cb23-215" aria-hidden="true" tabindex="-1"></a><span class="in">    vec2 m01 = (v0 + v1) * 0.5;</span></span>
<span id="cb23-216"><a href="#cb23-216" aria-hidden="true" tabindex="-1"></a><span class="in">    vec2 m12 = (v1 + v2) * 0.5;</span></span>
<span id="cb23-217"><a href="#cb23-217" aria-hidden="true" tabindex="-1"></a><span class="in">    vec2 m20 = (v2 + v0) * 0.5;</span></span>
<span id="cb23-218"><a href="#cb23-218" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-219"><a href="#cb23-219" aria-hidden="true" tabindex="-1"></a><span class="in">    // Check if p is inside triangle m01-m12-m20</span></span>
<span id="cb23-220"><a href="#cb23-220" aria-hidden="true" tabindex="-1"></a><span class="in">    // Using sign of cross products</span></span>
<span id="cb23-221"><a href="#cb23-221" aria-hidden="true" tabindex="-1"></a><span class="in">    vec2 e0 = m12 - m01;</span></span>
<span id="cb23-222"><a href="#cb23-222" aria-hidden="true" tabindex="-1"></a><span class="in">    vec2 e1 = m20 - m12;</span></span>
<span id="cb23-223"><a href="#cb23-223" aria-hidden="true" tabindex="-1"></a><span class="in">    vec2 e2 = m01 - m20;</span></span>
<span id="cb23-224"><a href="#cb23-224" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-225"><a href="#cb23-225" aria-hidden="true" tabindex="-1"></a><span class="in">    vec2 p0 = p - m01;</span></span>
<span id="cb23-226"><a href="#cb23-226" aria-hidden="true" tabindex="-1"></a><span class="in">    vec2 p1 = p - m12;</span></span>
<span id="cb23-227"><a href="#cb23-227" aria-hidden="true" tabindex="-1"></a><span class="in">    vec2 p2 = p - m20;</span></span>
<span id="cb23-228"><a href="#cb23-228" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-229"><a href="#cb23-229" aria-hidden="true" tabindex="-1"></a><span class="in">    float s0 = e0.x * p0.y - e0.y * p0.x;</span></span>
<span id="cb23-230"><a href="#cb23-230" aria-hidden="true" tabindex="-1"></a><span class="in">    float s1 = e1.x * p1.y - e1.y * p1.x;</span></span>
<span id="cb23-231"><a href="#cb23-231" aria-hidden="true" tabindex="-1"></a><span class="in">    float s2 = e2.x * p2.y - e2.y * p2.x;</span></span>
<span id="cb23-232"><a href="#cb23-232" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-233"><a href="#cb23-233" aria-hidden="true" tabindex="-1"></a><span class="in">    // All same sign means inside</span></span>
<span id="cb23-234"><a href="#cb23-234" aria-hidden="true" tabindex="-1"></a><span class="in">    return (s0 &gt;= 0.0 &amp;&amp; s1 &gt;= 0.0 &amp;&amp; s2 &gt;= 0.0) || </span></span>
<span id="cb23-235"><a href="#cb23-235" aria-hidden="true" tabindex="-1"></a><span class="in">           (s0 &lt;= 0.0 &amp;&amp; s1 &lt;= 0.0 &amp;&amp; s2 &lt;= 0.0);</span></span>
<span id="cb23-236"><a href="#cb23-236" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb23-237"><a href="#cb23-237" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-238"><a href="#cb23-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-239"><a href="#cb23-239" aria-hidden="true" tabindex="-1"></a><span class="fu">### Complete Implementation</span></span>
<span id="cb23-240"><a href="#cb23-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-241"><a href="#cb23-241" aria-hidden="true" tabindex="-1"></a><span class="in">```glsl</span></span>
<span id="cb23-242"><a href="#cb23-242" aria-hidden="true" tabindex="-1"></a><span class="in">struct Line {</span></span>
<span id="cb23-243"><a href="#cb23-243" aria-hidden="true" tabindex="-1"></a><span class="in">    float a, b, c;</span></span>
<span id="cb23-244"><a href="#cb23-244" aria-hidden="true" tabindex="-1"></a><span class="in">};</span></span>
<span id="cb23-245"><a href="#cb23-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-246"><a href="#cb23-246" aria-hidden="true" tabindex="-1"></a><span class="in">vec2 reflectAcrossLine(vec2 p, Line line) {</span></span>
<span id="cb23-247"><a href="#cb23-247" aria-hidden="true" tabindex="-1"></a><span class="in">    float dist = line.a * p.x + line.b * p.y - line.c;</span></span>
<span id="cb23-248"><a href="#cb23-248" aria-hidden="true" tabindex="-1"></a><span class="in">    float normSq = line.a * line.a + line.b * line.b;</span></span>
<span id="cb23-249"><a href="#cb23-249" aria-hidden="true" tabindex="-1"></a><span class="in">    vec2 normal = vec2(line.a, line.b);</span></span>
<span id="cb23-250"><a href="#cb23-250" aria-hidden="true" tabindex="-1"></a><span class="in">    return p - (2.0 * dist / normSq) * normal;</span></span>
<span id="cb23-251"><a href="#cb23-251" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb23-252"><a href="#cb23-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-253"><a href="#cb23-253" aria-hidden="true" tabindex="-1"></a><span class="in">void setupTriangleEdges(out Line e1, out Line e2, out Line e3) {</span></span>
<span id="cb23-254"><a href="#cb23-254" aria-hidden="true" tabindex="-1"></a><span class="in">    float sqrt3 = 1.732;</span></span>
<span id="cb23-255"><a href="#cb23-255" aria-hidden="true" tabindex="-1"></a><span class="in">    e1 = Line(3.0, -sqrt3, -sqrt3);</span></span>
<span id="cb23-256"><a href="#cb23-256" aria-hidden="true" tabindex="-1"></a><span class="in">    e2 = Line(0.0, 1.0, -0.5);</span></span>
<span id="cb23-257"><a href="#cb23-257" aria-hidden="true" tabindex="-1"></a><span class="in">    e3 = Line(-3.0, -sqrt3, -sqrt3);</span></span>
<span id="cb23-258"><a href="#cb23-258" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb23-259"><a href="#cb23-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-260"><a href="#cb23-260" aria-hidden="true" tabindex="-1"></a><span class="in">vec2 sierpinskiTriangle(vec2 p, int iterations, out bool inFractal) {</span></span>
<span id="cb23-261"><a href="#cb23-261" aria-hidden="true" tabindex="-1"></a><span class="in">    Line e1, e2, e3;</span></span>
<span id="cb23-262"><a href="#cb23-262" aria-hidden="true" tabindex="-1"></a><span class="in">    setupTriangleEdges(e1, e2, e3);</span></span>
<span id="cb23-263"><a href="#cb23-263" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-264"><a href="#cb23-264" aria-hidden="true" tabindex="-1"></a><span class="in">    inFractal = true;</span></span>
<span id="cb23-265"><a href="#cb23-265" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-266"><a href="#cb23-266" aria-hidden="true" tabindex="-1"></a><span class="in">    for(int i = 0; i &lt; iterations; i++) {</span></span>
<span id="cb23-267"><a href="#cb23-267" aria-hidden="true" tabindex="-1"></a><span class="in">        // Fold into triangle</span></span>
<span id="cb23-268"><a href="#cb23-268" aria-hidden="true" tabindex="-1"></a><span class="in">        for(int j = 0; j &lt; 10; j++) {</span></span>
<span id="cb23-269"><a href="#cb23-269" aria-hidden="true" tabindex="-1"></a><span class="in">            float d1 = e1.a * p.x + e1.b * p.y - e1.c;</span></span>
<span id="cb23-270"><a href="#cb23-270" aria-hidden="true" tabindex="-1"></a><span class="in">            if(d1 &lt; 0.0) p = reflectAcrossLine(p, e1);</span></span>
<span id="cb23-271"><a href="#cb23-271" aria-hidden="true" tabindex="-1"></a><span class="in">            </span></span>
<span id="cb23-272"><a href="#cb23-272" aria-hidden="true" tabindex="-1"></a><span class="in">            float d2 = e2.a * p.x + e2.b * p.y - e2.c;</span></span>
<span id="cb23-273"><a href="#cb23-273" aria-hidden="true" tabindex="-1"></a><span class="in">            if(d2 &lt; 0.0) p = reflectAcrossLine(p, e2);</span></span>
<span id="cb23-274"><a href="#cb23-274" aria-hidden="true" tabindex="-1"></a><span class="in">            </span></span>
<span id="cb23-275"><a href="#cb23-275" aria-hidden="true" tabindex="-1"></a><span class="in">            float d3 = e3.a * p.x + e3.b * p.y - e3.c;</span></span>
<span id="cb23-276"><a href="#cb23-276" aria-hidden="true" tabindex="-1"></a><span class="in">            if(d3 &lt; 0.0) p = reflectAcrossLine(p, e3);</span></span>
<span id="cb23-277"><a href="#cb23-277" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb23-278"><a href="#cb23-278" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb23-279"><a href="#cb23-279" aria-hidden="true" tabindex="-1"></a><span class="in">        // Check if in removed region</span></span>
<span id="cb23-280"><a href="#cb23-280" aria-hidden="true" tabindex="-1"></a><span class="in">        if(inMiddleTriangle(p)) {</span></span>
<span id="cb23-281"><a href="#cb23-281" aria-hidden="true" tabindex="-1"></a><span class="in">            inFractal = false;</span></span>
<span id="cb23-282"><a href="#cb23-282" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb23-283"><a href="#cb23-283" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb23-284"><a href="#cb23-284" aria-hidden="true" tabindex="-1"></a><span class="in">        // Scale by 2</span></span>
<span id="cb23-285"><a href="#cb23-285" aria-hidden="true" tabindex="-1"></a><span class="in">        p = p * 2.0;</span></span>
<span id="cb23-286"><a href="#cb23-286" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb23-287"><a href="#cb23-287" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-288"><a href="#cb23-288" aria-hidden="true" tabindex="-1"></a><span class="in">    return p;</span></span>
<span id="cb23-289"><a href="#cb23-289" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb23-290"><a href="#cb23-290" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-291"><a href="#cb23-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-292"><a href="#cb23-292" aria-hidden="true" tabindex="-1"></a><span class="fu">### Visualization</span></span>
<span id="cb23-293"><a href="#cb23-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-294"><a href="#cb23-294" aria-hidden="true" tabindex="-1"></a><span class="in">```glsl</span></span>
<span id="cb23-295"><a href="#cb23-295" aria-hidden="true" tabindex="-1"></a><span class="in">void mainImage(out vec4 fragColor, in vec2 fragCoord)</span></span>
<span id="cb23-296"><a href="#cb23-296" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb23-297"><a href="#cb23-297" aria-hidden="true" tabindex="-1"></a><span class="in">    vec2 uv = fragCoord / iResolution.xy;</span></span>
<span id="cb23-298"><a href="#cb23-298" aria-hidden="true" tabindex="-1"></a><span class="in">    uv = (uv - 0.5) * 3.0;</span></span>
<span id="cb23-299"><a href="#cb23-299" aria-hidden="true" tabindex="-1"></a><span class="in">    uv.x *= iResolution.x / iResolution.y;</span></span>
<span id="cb23-300"><a href="#cb23-300" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-301"><a href="#cb23-301" aria-hidden="true" tabindex="-1"></a><span class="in">    bool inFractal;</span></span>
<span id="cb23-302"><a href="#cb23-302" aria-hidden="true" tabindex="-1"></a><span class="in">    vec2 p_final = sierpinskiTriangle(uv, 6, inFractal);</span></span>
<span id="cb23-303"><a href="#cb23-303" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-304"><a href="#cb23-304" aria-hidden="true" tabindex="-1"></a><span class="in">    vec3 color;</span></span>
<span id="cb23-305"><a href="#cb23-305" aria-hidden="true" tabindex="-1"></a><span class="in">    if(inFractal) {</span></span>
<span id="cb23-306"><a href="#cb23-306" aria-hidden="true" tabindex="-1"></a><span class="in">        // Color by final position</span></span>
<span id="cb23-307"><a href="#cb23-307" aria-hidden="true" tabindex="-1"></a><span class="in">        float t = length(p_final) * 0.1;</span></span>
<span id="cb23-308"><a href="#cb23-308" aria-hidden="true" tabindex="-1"></a><span class="in">        color = palette(t);</span></span>
<span id="cb23-309"><a href="#cb23-309" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb23-310"><a href="#cb23-310" aria-hidden="true" tabindex="-1"></a><span class="in">        // Removed region</span></span>
<span id="cb23-311"><a href="#cb23-311" aria-hidden="true" tabindex="-1"></a><span class="in">        color = vec3(0.1, 0.1, 0.2);</span></span>
<span id="cb23-312"><a href="#cb23-312" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb23-313"><a href="#cb23-313" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-314"><a href="#cb23-314" aria-hidden="true" tabindex="-1"></a><span class="in">    fragColor = vec4(color, 1.0);</span></span>
<span id="cb23-315"><a href="#cb23-315" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb23-316"><a href="#cb23-316" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-317"><a href="#cb23-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-318"><a href="#cb23-318" aria-hidden="true" tabindex="-1"></a>The Sierpinski triangle should now render with mathematically correct reflections!</span>
<span id="cb23-319"><a href="#cb23-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-320"><a href="#cb23-320" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb23-321"><a href="#cb23-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-322"><a href="#cb23-322" aria-hidden="true" tabindex="-1"></a><span class="fu">## Sierpinski Carpet</span></span>
<span id="cb23-323"><a href="#cb23-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-324"><a href="#cb23-324" aria-hidden="true" tabindex="-1"></a><span class="fu">### Mathematical Description</span></span>
<span id="cb23-325"><a href="#cb23-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-326"><a href="#cb23-326" aria-hidden="true" tabindex="-1"></a>The Sierpinski carpet is the square analog:</span>
<span id="cb23-327"><a href="#cb23-327" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Start with a square</span>
<span id="cb23-328"><a href="#cb23-328" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Divide into a 3×3 grid of sub-squares</span>
<span id="cb23-329"><a href="#cb23-329" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Remove the central sub-square</span>
<span id="cb23-330"><a href="#cb23-330" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Recursively repeat on each remaining sub-square</span>
<span id="cb23-331"><a href="#cb23-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-332"><a href="#cb23-332" aria-hidden="true" tabindex="-1"></a>**Note:** Unlike the triangle, the carpet uses axis-aligned divisions, so the implementation is both simpler AND mathematically exact—no approximations needed!</span>
<span id="cb23-333"><a href="#cb23-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-334"><a href="#cb23-334" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Algorithm</span></span>
<span id="cb23-335"><a href="#cb23-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-336"><a href="#cb23-336" aria-hidden="true" tabindex="-1"></a>Much simpler than the triangle because we can use axis-aligned operations!</span>
<span id="cb23-337"><a href="#cb23-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-338"><a href="#cb23-338" aria-hidden="true" tabindex="-1"></a>At each iteration:</span>
<span id="cb23-339"><a href="#cb23-339" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Fold** using <span class="in">`abs()`</span> to create 4-fold symmetry (all quadrants map to first quadrant)</span>
<span id="cb23-340"><a href="#cb23-340" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Scale** by factor of 3</span>
<span id="cb23-341"><a href="#cb23-341" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Check** if we're in the removed middle region</span>
<span id="cb23-342"><a href="#cb23-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-343"><a href="#cb23-343" aria-hidden="true" tabindex="-1"></a><span class="fu">### Implementation</span></span>
<span id="cb23-344"><a href="#cb23-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-345"><a href="#cb23-345" aria-hidden="true" tabindex="-1"></a><span class="in">```glsl</span></span>
<span id="cb23-346"><a href="#cb23-346" aria-hidden="true" tabindex="-1"></a><span class="in">bool sierpinskiCarpet(vec2 p, int iterations) {</span></span>
<span id="cb23-347"><a href="#cb23-347" aria-hidden="true" tabindex="-1"></a><span class="in">    for(int i = 0; i &lt; iterations; i++) {</span></span>
<span id="cb23-348"><a href="#cb23-348" aria-hidden="true" tabindex="-1"></a><span class="in">        // Fold to first quadrant (creates 4-fold symmetry)</span></span>
<span id="cb23-349"><a href="#cb23-349" aria-hidden="true" tabindex="-1"></a><span class="in">        p = abs(p);</span></span>
<span id="cb23-350"><a href="#cb23-350" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb23-351"><a href="#cb23-351" aria-hidden="true" tabindex="-1"></a><span class="in">        // Scale by 3 and recenter</span></span>
<span id="cb23-352"><a href="#cb23-352" aria-hidden="true" tabindex="-1"></a><span class="in">        p = p * 3.0 - vec2(1.0);</span></span>
<span id="cb23-353"><a href="#cb23-353" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb23-354"><a href="#cb23-354" aria-hidden="true" tabindex="-1"></a><span class="in">        // After this transformation, the "removed" region is</span></span>
<span id="cb23-355"><a href="#cb23-355" aria-hidden="true" tabindex="-1"></a><span class="in">        // approximately where both |p.x| &lt; 1 and |p.y| &lt; 1</span></span>
<span id="cb23-356"><a href="#cb23-356" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb23-357"><a href="#cb23-357" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-358"><a href="#cb23-358" aria-hidden="true" tabindex="-1"></a><span class="in">    // Check if in removed region</span></span>
<span id="cb23-359"><a href="#cb23-359" aria-hidden="true" tabindex="-1"></a><span class="in">    // After n iterations, if we're in the central square, we're removed</span></span>
<span id="cb23-360"><a href="#cb23-360" aria-hidden="true" tabindex="-1"></a><span class="in">    return (abs(p.x) &lt; 1.0 &amp;&amp; abs(p.y) &lt; 1.0);</span></span>
<span id="cb23-361"><a href="#cb23-361" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb23-362"><a href="#cb23-362" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-363"><a href="#cb23-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-364"><a href="#cb23-364" aria-hidden="true" tabindex="-1"></a><span class="fu">### More Robust Version</span></span>
<span id="cb23-365"><a href="#cb23-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-366"><a href="#cb23-366" aria-hidden="true" tabindex="-1"></a><span class="in">```glsl</span></span>
<span id="cb23-367"><a href="#cb23-367" aria-hidden="true" tabindex="-1"></a><span class="in">vec2 carpetFold(vec2 p, int iterations, out bool inFractal) {</span></span>
<span id="cb23-368"><a href="#cb23-368" aria-hidden="true" tabindex="-1"></a><span class="in">    inFractal = true;</span></span>
<span id="cb23-369"><a href="#cb23-369" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-370"><a href="#cb23-370" aria-hidden="true" tabindex="-1"></a><span class="in">    for(int i = 0; i &lt; iterations; i++) {</span></span>
<span id="cb23-371"><a href="#cb23-371" aria-hidden="true" tabindex="-1"></a><span class="in">        // Fold to first quadrant</span></span>
<span id="cb23-372"><a href="#cb23-372" aria-hidden="true" tabindex="-1"></a><span class="in">        p = abs(p);</span></span>
<span id="cb23-373"><a href="#cb23-373" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb23-374"><a href="#cb23-374" aria-hidden="true" tabindex="-1"></a><span class="in">        // Check if in middle third in both dimensions</span></span>
<span id="cb23-375"><a href="#cb23-375" aria-hidden="true" tabindex="-1"></a><span class="in">        // In normalized [0,1] space, middle third is [1/3, 2/3]</span></span>
<span id="cb23-376"><a href="#cb23-376" aria-hidden="true" tabindex="-1"></a><span class="in">        vec2 normalizedP = fract(p);  // Get fractional part</span></span>
<span id="cb23-377"><a href="#cb23-377" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb23-378"><a href="#cb23-378" aria-hidden="true" tabindex="-1"></a><span class="in">        bool inMiddleX = (normalizedP.x &gt; 0.33 &amp;&amp; normalizedP.x &lt; 0.67);</span></span>
<span id="cb23-379"><a href="#cb23-379" aria-hidden="true" tabindex="-1"></a><span class="in">        bool inMiddleY = (normalizedP.y &gt; 0.33 &amp;&amp; normalizedP.y &lt; 0.67);</span></span>
<span id="cb23-380"><a href="#cb23-380" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb23-381"><a href="#cb23-381" aria-hidden="true" tabindex="-1"></a><span class="in">        if(inMiddleX &amp;&amp; inMiddleY) {</span></span>
<span id="cb23-382"><a href="#cb23-382" aria-hidden="true" tabindex="-1"></a><span class="in">            inFractal = false;</span></span>
<span id="cb23-383"><a href="#cb23-383" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb23-384"><a href="#cb23-384" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb23-385"><a href="#cb23-385" aria-hidden="true" tabindex="-1"></a><span class="in">        // Scale by 3</span></span>
<span id="cb23-386"><a href="#cb23-386" aria-hidden="true" tabindex="-1"></a><span class="in">        p = p * 3.0;</span></span>
<span id="cb23-387"><a href="#cb23-387" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb23-388"><a href="#cb23-388" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-389"><a href="#cb23-389" aria-hidden="true" tabindex="-1"></a><span class="in">    return p;</span></span>
<span id="cb23-390"><a href="#cb23-390" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb23-391"><a href="#cb23-391" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-392"><a href="#cb23-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-393"><a href="#cb23-393" aria-hidden="true" tabindex="-1"></a><span class="fu">### Clean Implementation</span></span>
<span id="cb23-394"><a href="#cb23-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-395"><a href="#cb23-395" aria-hidden="true" tabindex="-1"></a>A cleaner approach using the subdivision pattern:</span>
<span id="cb23-396"><a href="#cb23-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-397"><a href="#cb23-397" aria-hidden="true" tabindex="-1"></a><span class="in">```glsl</span></span>
<span id="cb23-398"><a href="#cb23-398" aria-hidden="true" tabindex="-1"></a><span class="in">bool inSierpinskiCarpet(vec2 p, int iterations) {</span></span>
<span id="cb23-399"><a href="#cb23-399" aria-hidden="true" tabindex="-1"></a><span class="in">    // Normalize to [0, 1]</span></span>
<span id="cb23-400"><a href="#cb23-400" aria-hidden="true" tabindex="-1"></a><span class="in">    p = p * 0.5 + 0.5;</span></span>
<span id="cb23-401"><a href="#cb23-401" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-402"><a href="#cb23-402" aria-hidden="true" tabindex="-1"></a><span class="in">    for(int i = 0; i &lt; iterations; i++) {</span></span>
<span id="cb23-403"><a href="#cb23-403" aria-hidden="true" tabindex="-1"></a><span class="in">        // Which cell of 3×3 grid are we in?</span></span>
<span id="cb23-404"><a href="#cb23-404" aria-hidden="true" tabindex="-1"></a><span class="in">        vec2 cell = floor(p * 3.0);</span></span>
<span id="cb23-405"><a href="#cb23-405" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb23-406"><a href="#cb23-406" aria-hidden="true" tabindex="-1"></a><span class="in">        // Middle cell (1,1) is removed</span></span>
<span id="cb23-407"><a href="#cb23-407" aria-hidden="true" tabindex="-1"></a><span class="in">        if(cell.x == 1.0 &amp;&amp; cell.y == 1.0) {</span></span>
<span id="cb23-408"><a href="#cb23-408" aria-hidden="true" tabindex="-1"></a><span class="in">            return false;  // In removed region</span></span>
<span id="cb23-409"><a href="#cb23-409" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb23-410"><a href="#cb23-410" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb23-411"><a href="#cb23-411" aria-hidden="true" tabindex="-1"></a><span class="in">        // Zoom into current cell</span></span>
<span id="cb23-412"><a href="#cb23-412" aria-hidden="true" tabindex="-1"></a><span class="in">        p = fract(p * 3.0);</span></span>
<span id="cb23-413"><a href="#cb23-413" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb23-414"><a href="#cb23-414" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-415"><a href="#cb23-415" aria-hidden="true" tabindex="-1"></a><span class="in">    return true;  // In fractal</span></span>
<span id="cb23-416"><a href="#cb23-416" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb23-417"><a href="#cb23-417" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-418"><a href="#cb23-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-419"><a href="#cb23-419" aria-hidden="true" tabindex="-1"></a><span class="fu">### Visualization</span></span>
<span id="cb23-420"><a href="#cb23-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-421"><a href="#cb23-421" aria-hidden="true" tabindex="-1"></a><span class="in">```glsl</span></span>
<span id="cb23-422"><a href="#cb23-422" aria-hidden="true" tabindex="-1"></a><span class="in">void mainImage(out vec4 fragColor, in vec2 fragCoord)</span></span>
<span id="cb23-423"><a href="#cb23-423" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb23-424"><a href="#cb23-424" aria-hidden="true" tabindex="-1"></a><span class="in">    vec2 uv = fragCoord / iResolution.xy;</span></span>
<span id="cb23-425"><a href="#cb23-425" aria-hidden="true" tabindex="-1"></a><span class="in">    uv = (uv - 0.5) * 2.0;</span></span>
<span id="cb23-426"><a href="#cb23-426" aria-hidden="true" tabindex="-1"></a><span class="in">    uv.x *= iResolution.x / iResolution.y;</span></span>
<span id="cb23-427"><a href="#cb23-427" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-428"><a href="#cb23-428" aria-hidden="true" tabindex="-1"></a><span class="in">    bool inFractal = inSierpinskiCarpet(uv, 6);</span></span>
<span id="cb23-429"><a href="#cb23-429" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-430"><a href="#cb23-430" aria-hidden="true" tabindex="-1"></a><span class="in">    vec3 color = inFractal ? vec3(1.0, 1.0, 0.8) : vec3(0.1, 0.1, 0.2);</span></span>
<span id="cb23-431"><a href="#cb23-431" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-432"><a href="#cb23-432" aria-hidden="true" tabindex="-1"></a><span class="in">    fragColor = vec4(color, 1.0);</span></span>
<span id="cb23-433"><a href="#cb23-433" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb23-434"><a href="#cb23-434" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-435"><a href="#cb23-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-436"><a href="#cb23-436" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb23-437"><a href="#cb23-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-438"><a href="#cb23-438" aria-hidden="true" tabindex="-1"></a><span class="fu">## Menger Sponge (3D Extension)</span></span>
<span id="cb23-439"><a href="#cb23-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-440"><a href="#cb23-440" aria-hidden="true" tabindex="-1"></a><span class="fu">### Mathematical Description</span></span>
<span id="cb23-441"><a href="#cb23-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-442"><a href="#cb23-442" aria-hidden="true" tabindex="-1"></a>The Menger sponge is the 3D analog of the Sierpinski carpet:</span>
<span id="cb23-443"><a href="#cb23-443" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Start with a cube</span>
<span id="cb23-444"><a href="#cb23-444" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Divide into a 3×3×3 grid of sub-cubes (27 total)</span>
<span id="cb23-445"><a href="#cb23-445" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Remove the central sub-cube and the 6 face-centered sub-cubes (7 removed, 20 remain)</span>
<span id="cb23-446"><a href="#cb23-446" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Recursively repeat on each remaining sub-cube</span>
<span id="cb23-447"><a href="#cb23-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-448"><a href="#cb23-448" aria-hidden="true" tabindex="-1"></a>**Note:** Like the carpet, the sponge uses axis-aligned divisions, giving us an exact, mathematically precise implementation.</span>
<span id="cb23-449"><a href="#cb23-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-450"><a href="#cb23-450" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Algorithm</span></span>
<span id="cb23-451"><a href="#cb23-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-452"><a href="#cb23-452" aria-hidden="true" tabindex="-1"></a>Same pattern as the carpet, but in 3D!</span>
<span id="cb23-453"><a href="#cb23-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-454"><a href="#cb23-454" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Fold** using <span class="in">`abs(p)`</span> to create octahedral symmetry</span>
<span id="cb23-455"><a href="#cb23-455" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Scale** by factor of 3</span>
<span id="cb23-456"><a href="#cb23-456" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Check** if we're in a removed region (middle cross pattern)</span>
<span id="cb23-457"><a href="#cb23-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-458"><a href="#cb23-458" aria-hidden="true" tabindex="-1"></a><span class="fu">### Implementation</span></span>
<span id="cb23-459"><a href="#cb23-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-460"><a href="#cb23-460" aria-hidden="true" tabindex="-1"></a><span class="in">```glsl</span></span>
<span id="cb23-461"><a href="#cb23-461" aria-hidden="true" tabindex="-1"></a><span class="in">bool inMengerSponge(vec3 p, int iterations) {</span></span>
<span id="cb23-462"><a href="#cb23-462" aria-hidden="true" tabindex="-1"></a><span class="in">    for(int i = 0; i &lt; iterations; i++) {</span></span>
<span id="cb23-463"><a href="#cb23-463" aria-hidden="true" tabindex="-1"></a><span class="in">        // Fold to first octant</span></span>
<span id="cb23-464"><a href="#cb23-464" aria-hidden="true" tabindex="-1"></a><span class="in">        p = abs(p);</span></span>
<span id="cb23-465"><a href="#cb23-465" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb23-466"><a href="#cb23-466" aria-hidden="true" tabindex="-1"></a><span class="in">        // Which cell of 3×3×3 grid?</span></span>
<span id="cb23-467"><a href="#cb23-467" aria-hidden="true" tabindex="-1"></a><span class="in">        vec3 cell = floor(p * 3.0);</span></span>
<span id="cb23-468"><a href="#cb23-468" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb23-469"><a href="#cb23-469" aria-hidden="true" tabindex="-1"></a><span class="in">        // Removed regions: center cube and face centers</span></span>
<span id="cb23-470"><a href="#cb23-470" aria-hidden="true" tabindex="-1"></a><span class="in">        // Center: (1,1,1)</span></span>
<span id="cb23-471"><a href="#cb23-471" aria-hidden="true" tabindex="-1"></a><span class="in">        // Face centers: (1,1,0), (1,1,2), (1,0,1), (1,2,1), (0,1,1), (2,1,1)</span></span>
<span id="cb23-472"><a href="#cb23-472" aria-hidden="true" tabindex="-1"></a><span class="in">        // Pattern: at least 2 coordinates equal to 1</span></span>
<span id="cb23-473"><a href="#cb23-473" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb23-474"><a href="#cb23-474" aria-hidden="true" tabindex="-1"></a><span class="in">        float ones = 0.0;</span></span>
<span id="cb23-475"><a href="#cb23-475" aria-hidden="true" tabindex="-1"></a><span class="in">        if(cell.x == 1.0) ones += 1.0;</span></span>
<span id="cb23-476"><a href="#cb23-476" aria-hidden="true" tabindex="-1"></a><span class="in">        if(cell.y == 1.0) ones += 1.0;</span></span>
<span id="cb23-477"><a href="#cb23-477" aria-hidden="true" tabindex="-1"></a><span class="in">        if(cell.z == 1.0) ones += 1.0;</span></span>
<span id="cb23-478"><a href="#cb23-478" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb23-479"><a href="#cb23-479" aria-hidden="true" tabindex="-1"></a><span class="in">        if(ones &gt;= 2.0) {</span></span>
<span id="cb23-480"><a href="#cb23-480" aria-hidden="true" tabindex="-1"></a><span class="in">            return false;  // Removed region</span></span>
<span id="cb23-481"><a href="#cb23-481" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb23-482"><a href="#cb23-482" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb23-483"><a href="#cb23-483" aria-hidden="true" tabindex="-1"></a><span class="in">        // Zoom into cell</span></span>
<span id="cb23-484"><a href="#cb23-484" aria-hidden="true" tabindex="-1"></a><span class="in">        p = fract(p * 3.0);</span></span>
<span id="cb23-485"><a href="#cb23-485" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb23-486"><a href="#cb23-486" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-487"><a href="#cb23-487" aria-hidden="true" tabindex="-1"></a><span class="in">    return true;</span></span>
<span id="cb23-488"><a href="#cb23-488" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb23-489"><a href="#cb23-489" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-490"><a href="#cb23-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-491"><a href="#cb23-491" aria-hidden="true" tabindex="-1"></a><span class="fu">### Alternative: Using SDF Approach</span></span>
<span id="cb23-492"><a href="#cb23-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-493"><a href="#cb23-493" aria-hidden="true" tabindex="-1"></a>We can also implement the Menger sponge as a signed distance function for use with Day 4's raymarching:</span>
<span id="cb23-494"><a href="#cb23-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-495"><a href="#cb23-495" aria-hidden="true" tabindex="-1"></a><span class="in">```glsl</span></span>
<span id="cb23-496"><a href="#cb23-496" aria-hidden="true" tabindex="-1"></a><span class="in">float sdBox(vec3 p, vec3 b) {</span></span>
<span id="cb23-497"><a href="#cb23-497" aria-hidden="true" tabindex="-1"></a><span class="in">    vec3 q = abs(p) - b;</span></span>
<span id="cb23-498"><a href="#cb23-498" aria-hidden="true" tabindex="-1"></a><span class="in">    return length(max(q, 0.0)) + min(max(q.x, max(q.y, q.z)), 0.0);</span></span>
<span id="cb23-499"><a href="#cb23-499" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb23-500"><a href="#cb23-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-501"><a href="#cb23-501" aria-hidden="true" tabindex="-1"></a><span class="in">float sdMengerSponge(vec3 p, int iterations) {</span></span>
<span id="cb23-502"><a href="#cb23-502" aria-hidden="true" tabindex="-1"></a><span class="in">    float d = sdBox(p, vec3(1.0));  // Start with unit cube</span></span>
<span id="cb23-503"><a href="#cb23-503" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-504"><a href="#cb23-504" aria-hidden="true" tabindex="-1"></a><span class="in">    float scale = 1.0;</span></span>
<span id="cb23-505"><a href="#cb23-505" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-506"><a href="#cb23-506" aria-hidden="true" tabindex="-1"></a><span class="in">    for(int i = 0; i &lt; iterations; i++) {</span></span>
<span id="cb23-507"><a href="#cb23-507" aria-hidden="true" tabindex="-1"></a><span class="in">        // Fold to first octant</span></span>
<span id="cb23-508"><a href="#cb23-508" aria-hidden="true" tabindex="-1"></a><span class="in">        vec3 a = mod(p * scale, 2.0) - 1.0;</span></span>
<span id="cb23-509"><a href="#cb23-509" aria-hidden="true" tabindex="-1"></a><span class="in">        scale *= 3.0;</span></span>
<span id="cb23-510"><a href="#cb23-510" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb23-511"><a href="#cb23-511" aria-hidden="true" tabindex="-1"></a><span class="in">        vec3 r = abs(1.0 - 3.0 * abs(a));</span></span>
<span id="cb23-512"><a href="#cb23-512" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb23-513"><a href="#cb23-513" aria-hidden="true" tabindex="-1"></a><span class="in">        // Distance to cross (removed region)</span></span>
<span id="cb23-514"><a href="#cb23-514" aria-hidden="true" tabindex="-1"></a><span class="in">        float da = max(r.x, r.y);</span></span>
<span id="cb23-515"><a href="#cb23-515" aria-hidden="true" tabindex="-1"></a><span class="in">        float db = max(r.y, r.z);</span></span>
<span id="cb23-516"><a href="#cb23-516" aria-hidden="true" tabindex="-1"></a><span class="in">        float dc = max(r.z, r.x);</span></span>
<span id="cb23-517"><a href="#cb23-517" aria-hidden="true" tabindex="-1"></a><span class="in">        float c = (min(da, min(db, dc)) - 1.0) / scale;</span></span>
<span id="cb23-518"><a href="#cb23-518" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb23-519"><a href="#cb23-519" aria-hidden="true" tabindex="-1"></a><span class="in">        d = max(d, c);</span></span>
<span id="cb23-520"><a href="#cb23-520" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb23-521"><a href="#cb23-521" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-522"><a href="#cb23-522" aria-hidden="true" tabindex="-1"></a><span class="in">    return d;</span></span>
<span id="cb23-523"><a href="#cb23-523" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb23-524"><a href="#cb23-524" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-525"><a href="#cb23-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-526"><a href="#cb23-526" aria-hidden="true" tabindex="-1"></a><span class="fu">### Rendering with Raymarching</span></span>
<span id="cb23-527"><a href="#cb23-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-528"><a href="#cb23-528" aria-hidden="true" tabindex="-1"></a><span class="in">```glsl</span></span>
<span id="cb23-529"><a href="#cb23-529" aria-hidden="true" tabindex="-1"></a><span class="in">void mainImage(out vec4 fragColor, in vec2 fragCoord)</span></span>
<span id="cb23-530"><a href="#cb23-530" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb23-531"><a href="#cb23-531" aria-hidden="true" tabindex="-1"></a><span class="in">    // Setup ray (using Day 4 techniques)</span></span>
<span id="cb23-532"><a href="#cb23-532" aria-hidden="true" tabindex="-1"></a><span class="in">    Ray ray = getRay(fragCoord, iResolution.xy, 45.0);</span></span>
<span id="cb23-533"><a href="#cb23-533" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-534"><a href="#cb23-534" aria-hidden="true" tabindex="-1"></a><span class="in">    // Raymarch</span></span>
<span id="cb23-535"><a href="#cb23-535" aria-hidden="true" tabindex="-1"></a><span class="in">    float t = 0.0;</span></span>
<span id="cb23-536"><a href="#cb23-536" aria-hidden="true" tabindex="-1"></a><span class="in">    for(int i = 0; i &lt; 100; i++) {</span></span>
<span id="cb23-537"><a href="#cb23-537" aria-hidden="true" tabindex="-1"></a><span class="in">        vec3 pos = ray.origin + t * ray.direction;</span></span>
<span id="cb23-538"><a href="#cb23-538" aria-hidden="true" tabindex="-1"></a><span class="in">        float d = sdMengerSponge(pos, 4);</span></span>
<span id="cb23-539"><a href="#cb23-539" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb23-540"><a href="#cb23-540" aria-hidden="true" tabindex="-1"></a><span class="in">        if(abs(d) &lt; 0.001) {</span></span>
<span id="cb23-541"><a href="#cb23-541" aria-hidden="true" tabindex="-1"></a><span class="in">            // Hit!</span></span>
<span id="cb23-542"><a href="#cb23-542" aria-hidden="true" tabindex="-1"></a><span class="in">            vec3 normal = estimateNormal(pos);  // Day 4 technique</span></span>
<span id="cb23-543"><a href="#cb23-543" aria-hidden="true" tabindex="-1"></a><span class="in">            </span></span>
<span id="cb23-544"><a href="#cb23-544" aria-hidden="true" tabindex="-1"></a><span class="in">            vec3 lightDir = normalize(vec3(1.0, 1.0, 1.0));</span></span>
<span id="cb23-545"><a href="#cb23-545" aria-hidden="true" tabindex="-1"></a><span class="in">            float diffuse = max(0.0, dot(normal, lightDir));</span></span>
<span id="cb23-546"><a href="#cb23-546" aria-hidden="true" tabindex="-1"></a><span class="in">            </span></span>
<span id="cb23-547"><a href="#cb23-547" aria-hidden="true" tabindex="-1"></a><span class="in">            vec3 color = vec3(1.0, 0.8, 0.6) * diffuse + vec3(0.1);</span></span>
<span id="cb23-548"><a href="#cb23-548" aria-hidden="true" tabindex="-1"></a><span class="in">            fragColor = vec4(color, 1.0);</span></span>
<span id="cb23-549"><a href="#cb23-549" aria-hidden="true" tabindex="-1"></a><span class="in">            return;</span></span>
<span id="cb23-550"><a href="#cb23-550" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb23-551"><a href="#cb23-551" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb23-552"><a href="#cb23-552" aria-hidden="true" tabindex="-1"></a><span class="in">        t += d;</span></span>
<span id="cb23-553"><a href="#cb23-553" aria-hidden="true" tabindex="-1"></a><span class="in">        if(t &gt; 100.0) break;</span></span>
<span id="cb23-554"><a href="#cb23-554" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb23-555"><a href="#cb23-555" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-556"><a href="#cb23-556" aria-hidden="true" tabindex="-1"></a><span class="in">    // Miss</span></span>
<span id="cb23-557"><a href="#cb23-557" aria-hidden="true" tabindex="-1"></a><span class="in">    fragColor = vec4(0.1, 0.1, 0.2, 1.0);</span></span>
<span id="cb23-558"><a href="#cb23-558" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb23-559"><a href="#cb23-559" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-560"><a href="#cb23-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-561"><a href="#cb23-561" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb23-562"><a href="#cb23-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-563"><a href="#cb23-563" aria-hidden="true" tabindex="-1"></a><span class="fu">## General Principles of Folding Fractals</span></span>
<span id="cb23-564"><a href="#cb23-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-565"><a href="#cb23-565" aria-hidden="true" tabindex="-1"></a><span class="fu">### Key Ingredients</span></span>
<span id="cb23-566"><a href="#cb23-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-567"><a href="#cb23-567" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Symmetry operations**: </span>
<span id="cb23-568"><a href="#cb23-568" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span><span class="in">`abs()`</span> for axis-aligned symmetry</span>
<span id="cb23-569"><a href="#cb23-569" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Reflections for arbitrary symmetry</span>
<span id="cb23-570"><a href="#cb23-570" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb23-571"><a href="#cb23-571" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Scaling factor**:</span>
<span id="cb23-572"><a href="#cb23-572" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Factor of 2: Sierpinski triangle</span>
<span id="cb23-573"><a href="#cb23-573" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Factor of 3: Sierpinski carpet, Menger sponge</span>
<span id="cb23-574"><a href="#cb23-574" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>General factor $s$: determines fractal dimension</span>
<span id="cb23-575"><a href="#cb23-575" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb23-576"><a href="#cb23-576" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Removal pattern**:</span>
<span id="cb23-577"><a href="#cb23-577" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Which regions get removed at each level</span>
<span id="cb23-578"><a href="#cb23-578" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Defines the fractal's structure</span>
<span id="cb23-579"><a href="#cb23-579" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb23-580"><a href="#cb23-580" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Iteration**:</span>
<span id="cb23-581"><a href="#cb23-581" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>More iterations = more detail</span>
<span id="cb23-582"><a href="#cb23-582" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Computational cost grows linearly</span>
<span id="cb23-583"><a href="#cb23-583" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Visual complexity grows exponentially</span>
<span id="cb23-584"><a href="#cb23-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-585"><a href="#cb23-585" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fractal Dimension</span></span>
<span id="cb23-586"><a href="#cb23-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-587"><a href="#cb23-587" aria-hidden="true" tabindex="-1"></a>The fractal dimension $D$ can be computed from the scaling factor $s$ and the number of remaining pieces $N$:</span>
<span id="cb23-588"><a href="#cb23-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-589"><a href="#cb23-589" aria-hidden="true" tabindex="-1"></a>$$D = \frac{\log N}{\log s}$$</span>
<span id="cb23-590"><a href="#cb23-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-591"><a href="#cb23-591" aria-hidden="true" tabindex="-1"></a>**Examples:**</span>
<span id="cb23-592"><a href="#cb23-592" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Sierpinski triangle**: $N = 3$ pieces, scale factor $s = 2$</span>
<span id="cb23-593"><a href="#cb23-593" aria-hidden="true" tabindex="-1"></a>  $$D = \frac{\log 3}{\log 2} \approx 1.585$$</span>
<span id="cb23-594"><a href="#cb23-594" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-595"><a href="#cb23-595" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Sierpinski carpet**: $N = 8$ pieces, scale factor $s = 3$</span>
<span id="cb23-596"><a href="#cb23-596" aria-hidden="true" tabindex="-1"></a>  $$D = \frac{\log 8}{\log 3} \approx 1.893$$</span>
<span id="cb23-597"><a href="#cb23-597" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-598"><a href="#cb23-598" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Menger sponge**: $N = 20$ pieces, scale factor $s = 3$</span>
<span id="cb23-599"><a href="#cb23-599" aria-hidden="true" tabindex="-1"></a>  $$D = \frac{\log 20}{\log 3} \approx 2.727$$</span>
<span id="cb23-600"><a href="#cb23-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-601"><a href="#cb23-601" aria-hidden="true" tabindex="-1"></a>The fractal dimension is between the topological dimension and the embedding dimension, reflecting the fractal's "in-between" nature!</span>
<span id="cb23-602"><a href="#cb23-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-603"><a href="#cb23-603" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb23-604"><a href="#cb23-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-605"><a href="#cb23-605" aria-hidden="true" tabindex="-1"></a><span class="fu">## Coloring Strategies</span></span>
<span id="cb23-606"><a href="#cb23-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-607"><a href="#cb23-607" aria-hidden="true" tabindex="-1"></a><span class="fu">### By Iteration Depth</span></span>
<span id="cb23-608"><a href="#cb23-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-609"><a href="#cb23-609" aria-hidden="true" tabindex="-1"></a>Track which iteration first identifies a point as removed:</span>
<span id="cb23-610"><a href="#cb23-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-611"><a href="#cb23-611" aria-hidden="true" tabindex="-1"></a><span class="in">```glsl</span></span>
<span id="cb23-612"><a href="#cb23-612" aria-hidden="true" tabindex="-1"></a><span class="in">int firstRemovedIter = -1;</span></span>
<span id="cb23-613"><a href="#cb23-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-614"><a href="#cb23-614" aria-hidden="true" tabindex="-1"></a><span class="in">for(int i = 0; i &lt; iterations; i++) {</span></span>
<span id="cb23-615"><a href="#cb23-615" aria-hidden="true" tabindex="-1"></a><span class="in">    // [Folding and scaling]</span></span>
<span id="cb23-616"><a href="#cb23-616" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-617"><a href="#cb23-617" aria-hidden="true" tabindex="-1"></a><span class="in">    if([in removed region] &amp;&amp; firstRemovedIter &lt; 0) {</span></span>
<span id="cb23-618"><a href="#cb23-618" aria-hidden="true" tabindex="-1"></a><span class="in">        firstRemovedIter = i;</span></span>
<span id="cb23-619"><a href="#cb23-619" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb23-620"><a href="#cb23-620" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb23-621"><a href="#cb23-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-622"><a href="#cb23-622" aria-hidden="true" tabindex="-1"></a><span class="in">float t = float(firstRemovedIter) / float(iterations);</span></span>
<span id="cb23-623"><a href="#cb23-623" aria-hidden="true" tabindex="-1"></a><span class="in">vec3 color = palette(t);</span></span>
<span id="cb23-624"><a href="#cb23-624" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-625"><a href="#cb23-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-626"><a href="#cb23-626" aria-hidden="true" tabindex="-1"></a><span class="fu">### By Distance After Folding</span></span>
<span id="cb23-627"><a href="#cb23-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-628"><a href="#cb23-628" aria-hidden="true" tabindex="-1"></a><span class="in">```glsl</span></span>
<span id="cb23-629"><a href="#cb23-629" aria-hidden="true" tabindex="-1"></a><span class="in">vec2 p_final = [after all folding];</span></span>
<span id="cb23-630"><a href="#cb23-630" aria-hidden="true" tabindex="-1"></a><span class="in">float d = length(p_final);</span></span>
<span id="cb23-631"><a href="#cb23-631" aria-hidden="true" tabindex="-1"></a><span class="in">vec3 color = vec3(d * 0.5);  // Grayscale by distance</span></span>
<span id="cb23-632"><a href="#cb23-632" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-633"><a href="#cb23-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-634"><a href="#cb23-634" aria-hidden="true" tabindex="-1"></a><span class="fu">### By Cell Position</span></span>
<span id="cb23-635"><a href="#cb23-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-636"><a href="#cb23-636" aria-hidden="true" tabindex="-1"></a>For grid-based fractals (carpet, sponge), color by which sub-cell the point lands in:</span>
<span id="cb23-637"><a href="#cb23-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-638"><a href="#cb23-638" aria-hidden="true" tabindex="-1"></a><span class="in">```glsl</span></span>
<span id="cb23-639"><a href="#cb23-639" aria-hidden="true" tabindex="-1"></a><span class="in">vec3 cell = floor(p * 3.0);</span></span>
<span id="cb23-640"><a href="#cb23-640" aria-hidden="true" tabindex="-1"></a><span class="in">vec3 color = cell / 3.0;  // RGB from cell coordinates</span></span>
<span id="cb23-641"><a href="#cb23-641" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-642"><a href="#cb23-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-643"><a href="#cb23-643" aria-hidden="true" tabindex="-1"></a><span class="fu">### Hybrid: Distance Field + Fractal</span></span>
<span id="cb23-644"><a href="#cb23-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-645"><a href="#cb23-645" aria-hidden="true" tabindex="-1"></a>For 3D fractals, combine distance estimation with fractal membership:</span>
<span id="cb23-646"><a href="#cb23-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-647"><a href="#cb23-647" aria-hidden="true" tabindex="-1"></a><span class="in">```glsl</span></span>
<span id="cb23-648"><a href="#cb23-648" aria-hidden="true" tabindex="-1"></a><span class="in">float d = sdMengerSponge(p, iterations);</span></span>
<span id="cb23-649"><a href="#cb23-649" aria-hidden="true" tabindex="-1"></a><span class="in">vec3 color;</span></span>
<span id="cb23-650"><a href="#cb23-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-651"><a href="#cb23-651" aria-hidden="true" tabindex="-1"></a><span class="in">if(d &lt; 0.0) {</span></span>
<span id="cb23-652"><a href="#cb23-652" aria-hidden="true" tabindex="-1"></a><span class="in">    // Inside sponge</span></span>
<span id="cb23-653"><a href="#cb23-653" aria-hidden="true" tabindex="-1"></a><span class="in">    color = vec3(1.0, 0.8, 0.6);</span></span>
<span id="cb23-654"><a href="#cb23-654" aria-hidden="true" tabindex="-1"></a><span class="in">} else {</span></span>
<span id="cb23-655"><a href="#cb23-655" aria-hidden="true" tabindex="-1"></a><span class="in">    // Outside, but show distance</span></span>
<span id="cb23-656"><a href="#cb23-656" aria-hidden="true" tabindex="-1"></a><span class="in">    color = vec3(0.1) + vec3(0.2) / (1.0 + d);</span></span>
<span id="cb23-657"><a href="#cb23-657" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb23-658"><a href="#cb23-658" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-659"><a href="#cb23-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-660"><a href="#cb23-660" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb23-661"><a href="#cb23-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-662"><a href="#cb23-662" aria-hidden="true" tabindex="-1"></a><span class="fu">## Variations and Experiments</span></span>
<span id="cb23-663"><a href="#cb23-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-664"><a href="#cb23-664" aria-hidden="true" tabindex="-1"></a><span class="fu">### Different Folding Operations</span></span>
<span id="cb23-665"><a href="#cb23-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-666"><a href="#cb23-666" aria-hidden="true" tabindex="-1"></a>Try different symmetry groups:</span>
<span id="cb23-667"><a href="#cb23-667" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Hexagonal symmetry (6-fold)</span>
<span id="cb23-668"><a href="#cb23-668" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Octahedral symmetry (for 3D)</span>
<span id="cb23-669"><a href="#cb23-669" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Custom reflection patterns</span>
<span id="cb23-670"><a href="#cb23-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-671"><a href="#cb23-671" aria-hidden="true" tabindex="-1"></a><span class="fu">### Different Scale Factors</span></span>
<span id="cb23-672"><a href="#cb23-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-673"><a href="#cb23-673" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Scale by 4: sparser fractal</span>
<span id="cb23-674"><a href="#cb23-674" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Scale by 1.5: denser fractal</span>
<span id="cb23-675"><a href="#cb23-675" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Non-integer scales: unusual structures</span>
<span id="cb23-676"><a href="#cb23-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-677"><a href="#cb23-677" aria-hidden="true" tabindex="-1"></a><span class="fu">### Animated Parameters</span></span>
<span id="cb23-678"><a href="#cb23-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-679"><a href="#cb23-679" aria-hidden="true" tabindex="-1"></a><span class="in">```glsl</span></span>
<span id="cb23-680"><a href="#cb23-680" aria-hidden="true" tabindex="-1"></a><span class="in">float scale = 2.0 + 0.5 * sin(iTime);</span></span>
<span id="cb23-681"><a href="#cb23-681" aria-hidden="true" tabindex="-1"></a><span class="in">p = p * scale;</span></span>
<span id="cb23-682"><a href="#cb23-682" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-683"><a href="#cb23-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-684"><a href="#cb23-684" aria-hidden="true" tabindex="-1"></a>Watch the fractal morph as the scale factor changes!</span>
<span id="cb23-685"><a href="#cb23-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-686"><a href="#cb23-686" aria-hidden="true" tabindex="-1"></a><span class="fu">### Color by Orbit</span></span>
<span id="cb23-687"><a href="#cb23-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-688"><a href="#cb23-688" aria-hidden="true" tabindex="-1"></a>Track the "orbit" of the point through the folding process:</span>
<span id="cb23-689"><a href="#cb23-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-690"><a href="#cb23-690" aria-hidden="true" tabindex="-1"></a><span class="in">```glsl</span></span>
<span id="cb23-691"><a href="#cb23-691" aria-hidden="true" tabindex="-1"></a><span class="in">float orbit = 0.0;</span></span>
<span id="cb23-692"><a href="#cb23-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-693"><a href="#cb23-693" aria-hidden="true" tabindex="-1"></a><span class="in">for(int i = 0; i &lt; iterations; i++) {</span></span>
<span id="cb23-694"><a href="#cb23-694" aria-hidden="true" tabindex="-1"></a><span class="in">    orbit += length(p);  // Accumulate total distance traveled</span></span>
<span id="cb23-695"><a href="#cb23-695" aria-hidden="true" tabindex="-1"></a><span class="in">    // [Folding operations]</span></span>
<span id="cb23-696"><a href="#cb23-696" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb23-697"><a href="#cb23-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-698"><a href="#cb23-698" aria-hidden="true" tabindex="-1"></a><span class="in">vec3 color = palette(orbit / 10.0);</span></span>
<span id="cb23-699"><a href="#cb23-699" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-700"><a href="#cb23-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-701"><a href="#cb23-701" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3D Variations</span></span>
<span id="cb23-702"><a href="#cb23-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-703"><a href="#cb23-703" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Cross-Menger**: Different removal pattern (only center)</span>
<span id="cb23-704"><a href="#cb23-704" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Jerusalem Cube**: Variation with different symmetry</span>
<span id="cb23-705"><a href="#cb23-705" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Hybrid fractals**: Combine different removal patterns at different scales</span>
<span id="cb23-706"><a href="#cb23-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-707"><a href="#cb23-707" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb23-708"><a href="#cb23-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-709"><a href="#cb23-709" aria-hidden="true" tabindex="-1"></a><span class="fu">## Connection to Course Topics</span></span>
<span id="cb23-710"><a href="#cb23-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-711"><a href="#cb23-711" aria-hidden="true" tabindex="-1"></a><span class="fu">### Day 2: Iteration Creates Fractals</span></span>
<span id="cb23-712"><a href="#cb23-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-713"><a href="#cb23-713" aria-hidden="true" tabindex="-1"></a>Both folding fractals and the Mandelbrot set/Apollonian gasket share the principle: **simple operations iterated create complex structure**.</span>
<span id="cb23-714"><a href="#cb23-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-715"><a href="#cb23-715" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Mandelbrot**: $z \to z^2 + c$ (complex arithmetic iteration)</span>
<span id="cb23-716"><a href="#cb23-716" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Apollonian**: Repeated circle inversions (geometric iteration)</span>
<span id="cb23-717"><a href="#cb23-717" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Sierpinski**: Fold + scale (geometric iteration with scaling)</span>
<span id="cb23-718"><a href="#cb23-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-719"><a href="#cb23-719" aria-hidden="true" tabindex="-1"></a><span class="fu">### Day 3: Folding Without Scaling</span></span>
<span id="cb23-720"><a href="#cb23-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-721"><a href="#cb23-721" aria-hidden="true" tabindex="-1"></a>Euclidean and hyperbolic tilings use folding **without** scaling:</span>
<span id="cb23-722"><a href="#cb23-722" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Reflection brings points into fundamental domain</span>
<span id="cb23-723"><a href="#cb23-723" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>No scaling → fills space with copies</span>
<span id="cb23-724"><a href="#cb23-724" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>With scaling → creates fractal structure</span>
<span id="cb23-725"><a href="#cb23-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-726"><a href="#cb23-726" aria-hidden="true" tabindex="-1"></a><span class="fu">### Day 4: 3D Rendering</span></span>
<span id="cb23-727"><a href="#cb23-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-728"><a href="#cb23-728" aria-hidden="true" tabindex="-1"></a>The Menger sponge naturally extends to 3D:</span>
<span id="cb23-729"><a href="#cb23-729" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Can be rendered as SDF (raymarching)</span>
<span id="cb23-730"><a href="#cb23-730" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Can be rendered as boolean test (simple ray casting)</span>
<span id="cb23-731"><a href="#cb23-731" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Demonstrates 3D coordinate folding</span>
<span id="cb23-732"><a href="#cb23-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-733"><a href="#cb23-733" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb23-734"><a href="#cb23-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-735"><a href="#cb23-735" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises</span></span>
<span id="cb23-736"><a href="#cb23-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-737"><a href="#cb23-737" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 1: Hexagonal Sierpinski</span></span>
<span id="cb23-738"><a href="#cb23-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-739"><a href="#cb23-739" aria-hidden="true" tabindex="-1"></a>Create a Sierpinski gasket based on a hexagon instead of a triangle:</span>
<span id="cb23-740"><a href="#cb23-740" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use 6-fold symmetry</span>
<span id="cb23-741"><a href="#cb23-741" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Scale by factor of 3</span>
<span id="cb23-742"><a href="#cb23-742" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Remove appropriate regions</span>
<span id="cb23-743"><a href="#cb23-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-744"><a href="#cb23-744" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 2: Animate the Scale Factor</span></span>
<span id="cb23-745"><a href="#cb23-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-746"><a href="#cb23-746" aria-hidden="true" tabindex="-1"></a>Modify the Sierpinski carpet to have a time-varying scale factor:</span>
<span id="cb23-747"><a href="#cb23-747" aria-hidden="true" tabindex="-1"></a><span class="in">```glsl</span></span>
<span id="cb23-748"><a href="#cb23-748" aria-hidden="true" tabindex="-1"></a><span class="in">float scale = 3.0 + sin(iTime);</span></span>
<span id="cb23-749"><a href="#cb23-749" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-750"><a href="#cb23-750" aria-hidden="true" tabindex="-1"></a>Watch how the fractal structure changes!</span>
<span id="cb23-751"><a href="#cb23-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-752"><a href="#cb23-752" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 3: 3D Cross</span></span>
<span id="cb23-753"><a href="#cb23-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-754"><a href="#cb23-754" aria-hidden="true" tabindex="-1"></a>Implement a 3D fractal using only cross-shaped removal (remove only the center cube, not the face centers). Compare to the standard Menger sponge.</span>
<span id="cb23-755"><a href="#cb23-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-756"><a href="#cb23-756" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 4: Hybrid Fractal</span></span>
<span id="cb23-757"><a href="#cb23-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-758"><a href="#cb23-758" aria-hidden="true" tabindex="-1"></a>Combine two different fractals:</span>
<span id="cb23-759"><a href="#cb23-759" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>First 3 iterations: Sierpinski triangle folding</span>
<span id="cb23-760"><a href="#cb23-760" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Next 3 iterations: Sierpinski carpet folding</span>
<span id="cb23-761"><a href="#cb23-761" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Observe the unusual resulting structure</span>
<span id="cb23-762"><a href="#cb23-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-763"><a href="#cb23-763" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 5: Distance-Colored Sponge</span></span>
<span id="cb23-764"><a href="#cb23-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-765"><a href="#cb23-765" aria-hidden="true" tabindex="-1"></a>Render the Menger sponge with colors based on distance from the surface:</span>
<span id="cb23-766"><a href="#cb23-766" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use <span class="in">`sdMengerSponge`</span> as a distance field</span>
<span id="cb23-767"><a href="#cb23-767" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Color by distance for points outside</span>
<span id="cb23-768"><a href="#cb23-768" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Different color for points inside</span>
<span id="cb23-769"><a href="#cb23-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-770"><a href="#cb23-770" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb23-771"><a href="#cb23-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-772"><a href="#cb23-772" aria-hidden="true" tabindex="-1"></a><span class="fu">## Further Reading</span></span>
<span id="cb23-773"><a href="#cb23-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-774"><a href="#cb23-774" aria-hidden="true" tabindex="-1"></a><span class="fu">### Mathematical Theory</span></span>
<span id="cb23-775"><a href="#cb23-775" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Hausdorff dimension and box-counting dimension</span>
<span id="cb23-776"><a href="#cb23-776" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Iterated function systems (IFS)</span>
<span id="cb23-777"><a href="#cb23-777" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Self-similar sets and scaling symmetries</span>
<span id="cb23-778"><a href="#cb23-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-779"><a href="#cb23-779" aria-hidden="true" tabindex="-1"></a><span class="fu">### Computational Techniques</span></span>
<span id="cb23-780"><a href="#cb23-780" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Escape-time algorithms</span>
<span id="cb23-781"><a href="#cb23-781" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Distance estimation for fractals</span>
<span id="cb23-782"><a href="#cb23-782" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Efficient rendering of fractal geometry</span>
<span id="cb23-783"><a href="#cb23-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-784"><a href="#cb23-784" aria-hidden="true" tabindex="-1"></a><span class="fu">### Applications</span></span>
<span id="cb23-785"><a href="#cb23-785" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Procedural generation in games/graphics</span>
<span id="cb23-786"><a href="#cb23-786" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Antenna design (fractal antennas)</span>
<span id="cb23-787"><a href="#cb23-787" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Modeling natural phenomena (coastlines, plants)</span>
<span id="cb23-788"><a href="#cb23-788" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Compression algorithms</span>
<span id="cb23-789"><a href="#cb23-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-790"><a href="#cb23-790" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb23-791"><a href="#cb23-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-792"><a href="#cb23-792" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary</span></span>
<span id="cb23-793"><a href="#cb23-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-794"><a href="#cb23-794" aria-hidden="true" tabindex="-1"></a>Folding fractals demonstrate:</span>
<span id="cb23-795"><a href="#cb23-795" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Iteration + scaling** creates self-similar structure</span>
<span id="cb23-796"><a href="#cb23-796" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Simple operations** produce complex results</span>
<span id="cb23-797"><a href="#cb23-797" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**GPU parallelism** enables real-time fractal rendering</span>
<span id="cb23-798"><a href="#cb23-798" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Fractals connect** to many course topics (iteration, symmetry, 3D)</span>
<span id="cb23-799"><a href="#cb23-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-800"><a href="#cb23-800" aria-hidden="true" tabindex="-1"></a>The techniques here—folding, scaling, iteration—are fundamental to both mathematical fractals and computer graphics. These methods extend naturally from 2D to 3D, and from static to animated, making them powerful tools for mathematical visualization.</span>
<span id="cb23-801"><a href="#cb23-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-802"><a href="#cb23-802" aria-hidden="true" tabindex="-1"></a>**Key takeaway**: Fractals aren't just beautiful—they're computationally accessible. A few dozen lines of shader code can generate infinite complexity!</span>
<span id="cb23-803"><a href="#cb23-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-804"><a href="#cb23-804" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb23-805"><a href="#cb23-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-806"><a href="#cb23-806" aria-hidden="true" tabindex="-1"></a><span class="fu">## Complete Example: Animated Sierpinski Carpet</span></span>
<span id="cb23-807"><a href="#cb23-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-808"><a href="#cb23-808" aria-hidden="true" tabindex="-1"></a><span class="in">```glsl</span></span>
<span id="cb23-809"><a href="#cb23-809" aria-hidden="true" tabindex="-1"></a><span class="in">vec3 palette(float t) {</span></span>
<span id="cb23-810"><a href="#cb23-810" aria-hidden="true" tabindex="-1"></a><span class="in">    vec3 a = vec3(0.5);</span></span>
<span id="cb23-811"><a href="#cb23-811" aria-hidden="true" tabindex="-1"></a><span class="in">    vec3 b = vec3(0.5);</span></span>
<span id="cb23-812"><a href="#cb23-812" aria-hidden="true" tabindex="-1"></a><span class="in">    vec3 c = vec3(1.0);</span></span>
<span id="cb23-813"><a href="#cb23-813" aria-hidden="true" tabindex="-1"></a><span class="in">    vec3 d = vec3(0.0, 0.33, 0.67);</span></span>
<span id="cb23-814"><a href="#cb23-814" aria-hidden="true" tabindex="-1"></a><span class="in">    return a + b * cos(6.28318 * (c * t + d));</span></span>
<span id="cb23-815"><a href="#cb23-815" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb23-816"><a href="#cb23-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-817"><a href="#cb23-817" aria-hidden="true" tabindex="-1"></a><span class="in">bool inCarpet(vec2 p, int iterations) {</span></span>
<span id="cb23-818"><a href="#cb23-818" aria-hidden="true" tabindex="-1"></a><span class="in">    p = p * 0.5 + 0.5;</span></span>
<span id="cb23-819"><a href="#cb23-819" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-820"><a href="#cb23-820" aria-hidden="true" tabindex="-1"></a><span class="in">    for(int i = 0; i &lt; iterations; i++) {</span></span>
<span id="cb23-821"><a href="#cb23-821" aria-hidden="true" tabindex="-1"></a><span class="in">        vec2 cell = floor(p * 3.0);</span></span>
<span id="cb23-822"><a href="#cb23-822" aria-hidden="true" tabindex="-1"></a><span class="in">        if(cell.x == 1.0 &amp;&amp; cell.y == 1.0) return false;</span></span>
<span id="cb23-823"><a href="#cb23-823" aria-hidden="true" tabindex="-1"></a><span class="in">        p = fract(p * 3.0);</span></span>
<span id="cb23-824"><a href="#cb23-824" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb23-825"><a href="#cb23-825" aria-hidden="true" tabindex="-1"></a><span class="in">    return true;</span></span>
<span id="cb23-826"><a href="#cb23-826" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb23-827"><a href="#cb23-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-828"><a href="#cb23-828" aria-hidden="true" tabindex="-1"></a><span class="in">void mainImage(out vec4 fragColor, in vec2 fragCoord)</span></span>
<span id="cb23-829"><a href="#cb23-829" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb23-830"><a href="#cb23-830" aria-hidden="true" tabindex="-1"></a><span class="in">    vec2 uv = fragCoord / iResolution.xy;</span></span>
<span id="cb23-831"><a href="#cb23-831" aria-hidden="true" tabindex="-1"></a><span class="in">    uv = (uv - 0.5) * 2.0;</span></span>
<span id="cb23-832"><a href="#cb23-832" aria-hidden="true" tabindex="-1"></a><span class="in">    uv.x *= iResolution.x / iResolution.y;</span></span>
<span id="cb23-833"><a href="#cb23-833" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-834"><a href="#cb23-834" aria-hidden="true" tabindex="-1"></a><span class="in">    // Zoom animation</span></span>
<span id="cb23-835"><a href="#cb23-835" aria-hidden="true" tabindex="-1"></a><span class="in">    float zoom = exp(sin(iTime * 0.3) * 2.0);</span></span>
<span id="cb23-836"><a href="#cb23-836" aria-hidden="true" tabindex="-1"></a><span class="in">    uv *= zoom;</span></span>
<span id="cb23-837"><a href="#cb23-837" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-838"><a href="#cb23-838" aria-hidden="true" tabindex="-1"></a><span class="in">    // Rotation animation</span></span>
<span id="cb23-839"><a href="#cb23-839" aria-hidden="true" tabindex="-1"></a><span class="in">    float angle = iTime * 0.2;</span></span>
<span id="cb23-840"><a href="#cb23-840" aria-hidden="true" tabindex="-1"></a><span class="in">    float c = cos(angle), s = sin(angle);</span></span>
<span id="cb23-841"><a href="#cb23-841" aria-hidden="true" tabindex="-1"></a><span class="in">    uv = vec2(c * uv.x - s * uv.y, s * uv.x + c * uv.y);</span></span>
<span id="cb23-842"><a href="#cb23-842" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-843"><a href="#cb23-843" aria-hidden="true" tabindex="-1"></a><span class="in">    int iterations = 6;</span></span>
<span id="cb23-844"><a href="#cb23-844" aria-hidden="true" tabindex="-1"></a><span class="in">    bool inFractal = inCarpet(uv, iterations);</span></span>
<span id="cb23-845"><a href="#cb23-845" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-846"><a href="#cb23-846" aria-hidden="true" tabindex="-1"></a><span class="in">    vec3 color;</span></span>
<span id="cb23-847"><a href="#cb23-847" aria-hidden="true" tabindex="-1"></a><span class="in">    if(inFractal) {</span></span>
<span id="cb23-848"><a href="#cb23-848" aria-hidden="true" tabindex="-1"></a><span class="in">        // Color based on distance from center</span></span>
<span id="cb23-849"><a href="#cb23-849" aria-hidden="true" tabindex="-1"></a><span class="in">        float d = length(uv);</span></span>
<span id="cb23-850"><a href="#cb23-850" aria-hidden="true" tabindex="-1"></a><span class="in">        color = palette(d * 0.5 + iTime * 0.1);</span></span>
<span id="cb23-851"><a href="#cb23-851" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb23-852"><a href="#cb23-852" aria-hidden="true" tabindex="-1"></a><span class="in">        color = vec3(0.05, 0.05, 0.1);</span></span>
<span id="cb23-853"><a href="#cb23-853" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb23-854"><a href="#cb23-854" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb23-855"><a href="#cb23-855" aria-hidden="true" tabindex="-1"></a><span class="in">    fragColor = vec4(color, 1.0);</span></span>
<span id="cb23-856"><a href="#cb23-856" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb23-857"><a href="#cb23-857" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-858"><a href="#cb23-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-859"><a href="#cb23-859" aria-hidden="true" tabindex="-1"></a>This creates a beautiful, animated Sierpinski carpet that zooms and rotates, with colors flowing through the fractal structure!</span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>