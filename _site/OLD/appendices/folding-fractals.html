<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Steve Trettel">

<title>folding-fractals – GPU-Accelerated Mathematical Illustration</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e62aa0a8c28b52a0e19b1cebeabd7fd3.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-f0463eacbf7faa50df92658b97a72515.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e62aa0a8c28b52a0e19b1cebeabd7fd3.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-d72af2198ff6241fba5e91235accbade.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-9ba55aa6988265aad246d48a0606a5a7.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/bootstrap/bootstrap-d72af2198ff6241fba5e91235accbade.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">
      GPU-Accelerated Mathematical Illustration
      </li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">GPU-Accelerated Mathematical Illustration</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Day 1: Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/day1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture Notes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/day1-slides.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Slides</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Day 2: Dynamics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/day2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture Notes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/day2-slides.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Slides</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Day 3: Tilings</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/day3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture Notes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/day3-slides.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Slides</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/shaders/day1-shaders.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Day 1 Code</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/shaders/day2-shaders.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Day 2 Code</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/shaders/day3-shaders.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Day 3 Code</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../GPU-Accelerated-Mathematical-Illustration.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Download PDF</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#folding-fractals" id="toc-folding-fractals" class="nav-link active" data-scroll-target="#folding-fractals"><span class="header-section-number">1</span> Folding Fractals</a>
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview"><span class="header-section-number">1.1</span> Overview</a></li>
  <li><a href="#fundamental-concept-folding-scaling-fractals" id="toc-fundamental-concept-folding-scaling-fractals" class="nav-link" data-scroll-target="#fundamental-concept-folding-scaling-fractals"><span class="header-section-number">1.2</span> Fundamental Concept: Folding + Scaling = Fractals</a>
  <ul class="collapse">
  <li><a href="#the-general-pattern" id="toc-the-general-pattern" class="nav-link" data-scroll-target="#the-general-pattern">The General Pattern</a></li>
  <li><a href="#connection-to-tilings" id="toc-connection-to-tilings" class="nav-link" data-scroll-target="#connection-to-tilings">Connection to Tilings</a></li>
  </ul></li>
  <li><a href="#sierpinski-triangle" id="toc-sierpinski-triangle" class="nav-link" data-scroll-target="#sierpinski-triangle"><span class="header-section-number">1.3</span> Sierpinski Triangle</a>
  <ul class="collapse">
  <li><a href="#mathematical-description" id="toc-mathematical-description" class="nav-link" data-scroll-target="#mathematical-description">Mathematical Description</a></li>
  <li><a href="#mathematical-foundation-reflection-across-a-line" id="toc-mathematical-foundation-reflection-across-a-line" class="nav-link" data-scroll-target="#mathematical-foundation-reflection-across-a-line">Mathematical Foundation: Reflection Across a Line</a></li>
  <li><a href="#line-struct" id="toc-line-struct" class="nav-link" data-scroll-target="#line-struct">Line Struct</a></li>
  <li><a href="#setting-up-the-triangle" id="toc-setting-up-the-triangle" class="nav-link" data-scroll-target="#setting-up-the-triangle">Setting Up the Triangle</a></li>
  <li><a href="#the-folding-algorithm" id="toc-the-folding-algorithm" class="nav-link" data-scroll-target="#the-folding-algorithm">The Folding Algorithm</a></li>
  <li><a href="#the-folding-algorithm-1" id="toc-the-folding-algorithm-1" class="nav-link" data-scroll-target="#the-folding-algorithm-1">The Folding Algorithm</a></li>
  <li><a href="#adding-the-scaling-step" id="toc-adding-the-scaling-step" class="nav-link" data-scroll-target="#adding-the-scaling-step">Adding the Scaling Step</a></li>
  <li><a href="#determining-if-point-is-in-fractal" id="toc-determining-if-point-is-in-fractal" class="nav-link" data-scroll-target="#determining-if-point-is-in-fractal">Determining if Point is in Fractal</a></li>
  <li><a href="#complete-implementation" id="toc-complete-implementation" class="nav-link" data-scroll-target="#complete-implementation">Complete Implementation</a></li>
  <li><a href="#visualization" id="toc-visualization" class="nav-link" data-scroll-target="#visualization">Visualization</a></li>
  </ul></li>
  <li><a href="#sierpinski-carpet" id="toc-sierpinski-carpet" class="nav-link" data-scroll-target="#sierpinski-carpet"><span class="header-section-number">1.4</span> Sierpinski Carpet</a>
  <ul class="collapse">
  <li><a href="#mathematical-description-1" id="toc-mathematical-description-1" class="nav-link" data-scroll-target="#mathematical-description-1">Mathematical Description</a></li>
  <li><a href="#the-algorithm" id="toc-the-algorithm" class="nav-link" data-scroll-target="#the-algorithm">The Algorithm</a></li>
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation">Implementation</a></li>
  <li><a href="#more-robust-version" id="toc-more-robust-version" class="nav-link" data-scroll-target="#more-robust-version">More Robust Version</a></li>
  <li><a href="#clean-implementation" id="toc-clean-implementation" class="nav-link" data-scroll-target="#clean-implementation">Clean Implementation</a></li>
  <li><a href="#visualization-1" id="toc-visualization-1" class="nav-link" data-scroll-target="#visualization-1">Visualization</a></li>
  </ul></li>
  <li><a href="#menger-sponge-3d-extension" id="toc-menger-sponge-3d-extension" class="nav-link" data-scroll-target="#menger-sponge-3d-extension"><span class="header-section-number">1.5</span> Menger Sponge (3D Extension)</a>
  <ul class="collapse">
  <li><a href="#mathematical-description-2" id="toc-mathematical-description-2" class="nav-link" data-scroll-target="#mathematical-description-2">Mathematical Description</a></li>
  <li><a href="#the-algorithm-1" id="toc-the-algorithm-1" class="nav-link" data-scroll-target="#the-algorithm-1">The Algorithm</a></li>
  <li><a href="#implementation-1" id="toc-implementation-1" class="nav-link" data-scroll-target="#implementation-1">Implementation</a></li>
  <li><a href="#alternative-using-sdf-approach" id="toc-alternative-using-sdf-approach" class="nav-link" data-scroll-target="#alternative-using-sdf-approach">Alternative: Using SDF Approach</a></li>
  <li><a href="#rendering-with-raymarching" id="toc-rendering-with-raymarching" class="nav-link" data-scroll-target="#rendering-with-raymarching">Rendering with Raymarching</a></li>
  </ul></li>
  <li><a href="#general-principles-of-folding-fractals" id="toc-general-principles-of-folding-fractals" class="nav-link" data-scroll-target="#general-principles-of-folding-fractals"><span class="header-section-number">1.6</span> General Principles of Folding Fractals</a>
  <ul class="collapse">
  <li><a href="#key-ingredients" id="toc-key-ingredients" class="nav-link" data-scroll-target="#key-ingredients">Key Ingredients</a></li>
  <li><a href="#fractal-dimension" id="toc-fractal-dimension" class="nav-link" data-scroll-target="#fractal-dimension">Fractal Dimension</a></li>
  </ul></li>
  <li><a href="#coloring-strategies" id="toc-coloring-strategies" class="nav-link" data-scroll-target="#coloring-strategies"><span class="header-section-number">1.7</span> Coloring Strategies</a>
  <ul class="collapse">
  <li><a href="#by-iteration-depth" id="toc-by-iteration-depth" class="nav-link" data-scroll-target="#by-iteration-depth">By Iteration Depth</a></li>
  <li><a href="#by-distance-after-folding" id="toc-by-distance-after-folding" class="nav-link" data-scroll-target="#by-distance-after-folding">By Distance After Folding</a></li>
  <li><a href="#by-cell-position" id="toc-by-cell-position" class="nav-link" data-scroll-target="#by-cell-position">By Cell Position</a></li>
  <li><a href="#hybrid-distance-field-fractal" id="toc-hybrid-distance-field-fractal" class="nav-link" data-scroll-target="#hybrid-distance-field-fractal">Hybrid: Distance Field + Fractal</a></li>
  </ul></li>
  <li><a href="#variations-and-experiments" id="toc-variations-and-experiments" class="nav-link" data-scroll-target="#variations-and-experiments"><span class="header-section-number">1.8</span> Variations and Experiments</a>
  <ul class="collapse">
  <li><a href="#different-folding-operations" id="toc-different-folding-operations" class="nav-link" data-scroll-target="#different-folding-operations">Different Folding Operations</a></li>
  <li><a href="#different-scale-factors" id="toc-different-scale-factors" class="nav-link" data-scroll-target="#different-scale-factors">Different Scale Factors</a></li>
  <li><a href="#animated-parameters" id="toc-animated-parameters" class="nav-link" data-scroll-target="#animated-parameters">Animated Parameters</a></li>
  <li><a href="#color-by-orbit" id="toc-color-by-orbit" class="nav-link" data-scroll-target="#color-by-orbit">Color by Orbit</a></li>
  <li><a href="#d-variations" id="toc-d-variations" class="nav-link" data-scroll-target="#d-variations">3D Variations</a></li>
  </ul></li>
  <li><a href="#connection-to-course-topics" id="toc-connection-to-course-topics" class="nav-link" data-scroll-target="#connection-to-course-topics"><span class="header-section-number">1.9</span> Connection to Course Topics</a>
  <ul class="collapse">
  <li><a href="#day-2-iteration-creates-fractals" id="toc-day-2-iteration-creates-fractals" class="nav-link" data-scroll-target="#day-2-iteration-creates-fractals">Day 2: Iteration Creates Fractals</a></li>
  <li><a href="#day-3-folding-without-scaling" id="toc-day-3-folding-without-scaling" class="nav-link" data-scroll-target="#day-3-folding-without-scaling">Day 3: Folding Without Scaling</a></li>
  <li><a href="#day-4-3d-rendering" id="toc-day-4-3d-rendering" class="nav-link" data-scroll-target="#day-4-3d-rendering">Day 4: 3D Rendering</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">1.10</span> Exercises</a>
  <ul class="collapse">
  <li><a href="#exercise-1-hexagonal-sierpinski" id="toc-exercise-1-hexagonal-sierpinski" class="nav-link" data-scroll-target="#exercise-1-hexagonal-sierpinski">Exercise 1: Hexagonal Sierpinski</a></li>
  <li><a href="#exercise-2-animate-the-scale-factor" id="toc-exercise-2-animate-the-scale-factor" class="nav-link" data-scroll-target="#exercise-2-animate-the-scale-factor">Exercise 2: Animate the Scale Factor</a></li>
  <li><a href="#exercise-3-3d-cross" id="toc-exercise-3-3d-cross" class="nav-link" data-scroll-target="#exercise-3-3d-cross">Exercise 3: 3D Cross</a></li>
  <li><a href="#exercise-4-hybrid-fractal" id="toc-exercise-4-hybrid-fractal" class="nav-link" data-scroll-target="#exercise-4-hybrid-fractal">Exercise 4: Hybrid Fractal</a></li>
  <li><a href="#exercise-5-distance-colored-sponge" id="toc-exercise-5-distance-colored-sponge" class="nav-link" data-scroll-target="#exercise-5-distance-colored-sponge">Exercise 5: Distance-Colored Sponge</a></li>
  </ul></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading"><span class="header-section-number">1.11</span> Further Reading</a>
  <ul class="collapse">
  <li><a href="#mathematical-theory" id="toc-mathematical-theory" class="nav-link" data-scroll-target="#mathematical-theory">Mathematical Theory</a></li>
  <li><a href="#computational-techniques" id="toc-computational-techniques" class="nav-link" data-scroll-target="#computational-techniques">Computational Techniques</a></li>
  <li><a href="#applications" id="toc-applications" class="nav-link" data-scroll-target="#applications">Applications</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">1.12</span> Summary</a></li>
  <li><a href="#complete-example-animated-sierpinski-carpet" id="toc-complete-example-animated-sierpinski-carpet" class="nav-link" data-scroll-target="#complete-example-animated-sierpinski-carpet"><span class="header-section-number">1.13</span> Complete Example: Animated Sierpinski Carpet</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Steve Trettel </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="folding-fractals" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Folding Fractals</h1>
<section id="overview" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="overview"><span class="header-section-number">1.1</span> Overview</h2>
<p>This appendix explores a fascinating technique for generating fractals: <strong>iterated folding with scaling</strong>. While reflection-based tiling (Days 2-3) fills space with copies of a fundamental domain, folding fractals add scaling at each iteration, creating self-similar structures that exhibit fractal geometry.</p>
<p>We’ll explore three classic examples: 1. <strong>Sierpinski Triangle</strong> (2D, triangle-based) 2. <strong>Sierpinski Carpet</strong> (2D, square-based) 3. <strong>Menger Sponge</strong> (3D, cube-based)</p>
<p>These connect naturally to course content: the folding operations use techniques from Day 2-3 (reflection, <code>abs()</code>), and the Menger sponge extends to 3D using Day 4’s coordinate systems.</p>
<hr>
</section>
<section id="fundamental-concept-folding-scaling-fractals" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="fundamental-concept-folding-scaling-fractals"><span class="header-section-number">1.2</span> Fundamental Concept: Folding + Scaling = Fractals</h2>
<section id="the-general-pattern" class="level3">
<h3 class="anchored" data-anchor-id="the-general-pattern">The General Pattern</h3>
<p>All folding fractals follow this pattern:</p>
<ol type="1">
<li><strong>Fold</strong>: Use geometric operations (reflection, <code>abs()</code>) to bring the point into a fundamental region</li>
<li><strong>Scale</strong>: Zoom in by some factor (typically 2 or 3)</li>
<li><strong>Repeat</strong>: Iterate this process</li>
<li><strong>Classify</strong>: After <span class="math inline">\(n\)</span> iterations, check if the point is in a “removed” region or “kept” region</li>
</ol>
<p>After <span class="math inline">\(n\)</span> iterations: - We’ve zoomed in by factor <span class="math inline">\(s^n\)</span> (where <span class="math inline">\(s\)</span> is the scale factor) - The fractal structure emerges from the removal pattern - The result is self-similar: zooming in reveals the same pattern</p>
</section>
<section id="connection-to-tilings" class="level3">
<h3 class="anchored" data-anchor-id="connection-to-tilings">Connection to Tilings</h3>
<p>Recall from Day 3: - <strong>Tiling</strong>: Fold → repeat (fills space with copies) - <strong>Fractal</strong>: Fold → scale → repeat (creates self-similar structure with removed regions)</p>
<p>The key difference is the scaling step!</p>
<hr>
</section>
</section>
<section id="sierpinski-triangle" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="sierpinski-triangle"><span class="header-section-number">1.3</span> Sierpinski Triangle</h2>
<section id="mathematical-description" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-description">Mathematical Description</h3>
<p>The Sierpinski triangle is constructed by: 1. Start with an equilateral triangle 2. Remove the middle triangle (formed by connecting edge midpoints) 3. Recursively repeat on each remaining sub-triangle</p>
<p>Equivalently: iteratively fold into the triangle and scale by 2.</p>
</section>
<section id="mathematical-foundation-reflection-across-a-line" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-foundation-reflection-across-a-line">Mathematical Foundation: Reflection Across a Line</h3>
<p>Before implementing the fractal, we need the correct reflection formula.</p>
<p>A line in the plane can be written as <span class="math inline">\(ax + by = c\)</span>, with normal vector <span class="math inline">\(\mathbf{n} = (a, b)\)</span>.</p>
<p><strong>Reflection formula:</strong> For a point <span class="math inline">\(\mathbf{p} = (x, y)\)</span>, the reflection <span class="math inline">\(\mathbf{p}'\)</span> across the line is:</p>
<p><span class="math display">\[\mathbf{p}' = \mathbf{p} - 2d\hat{\mathbf{n}}\]</span></p>
<p>where: - <span class="math inline">\(d = \frac{ax + by - c}{\sqrt{a^2 + b^2}}\)</span> is the signed distance to the line - <span class="math inline">\(\hat{\mathbf{n}} = \frac{(a,b)}{\sqrt{a^2 + b^2}}\)</span> is the unit normal</p>
<p>Combining these: <span class="math display">\[\mathbf{p}' = \mathbf{p} - \frac{2(ax + by - c)}{a^2 + b^2}(a, b)\]</span></p>
</section>
<section id="line-struct" class="level3">
<h3 class="anchored" data-anchor-id="line-struct">Line Struct</h3>
<p>Let’s organize line data properly:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Line <span class="op">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> a<span class="op">,</span> b<span class="op">,</span> c<span class="op">;</span>  <span class="co">// Line equation: ax + by = c</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> <span class="fu">reflectAcrossLine</span><span class="op">(</span><span class="dt">vec2</span> p<span class="op">,</span> Line line<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Signed distance from point to line (unnormalized)</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> dist <span class="op">=</span> line<span class="op">.</span><span class="fu">a</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">x</span> <span class="op">+</span> line<span class="op">.</span><span class="fu">b</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">y</span> <span class="op">-</span> line<span class="op">.</span><span class="fu">c</span><span class="op">;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Normal vector squared length</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> normSq <span class="op">=</span> line<span class="op">.</span><span class="fu">a</span> <span class="op">*</span> line<span class="op">.</span><span class="fu">a</span> <span class="op">+</span> line<span class="op">.</span><span class="fu">b</span> <span class="op">*</span> line<span class="op">.</span><span class="fu">b</span><span class="op">;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Reflection formula</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> normal <span class="op">=</span> <span class="dt">vec2</span><span class="op">(</span>line<span class="op">.</span><span class="fu">a</span><span class="op">,</span> line<span class="op">.</span><span class="fu">b</span><span class="op">);</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> p <span class="op">-</span> <span class="op">(</span><span class="fl">2.0</span> <span class="op">*</span> dist <span class="op">/</span> normSq<span class="op">)</span> <span class="op">*</span> normal<span class="op">;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="setting-up-the-triangle" class="level3">
<h3 class="anchored" data-anchor-id="setting-up-the-triangle">Setting Up the Triangle</h3>
<p>For an equilateral triangle with vertices: <span class="math display">\[v_0 = (0, 1), \quad v_1 = \left(-\frac{\sqrt{3}}{2}, -\frac{1}{2}\right), \quad v_2 = \left(\frac{\sqrt{3}}{2}, -\frac{1}{2}\right)\]</span></p>
<p>We need the three edge lines:</p>
<p><strong>Edge from <span class="math inline">\(v_0\)</span> to <span class="math inline">\(v_1\)</span>:</strong> Direction vector: <span class="math inline">\(v_1 - v_0 = (-\frac{\sqrt{3}}{2}, -\frac{3}{2})\)</span> Normal (perpendicular): <span class="math inline">\((\frac{3}{2}, -\frac{\sqrt{3}}{2})\)</span> or simplified: <span class="math inline">\((3, -\sqrt{3})\)</span> Line equation: <span class="math inline">\(3x - \sqrt{3}y = c\)</span>, passing through <span class="math inline">\(v_0 = (0,1)\)</span>: <span class="math inline">\(c = -\sqrt{3}\)</span></p>
<p><strong>Edge from <span class="math inline">\(v_1\)</span> to <span class="math inline">\(v_2\)</span>:</strong> This is horizontal: <span class="math inline">\(y = -\frac{1}{2}\)</span> Line equation: <span class="math inline">\(0x + 1y = -\frac{1}{2}\)</span> or <span class="math inline">\((0, 1, -0.5)\)</span></p>
<p><strong>Edge from <span class="math inline">\(v_2\)</span> to <span class="math inline">\(v_0\)</span>:</strong> By symmetry: <span class="math inline">\(-3x - \sqrt{3}y = -\sqrt{3}\)</span></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">setupTriangleEdges</span><span class="op">(</span><span class="dt">out</span> Line e1<span class="op">,</span> <span class="dt">out</span> Line e2<span class="op">,</span> <span class="dt">out</span> Line e3<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> sqrt3 <span class="op">=</span> <span class="fl">1.732</span><span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Edge v0 to v1</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    e1<span class="op">.</span><span class="fu">a</span> <span class="op">=</span> <span class="fl">3.0</span><span class="op">;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    e1<span class="op">.</span><span class="fu">b</span> <span class="op">=</span> <span class="op">-</span>sqrt3<span class="op">;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    e1<span class="op">.</span><span class="fu">c</span> <span class="op">=</span> <span class="op">-</span>sqrt3<span class="op">;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Edge v1 to v2 (horizontal)</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    e2<span class="op">.</span><span class="fu">a</span> <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    e2<span class="op">.</span><span class="fu">b</span> <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    e2<span class="op">.</span><span class="fu">c</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Edge v2 to v0</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    e3<span class="op">.</span><span class="fu">a</span> <span class="op">=</span> <span class="op">-</span><span class="fl">3.0</span><span class="op">;</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    e3<span class="op">.</span><span class="fu">b</span> <span class="op">=</span> <span class="op">-</span>sqrt3<span class="op">;</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    e3<span class="op">.</span><span class="fu">c</span> <span class="op">=</span> <span class="op">-</span>sqrt3<span class="op">;</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="the-folding-algorithm" class="level3">
<h3 class="anchored" data-anchor-id="the-folding-algorithm">The Folding Algorithm</h3>
<p>Now we can properly fold into the triangle:</p>
</section>
<section id="the-folding-algorithm-1" class="level3">
<h3 class="anchored" data-anchor-id="the-folding-algorithm-1">The Folding Algorithm</h3>
<p>Now we can properly fold into the triangle:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> <span class="fu">foldIntoTriangle</span><span class="op">(</span><span class="dt">vec2</span> p<span class="op">,</span> Line e1<span class="op">,</span> Line e2<span class="op">,</span> Line e3<span class="op">,</span> <span class="dt">int</span> maxIter<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> maxIter<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        <span class="dt">vec2</span> p_old <span class="op">=</span> p<span class="op">;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Reflect across each edge if we're on the wrong side</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Check sign of distance: if negative, we're on wrong side</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> d1 <span class="op">=</span> e1<span class="op">.</span><span class="fu">a</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">x</span> <span class="op">+</span> e1<span class="op">.</span><span class="fu">b</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">y</span> <span class="op">-</span> e1<span class="op">.</span><span class="fu">c</span><span class="op">;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span>d1 <span class="op">&lt;</span> <span class="fl">0.0</span><span class="op">)</span> p <span class="op">=</span> <span class="fu">reflectAcrossLine</span><span class="op">(</span>p<span class="op">,</span> e1<span class="op">);</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> d2 <span class="op">=</span> e2<span class="op">.</span><span class="fu">a</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">x</span> <span class="op">+</span> e2<span class="op">.</span><span class="fu">b</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">y</span> <span class="op">-</span> e2<span class="op">.</span><span class="fu">c</span><span class="op">;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span>d2 <span class="op">&lt;</span> <span class="fl">0.0</span><span class="op">)</span> p <span class="op">=</span> <span class="fu">reflectAcrossLine</span><span class="op">(</span>p<span class="op">,</span> e2<span class="op">);</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> d3 <span class="op">=</span> e3<span class="op">.</span><span class="fu">a</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">x</span> <span class="op">+</span> e3<span class="op">.</span><span class="fu">b</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">y</span> <span class="op">-</span> e3<span class="op">.</span><span class="fu">c</span><span class="op">;</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span>d3 <span class="op">&lt;</span> <span class="fl">0.0</span><span class="op">)</span> p <span class="op">=</span> <span class="fu">reflectAcrossLine</span><span class="op">(</span>p<span class="op">,</span> e3<span class="op">);</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Converged? (no more reflections)</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span><span class="bu">length</span><span class="op">(</span>p <span class="op">-</span> p_old<span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.0001</span><span class="op">)</span> <span class="kw">break</span><span class="op">;</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> p<span class="op">;</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="adding-the-scaling-step" class="level3">
<h3 class="anchored" data-anchor-id="adding-the-scaling-step">Adding the Scaling Step</h3>
<p>For the Sierpinski fractal, we fold and then scale:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> <span class="fu">sierpinskiTriangle</span><span class="op">(</span><span class="dt">vec2</span> p<span class="op">,</span> <span class="dt">int</span> iterations<span class="op">,</span> <span class="dt">out</span> <span class="dt">int</span> depth<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    Line e1<span class="op">,</span> e2<span class="op">,</span> e3<span class="op">;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setupTriangleEdges</span><span class="op">(</span>e1<span class="op">,</span> e2<span class="op">,</span> e3<span class="op">);</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    depth <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> iterations<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Fold into fundamental triangle</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="fu">foldIntoTriangle</span><span class="op">(</span>p<span class="op">,</span> e1<span class="op">,</span> e2<span class="op">,</span> e3<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Scale by 2 toward center</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">vec2</span> center <span class="op">=</span> <span class="dt">vec2</span><span class="op">(</span><span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">);</span>  <span class="co">// Approximate center</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="op">(</span>p <span class="op">-</span> center<span class="op">)</span> <span class="op">*</span> <span class="fl">2.0</span> <span class="op">+</span> center<span class="op">;</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        depth<span class="op">++;</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Optional: early exit if escaped</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span><span class="bu">length</span><span class="op">(</span>p<span class="op">)</span> <span class="op">&gt;</span> <span class="fl">100.0</span><span class="op">)</span> <span class="kw">break</span><span class="op">;</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> p<span class="op">;</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="determining-if-point-is-in-fractal" class="level3">
<h3 class="anchored" data-anchor-id="determining-if-point-is-in-fractal">Determining if Point is in Fractal</h3>
<p>After folding, we need to check if we’re in the “removed” middle triangle. Using barycentric coordinates:</p>
<pre><code>
### Determining if Point is in Fractal

After folding, we need to check if we're in the "removed" middle triangle. The middle triangle has vertices at the midpoints of the original triangle's edges.

For an equilateral triangle with vertices $v_0, v_1, v_2$, the midpoints are:
$$m_{01} = \frac{v_0 + v_1}{2}, \quad m_{12} = \frac{v_1 + v_2}{2}, \quad m_{20} = \frac{v_2 + v_0}{2}$$

We can check if point $p$ is inside this middle triangle using barycentric coordinates:

```glsl
bool inMiddleTriangle(vec2 p) {
    // Vertices of original triangle
    vec2 v0 = vec2(0.0, 1.0);
    vec2 v1 = vec2(-0.866, -0.5);
    vec2 v2 = vec2(0.866, -0.5);
    
    // Midpoints (vertices of removed triangle)
    vec2 m01 = (v0 + v1) * 0.5;
    vec2 m12 = (v1 + v2) * 0.5;
    vec2 m20 = (v2 + v0) * 0.5;
    
    // Check if p is inside triangle m01-m12-m20
    // Using sign of cross products
    vec2 e0 = m12 - m01;
    vec2 e1 = m20 - m12;
    vec2 e2 = m01 - m20;
    
    vec2 p0 = p - m01;
    vec2 p1 = p - m12;
    vec2 p2 = p - m20;
    
    float s0 = e0.x * p0.y - e0.y * p0.x;
    float s1 = e1.x * p1.y - e1.y * p1.x;
    float s2 = e2.x * p2.y - e2.y * p2.x;
    
    // All same sign means inside
    return (s0 &gt;= 0.0 &amp;&amp; s1 &gt;= 0.0 &amp;&amp; s2 &gt;= 0.0) || 
           (s0 &lt;= 0.0 &amp;&amp; s1 &lt;= 0.0 &amp;&amp; s2 &lt;= 0.0);
}</code></pre>
</section>
<section id="complete-implementation" class="level3">
<h3 class="anchored" data-anchor-id="complete-implementation">Complete Implementation</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Line <span class="op">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> a<span class="op">,</span> b<span class="op">,</span> c<span class="op">;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> <span class="fu">reflectAcrossLine</span><span class="op">(</span><span class="dt">vec2</span> p<span class="op">,</span> Line line<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> dist <span class="op">=</span> line<span class="op">.</span><span class="fu">a</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">x</span> <span class="op">+</span> line<span class="op">.</span><span class="fu">b</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">y</span> <span class="op">-</span> line<span class="op">.</span><span class="fu">c</span><span class="op">;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> normSq <span class="op">=</span> line<span class="op">.</span><span class="fu">a</span> <span class="op">*</span> line<span class="op">.</span><span class="fu">a</span> <span class="op">+</span> line<span class="op">.</span><span class="fu">b</span> <span class="op">*</span> line<span class="op">.</span><span class="fu">b</span><span class="op">;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> normal <span class="op">=</span> <span class="dt">vec2</span><span class="op">(</span>line<span class="op">.</span><span class="fu">a</span><span class="op">,</span> line<span class="op">.</span><span class="fu">b</span><span class="op">);</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> p <span class="op">-</span> <span class="op">(</span><span class="fl">2.0</span> <span class="op">*</span> dist <span class="op">/</span> normSq<span class="op">)</span> <span class="op">*</span> normal<span class="op">;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">setupTriangleEdges</span><span class="op">(</span><span class="dt">out</span> Line e1<span class="op">,</span> <span class="dt">out</span> Line e2<span class="op">,</span> <span class="dt">out</span> Line e3<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> sqrt3 <span class="op">=</span> <span class="fl">1.732</span><span class="op">;</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    e1 <span class="op">=</span> <span class="fu">Line</span><span class="op">(</span><span class="fl">3.0</span><span class="op">,</span> <span class="op">-</span>sqrt3<span class="op">,</span> <span class="op">-</span>sqrt3<span class="op">);</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    e2 <span class="op">=</span> <span class="fu">Line</span><span class="op">(</span><span class="fl">0.0</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">);</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    e3 <span class="op">=</span> <span class="fu">Line</span><span class="op">(-</span><span class="fl">3.0</span><span class="op">,</span> <span class="op">-</span>sqrt3<span class="op">,</span> <span class="op">-</span>sqrt3<span class="op">);</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> <span class="fu">sierpinskiTriangle</span><span class="op">(</span><span class="dt">vec2</span> p<span class="op">,</span> <span class="dt">int</span> iterations<span class="op">,</span> <span class="dt">out</span> <span class="dt">bool</span> inFractal<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    Line e1<span class="op">,</span> e2<span class="op">,</span> e3<span class="op">;</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setupTriangleEdges</span><span class="op">(</span>e1<span class="op">,</span> e2<span class="op">,</span> e3<span class="op">);</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    inFractal <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> iterations<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Fold into triangle</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span><span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>            <span class="dt">float</span> d1 <span class="op">=</span> e1<span class="op">.</span><span class="fu">a</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">x</span> <span class="op">+</span> e1<span class="op">.</span><span class="fu">b</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">y</span> <span class="op">-</span> e1<span class="op">.</span><span class="fu">c</span><span class="op">;</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span><span class="op">(</span>d1 <span class="op">&lt;</span> <span class="fl">0.0</span><span class="op">)</span> p <span class="op">=</span> <span class="fu">reflectAcrossLine</span><span class="op">(</span>p<span class="op">,</span> e1<span class="op">);</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>            <span class="dt">float</span> d2 <span class="op">=</span> e2<span class="op">.</span><span class="fu">a</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">x</span> <span class="op">+</span> e2<span class="op">.</span><span class="fu">b</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">y</span> <span class="op">-</span> e2<span class="op">.</span><span class="fu">c</span><span class="op">;</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span><span class="op">(</span>d2 <span class="op">&lt;</span> <span class="fl">0.0</span><span class="op">)</span> p <span class="op">=</span> <span class="fu">reflectAcrossLine</span><span class="op">(</span>p<span class="op">,</span> e2<span class="op">);</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>            <span class="dt">float</span> d3 <span class="op">=</span> e3<span class="op">.</span><span class="fu">a</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">x</span> <span class="op">+</span> e3<span class="op">.</span><span class="fu">b</span> <span class="op">*</span> p<span class="op">.</span><span class="fu">y</span> <span class="op">-</span> e3<span class="op">.</span><span class="fu">c</span><span class="op">;</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span><span class="op">(</span>d3 <span class="op">&lt;</span> <span class="fl">0.0</span><span class="op">)</span> p <span class="op">=</span> <span class="fu">reflectAcrossLine</span><span class="op">(</span>p<span class="op">,</span> e3<span class="op">);</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Check if in removed region</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span><span class="fu">inMiddleTriangle</span><span class="op">(</span>p<span class="op">))</span> <span class="op">{</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>            inFractal <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Scale by 2</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> p <span class="op">*</span> <span class="fl">2.0</span><span class="op">;</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> p<span class="op">;</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="visualization" class="level3">
<h3 class="anchored" data-anchor-id="visualization">Visualization</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">mainImage</span><span class="op">(</span><span class="dt">out</span> <span class="dt">vec4</span> fragColor<span class="op">,</span> <span class="dt">in</span> <span class="dt">vec2</span> fragCoord<span class="op">)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> uv <span class="op">=</span> fragCoord <span class="op">/</span> iResolution<span class="op">.</span><span class="fu">xy</span><span class="op">;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    uv <span class="op">=</span> <span class="op">(</span>uv <span class="op">-</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">*</span> <span class="fl">3.0</span><span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    uv<span class="op">.</span><span class="fu">x</span> <span class="op">*=</span> iResolution<span class="op">.</span><span class="fu">x</span> <span class="op">/</span> iResolution<span class="op">.</span><span class="fu">y</span><span class="op">;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> inFractal<span class="op">;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> p_final <span class="op">=</span> <span class="fu">sierpinskiTriangle</span><span class="op">(</span>uv<span class="op">,</span> <span class="dv">6</span><span class="op">,</span> inFractal<span class="op">);</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec3</span> color<span class="op">;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span><span class="op">(</span>inFractal<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Color by final position</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> t <span class="op">=</span> <span class="bu">length</span><span class="op">(</span>p_final<span class="op">)</span> <span class="op">*</span> <span class="fl">0.1</span><span class="op">;</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> <span class="fu">palette</span><span class="op">(</span>t<span class="op">);</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Removed region</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.2</span><span class="op">);</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    fragColor <span class="op">=</span> <span class="dt">vec4</span><span class="op">(</span>color<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The Sierpinski triangle should now render with mathematically correct reflections!</p>
<hr>
</section>
</section>
<section id="sierpinski-carpet" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="sierpinski-carpet"><span class="header-section-number">1.4</span> Sierpinski Carpet</h2>
<section id="mathematical-description-1" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-description-1">Mathematical Description</h3>
<p>The Sierpinski carpet is the square analog: 1. Start with a square 2. Divide into a 3×3 grid of sub-squares 3. Remove the central sub-square 4. Recursively repeat on each remaining sub-square</p>
<p><strong>Note:</strong> Unlike the triangle, the carpet uses axis-aligned divisions, so the implementation is both simpler AND mathematically exact—no approximations needed!</p>
</section>
<section id="the-algorithm" class="level3">
<h3 class="anchored" data-anchor-id="the-algorithm">The Algorithm</h3>
<p>Much simpler than the triangle because we can use axis-aligned operations!</p>
<p>At each iteration: 1. <strong>Fold</strong> using <code>abs()</code> to create 4-fold symmetry (all quadrants map to first quadrant) 2. <strong>Scale</strong> by factor of 3 3. <strong>Check</strong> if we’re in the removed middle region</p>
</section>
<section id="implementation" class="level3">
<h3 class="anchored" data-anchor-id="implementation">Implementation</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> <span class="fu">sierpinskiCarpet</span><span class="op">(</span><span class="dt">vec2</span> p<span class="op">,</span> <span class="dt">int</span> iterations<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> iterations<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Fold to first quadrant (creates 4-fold symmetry)</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="bu">abs</span><span class="op">(</span>p<span class="op">);</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Scale by 3 and recenter</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> p <span class="op">*</span> <span class="fl">3.0</span> <span class="op">-</span> <span class="dt">vec2</span><span class="op">(</span><span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// After this transformation, the "removed" region is</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// approximately where both |p.x| &lt; 1 and |p.y| &lt; 1</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check if in removed region</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// After n iterations, if we're in the central square, we're removed</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="op">(</span><span class="bu">abs</span><span class="op">(</span>p<span class="op">.</span><span class="fu">x</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1.0</span> <span class="op">&amp;&amp;</span> <span class="bu">abs</span><span class="op">(</span>p<span class="op">.</span><span class="fu">y</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="more-robust-version" class="level3">
<h3 class="anchored" data-anchor-id="more-robust-version">More Robust Version</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> <span class="fu">carpetFold</span><span class="op">(</span><span class="dt">vec2</span> p<span class="op">,</span> <span class="dt">int</span> iterations<span class="op">,</span> <span class="dt">out</span> <span class="dt">bool</span> inFractal<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    inFractal <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> iterations<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Fold to first quadrant</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="bu">abs</span><span class="op">(</span>p<span class="op">);</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Check if in middle third in both dimensions</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// In normalized [0,1] space, middle third is [1/3, 2/3]</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">vec2</span> normalizedP <span class="op">=</span> <span class="bu">fract</span><span class="op">(</span>p<span class="op">);</span>  <span class="co">// Get fractional part</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">bool</span> inMiddleX <span class="op">=</span> <span class="op">(</span>normalizedP<span class="op">.</span><span class="fu">x</span> <span class="op">&gt;</span> <span class="fl">0.33</span> <span class="op">&amp;&amp;</span> normalizedP<span class="op">.</span><span class="fu">x</span> <span class="op">&lt;</span> <span class="fl">0.67</span><span class="op">);</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">bool</span> inMiddleY <span class="op">=</span> <span class="op">(</span>normalizedP<span class="op">.</span><span class="fu">y</span> <span class="op">&gt;</span> <span class="fl">0.33</span> <span class="op">&amp;&amp;</span> normalizedP<span class="op">.</span><span class="fu">y</span> <span class="op">&lt;</span> <span class="fl">0.67</span><span class="op">);</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span>inMiddleX <span class="op">&amp;&amp;</span> inMiddleY<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>            inFractal <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Scale by 3</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> p <span class="op">*</span> <span class="fl">3.0</span><span class="op">;</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> p<span class="op">;</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="clean-implementation" class="level3">
<h3 class="anchored" data-anchor-id="clean-implementation">Clean Implementation</h3>
<p>A cleaner approach using the subdivision pattern:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> <span class="fu">inSierpinskiCarpet</span><span class="op">(</span><span class="dt">vec2</span> p<span class="op">,</span> <span class="dt">int</span> iterations<span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Normalize to [0, 1]</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> p <span class="op">*</span> <span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> iterations<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Which cell of 3×3 grid are we in?</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">vec2</span> cell <span class="op">=</span> <span class="bu">floor</span><span class="op">(</span>p <span class="op">*</span> <span class="fl">3.0</span><span class="op">);</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Middle cell (1,1) is removed</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span>cell<span class="op">.</span><span class="fu">x</span> <span class="op">==</span> <span class="fl">1.0</span> <span class="op">&amp;&amp;</span> cell<span class="op">.</span><span class="fu">y</span> <span class="op">==</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">false</span><span class="op">;</span>  <span class="co">// In removed region</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Zoom into current cell</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="bu">fract</span><span class="op">(</span>p <span class="op">*</span> <span class="fl">3.0</span><span class="op">);</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="kw">true</span><span class="op">;</span>  <span class="co">// In fractal</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="visualization-1" class="level3">
<h3 class="anchored" data-anchor-id="visualization-1">Visualization</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">mainImage</span><span class="op">(</span><span class="dt">out</span> <span class="dt">vec4</span> fragColor<span class="op">,</span> <span class="dt">in</span> <span class="dt">vec2</span> fragCoord<span class="op">)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> uv <span class="op">=</span> fragCoord <span class="op">/</span> iResolution<span class="op">.</span><span class="fu">xy</span><span class="op">;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    uv <span class="op">=</span> <span class="op">(</span>uv <span class="op">-</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2.0</span><span class="op">;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    uv<span class="op">.</span><span class="fu">x</span> <span class="op">*=</span> iResolution<span class="op">.</span><span class="fu">x</span> <span class="op">/</span> iResolution<span class="op">.</span><span class="fu">y</span><span class="op">;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> inFractal <span class="op">=</span> <span class="fu">inSierpinskiCarpet</span><span class="op">(</span>uv<span class="op">,</span> <span class="dv">6</span><span class="op">);</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec3</span> color <span class="op">=</span> inFractal <span class="op">?</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">1.0</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">,</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">:</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.2</span><span class="op">);</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    fragColor <span class="op">=</span> <span class="dt">vec4</span><span class="op">(</span>color<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="menger-sponge-3d-extension" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="menger-sponge-3d-extension"><span class="header-section-number">1.5</span> Menger Sponge (3D Extension)</h2>
<section id="mathematical-description-2" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-description-2">Mathematical Description</h3>
<p>The Menger sponge is the 3D analog of the Sierpinski carpet: 1. Start with a cube 2. Divide into a 3×3×3 grid of sub-cubes (27 total) 3. Remove the central sub-cube and the 6 face-centered sub-cubes (7 removed, 20 remain) 4. Recursively repeat on each remaining sub-cube</p>
<p><strong>Note:</strong> Like the carpet, the sponge uses axis-aligned divisions, giving us an exact, mathematically precise implementation.</p>
</section>
<section id="the-algorithm-1" class="level3">
<h3 class="anchored" data-anchor-id="the-algorithm-1">The Algorithm</h3>
<p>Same pattern as the carpet, but in 3D!</p>
<ol type="1">
<li><strong>Fold</strong> using <code>abs(p)</code> to create octahedral symmetry</li>
<li><strong>Scale</strong> by factor of 3</li>
<li><strong>Check</strong> if we’re in a removed region (middle cross pattern)</li>
</ol>
</section>
<section id="implementation-1" class="level3">
<h3 class="anchored" data-anchor-id="implementation-1">Implementation</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> <span class="fu">inMengerSponge</span><span class="op">(</span><span class="dt">vec3</span> p<span class="op">,</span> <span class="dt">int</span> iterations<span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> iterations<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Fold to first octant</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="bu">abs</span><span class="op">(</span>p<span class="op">);</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Which cell of 3×3×3 grid?</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">vec3</span> cell <span class="op">=</span> <span class="bu">floor</span><span class="op">(</span>p <span class="op">*</span> <span class="fl">3.0</span><span class="op">);</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Removed regions: center cube and face centers</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Center: (1,1,1)</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Face centers: (1,1,0), (1,1,2), (1,0,1), (1,2,1), (0,1,1), (2,1,1)</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Pattern: at least 2 coordinates equal to 1</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> ones <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span>cell<span class="op">.</span><span class="fu">x</span> <span class="op">==</span> <span class="fl">1.0</span><span class="op">)</span> ones <span class="op">+=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span>cell<span class="op">.</span><span class="fu">y</span> <span class="op">==</span> <span class="fl">1.0</span><span class="op">)</span> ones <span class="op">+=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span>cell<span class="op">.</span><span class="fu">z</span> <span class="op">==</span> <span class="fl">1.0</span><span class="op">)</span> ones <span class="op">+=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span>ones <span class="op">&gt;=</span> <span class="fl">2.0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">false</span><span class="op">;</span>  <span class="co">// Removed region</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Zoom into cell</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="bu">fract</span><span class="op">(</span>p <span class="op">*</span> <span class="fl">3.0</span><span class="op">);</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="alternative-using-sdf-approach" class="level3">
<h3 class="anchored" data-anchor-id="alternative-using-sdf-approach">Alternative: Using SDF Approach</h3>
<p>We can also implement the Menger sponge as a signed distance function for use with Day 4’s raymarching:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> <span class="fu">sdBox</span><span class="op">(</span><span class="dt">vec3</span> p<span class="op">,</span> <span class="dt">vec3</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec3</span> q <span class="op">=</span> <span class="bu">abs</span><span class="op">(</span>p<span class="op">)</span> <span class="op">-</span> b<span class="op">;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="bu">length</span><span class="op">(</span><span class="bu">max</span><span class="op">(</span>q<span class="op">,</span> <span class="fl">0.0</span><span class="op">))</span> <span class="op">+</span> <span class="bu">min</span><span class="op">(</span><span class="bu">max</span><span class="op">(</span>q<span class="op">.</span><span class="fu">x</span><span class="op">,</span> <span class="bu">max</span><span class="op">(</span>q<span class="op">.</span><span class="fu">y</span><span class="op">,</span> q<span class="op">.</span><span class="fu">z</span><span class="op">)),</span> <span class="fl">0.0</span><span class="op">);</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> <span class="fu">sdMengerSponge</span><span class="op">(</span><span class="dt">vec3</span> p<span class="op">,</span> <span class="dt">int</span> iterations<span class="op">)</span> <span class="op">{</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> d <span class="op">=</span> <span class="fu">sdBox</span><span class="op">(</span>p<span class="op">,</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">1.0</span><span class="op">));</span>  <span class="co">// Start with unit cube</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> scale <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> iterations<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Fold to first octant</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">vec3</span> a <span class="op">=</span> <span class="bu">mod</span><span class="op">(</span>p <span class="op">*</span> scale<span class="op">,</span> <span class="fl">2.0</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        scale <span class="op">*=</span> <span class="fl">3.0</span><span class="op">;</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">vec3</span> r <span class="op">=</span> <span class="bu">abs</span><span class="op">(</span><span class="fl">1.0</span> <span class="op">-</span> <span class="fl">3.0</span> <span class="op">*</span> <span class="bu">abs</span><span class="op">(</span>a<span class="op">));</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Distance to cross (removed region)</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> da <span class="op">=</span> <span class="bu">max</span><span class="op">(</span>r<span class="op">.</span><span class="fu">x</span><span class="op">,</span> r<span class="op">.</span><span class="fu">y</span><span class="op">);</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> db <span class="op">=</span> <span class="bu">max</span><span class="op">(</span>r<span class="op">.</span><span class="fu">y</span><span class="op">,</span> r<span class="op">.</span><span class="fu">z</span><span class="op">);</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> dc <span class="op">=</span> <span class="bu">max</span><span class="op">(</span>r<span class="op">.</span><span class="fu">z</span><span class="op">,</span> r<span class="op">.</span><span class="fu">x</span><span class="op">);</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> c <span class="op">=</span> <span class="op">(</span><span class="bu">min</span><span class="op">(</span>da<span class="op">,</span> <span class="bu">min</span><span class="op">(</span>db<span class="op">,</span> dc<span class="op">))</span> <span class="op">-</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">/</span> scale<span class="op">;</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>        d <span class="op">=</span> <span class="bu">max</span><span class="op">(</span>d<span class="op">,</span> c<span class="op">);</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> d<span class="op">;</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="rendering-with-raymarching" class="level3">
<h3 class="anchored" data-anchor-id="rendering-with-raymarching">Rendering with Raymarching</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">mainImage</span><span class="op">(</span><span class="dt">out</span> <span class="dt">vec4</span> fragColor<span class="op">,</span> <span class="dt">in</span> <span class="dt">vec2</span> fragCoord<span class="op">)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Setup ray (using Day 4 techniques)</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    Ray ray <span class="op">=</span> <span class="fu">getRay</span><span class="op">(</span>fragCoord<span class="op">,</span> iResolution<span class="op">.</span><span class="fu">xy</span><span class="op">,</span> <span class="fl">45.0</span><span class="op">);</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Raymarch</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> t <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">100</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">vec3</span> pos <span class="op">=</span> ray<span class="op">.</span><span class="fu">origin</span> <span class="op">+</span> t <span class="op">*</span> ray<span class="op">.</span><span class="fu">direction</span><span class="op">;</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> d <span class="op">=</span> <span class="fu">sdMengerSponge</span><span class="op">(</span>pos<span class="op">,</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span><span class="bu">abs</span><span class="op">(</span>d<span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.001</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Hit!</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>            <span class="dt">vec3</span> normal <span class="op">=</span> <span class="fu">estimateNormal</span><span class="op">(</span>pos<span class="op">);</span>  <span class="co">// Day 4 technique</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>            <span class="dt">vec3</span> lightDir <span class="op">=</span> <span class="bu">normalize</span><span class="op">(</span><span class="dt">vec3</span><span class="op">(</span><span class="fl">1.0</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">));</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>            <span class="dt">float</span> diffuse <span class="op">=</span> <span class="bu">max</span><span class="op">(</span><span class="fl">0.0</span><span class="op">,</span> <span class="bu">dot</span><span class="op">(</span>normal<span class="op">,</span> lightDir<span class="op">));</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>            <span class="dt">vec3</span> color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">1.0</span><span class="op">,</span> <span class="fl">0.8</span><span class="op">,</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">*</span> diffuse <span class="op">+</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.1</span><span class="op">);</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>            fragColor <span class="op">=</span> <span class="dt">vec4</span><span class="op">(</span>color<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span><span class="op">;</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>        t <span class="op">+=</span> d<span class="op">;</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span>t <span class="op">&gt;</span> <span class="fl">100.0</span><span class="op">)</span> <span class="kw">break</span><span class="op">;</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Miss</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    fragColor <span class="op">=</span> <span class="dt">vec4</span><span class="op">(</span><span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.2</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="general-principles-of-folding-fractals" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="general-principles-of-folding-fractals"><span class="header-section-number">1.6</span> General Principles of Folding Fractals</h2>
<section id="key-ingredients" class="level3">
<h3 class="anchored" data-anchor-id="key-ingredients">Key Ingredients</h3>
<ol type="1">
<li><strong>Symmetry operations</strong>:
<ul>
<li><code>abs()</code> for axis-aligned symmetry</li>
<li>Reflections for arbitrary symmetry</li>
</ul></li>
<li><strong>Scaling factor</strong>:
<ul>
<li>Factor of 2: Sierpinski triangle</li>
<li>Factor of 3: Sierpinski carpet, Menger sponge</li>
<li>General factor <span class="math inline">\(s\)</span>: determines fractal dimension</li>
</ul></li>
<li><strong>Removal pattern</strong>:
<ul>
<li>Which regions get removed at each level</li>
<li>Defines the fractal’s structure</li>
</ul></li>
<li><strong>Iteration</strong>:
<ul>
<li>More iterations = more detail</li>
<li>Computational cost grows linearly</li>
<li>Visual complexity grows exponentially</li>
</ul></li>
</ol>
</section>
<section id="fractal-dimension" class="level3">
<h3 class="anchored" data-anchor-id="fractal-dimension">Fractal Dimension</h3>
<p>The fractal dimension <span class="math inline">\(D\)</span> can be computed from the scaling factor <span class="math inline">\(s\)</span> and the number of remaining pieces <span class="math inline">\(N\)</span>:</p>
<p><span class="math display">\[D = \frac{\log N}{\log s}\]</span></p>
<p><strong>Examples:</strong> - <strong>Sierpinski triangle</strong>: <span class="math inline">\(N = 3\)</span> pieces, scale factor <span class="math inline">\(s = 2\)</span> <span class="math display">\[D = \frac{\log 3}{\log 2} \approx 1.585\]</span></p>
<ul>
<li><p><strong>Sierpinski carpet</strong>: <span class="math inline">\(N = 8\)</span> pieces, scale factor <span class="math inline">\(s = 3\)</span> <span class="math display">\[D = \frac{\log 8}{\log 3} \approx 1.893\]</span></p></li>
<li><p><strong>Menger sponge</strong>: <span class="math inline">\(N = 20\)</span> pieces, scale factor <span class="math inline">\(s = 3\)</span> <span class="math display">\[D = \frac{\log 20}{\log 3} \approx 2.727\]</span></p></li>
</ul>
<p>The fractal dimension is between the topological dimension and the embedding dimension, reflecting the fractal’s “in-between” nature!</p>
<hr>
</section>
</section>
<section id="coloring-strategies" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="coloring-strategies"><span class="header-section-number">1.7</span> Coloring Strategies</h2>
<section id="by-iteration-depth" class="level3">
<h3 class="anchored" data-anchor-id="by-iteration-depth">By Iteration Depth</h3>
<p>Track which iteration first identifies a point as removed:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> firstRemovedIter <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> iterations<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// [Folding and scaling]</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span><span class="op">([</span><span class="dt">in</span> removed region<span class="op">]</span> <span class="op">&amp;&amp;</span> firstRemovedIter <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>        firstRemovedIter <span class="op">=</span> i<span class="op">;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> t <span class="op">=</span> <span class="dt">float</span><span class="op">(</span>firstRemovedIter<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span>iterations<span class="op">);</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="dt">vec3</span> color <span class="op">=</span> <span class="fu">palette</span><span class="op">(</span>t<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="by-distance-after-folding" class="level3">
<h3 class="anchored" data-anchor-id="by-distance-after-folding">By Distance After Folding</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec2</span> p_final <span class="op">=</span> <span class="op">[</span>after <span class="bu">all</span> folding<span class="op">];</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> d <span class="op">=</span> <span class="bu">length</span><span class="op">(</span>p_final<span class="op">);</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="dt">vec3</span> color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span>d <span class="op">*</span> <span class="fl">0.5</span><span class="op">);</span>  <span class="co">// Grayscale by distance</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="by-cell-position" class="level3">
<h3 class="anchored" data-anchor-id="by-cell-position">By Cell Position</h3>
<p>For grid-based fractals (carpet, sponge), color by which sub-cell the point lands in:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec3</span> cell <span class="op">=</span> <span class="bu">floor</span><span class="op">(</span>p <span class="op">*</span> <span class="fl">3.0</span><span class="op">);</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="dt">vec3</span> color <span class="op">=</span> cell <span class="op">/</span> <span class="fl">3.0</span><span class="op">;</span>  <span class="co">// RGB from cell coordinates</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="hybrid-distance-field-fractal" class="level3">
<h3 class="anchored" data-anchor-id="hybrid-distance-field-fractal">Hybrid: Distance Field + Fractal</h3>
<p>For 3D fractals, combine distance estimation with fractal membership:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> d <span class="op">=</span> <span class="fu">sdMengerSponge</span><span class="op">(</span>p<span class="op">,</span> iterations<span class="op">);</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="dt">vec3</span> color<span class="op">;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span><span class="op">(</span>d <span class="op">&lt;</span> <span class="fl">0.0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Inside sponge</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">1.0</span><span class="op">,</span> <span class="fl">0.8</span><span class="op">,</span> <span class="fl">0.6</span><span class="op">);</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Outside, but show distance</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1.0</span> <span class="op">+</span> d<span class="op">);</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="variations-and-experiments" class="level2" data-number="1.8">
<h2 data-number="1.8" class="anchored" data-anchor-id="variations-and-experiments"><span class="header-section-number">1.8</span> Variations and Experiments</h2>
<section id="different-folding-operations" class="level3">
<h3 class="anchored" data-anchor-id="different-folding-operations">Different Folding Operations</h3>
<p>Try different symmetry groups: - Hexagonal symmetry (6-fold) - Octahedral symmetry (for 3D) - Custom reflection patterns</p>
</section>
<section id="different-scale-factors" class="level3">
<h3 class="anchored" data-anchor-id="different-scale-factors">Different Scale Factors</h3>
<ul>
<li>Scale by 4: sparser fractal</li>
<li>Scale by 1.5: denser fractal</li>
<li>Non-integer scales: unusual structures</li>
</ul>
</section>
<section id="animated-parameters" class="level3">
<h3 class="anchored" data-anchor-id="animated-parameters">Animated Parameters</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> scale <span class="op">=</span> <span class="fl">2.0</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="bu">sin</span><span class="op">(</span>iTime<span class="op">);</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> p <span class="op">*</span> scale<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Watch the fractal morph as the scale factor changes!</p>
</section>
<section id="color-by-orbit" class="level3">
<h3 class="anchored" data-anchor-id="color-by-orbit">Color by Orbit</h3>
<p>Track the “orbit” of the point through the folding process:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> orbit <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> iterations<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    orbit <span class="op">+=</span> <span class="bu">length</span><span class="op">(</span>p<span class="op">);</span>  <span class="co">// Accumulate total distance traveled</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// [Folding operations]</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="dt">vec3</span> color <span class="op">=</span> <span class="fu">palette</span><span class="op">(</span>orbit <span class="op">/</span> <span class="fl">10.0</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="d-variations" class="level3">
<h3 class="anchored" data-anchor-id="d-variations">3D Variations</h3>
<ul>
<li><strong>Cross-Menger</strong>: Different removal pattern (only center)</li>
<li><strong>Jerusalem Cube</strong>: Variation with different symmetry</li>
<li><strong>Hybrid fractals</strong>: Combine different removal patterns at different scales</li>
</ul>
<hr>
</section>
</section>
<section id="connection-to-course-topics" class="level2" data-number="1.9">
<h2 data-number="1.9" class="anchored" data-anchor-id="connection-to-course-topics"><span class="header-section-number">1.9</span> Connection to Course Topics</h2>
<section id="day-2-iteration-creates-fractals" class="level3">
<h3 class="anchored" data-anchor-id="day-2-iteration-creates-fractals">Day 2: Iteration Creates Fractals</h3>
<p>Both folding fractals and the Mandelbrot set/Apollonian gasket share the principle: <strong>simple operations iterated create complex structure</strong>.</p>
<ul>
<li><strong>Mandelbrot</strong>: <span class="math inline">\(z \to z^2 + c\)</span> (complex arithmetic iteration)</li>
<li><strong>Apollonian</strong>: Repeated circle inversions (geometric iteration)</li>
<li><strong>Sierpinski</strong>: Fold + scale (geometric iteration with scaling)</li>
</ul>
</section>
<section id="day-3-folding-without-scaling" class="level3">
<h3 class="anchored" data-anchor-id="day-3-folding-without-scaling">Day 3: Folding Without Scaling</h3>
<p>Euclidean and hyperbolic tilings use folding <strong>without</strong> scaling: - Reflection brings points into fundamental domain - No scaling → fills space with copies - With scaling → creates fractal structure</p>
</section>
<section id="day-4-3d-rendering" class="level3">
<h3 class="anchored" data-anchor-id="day-4-3d-rendering">Day 4: 3D Rendering</h3>
<p>The Menger sponge naturally extends to 3D: - Can be rendered as SDF (raymarching) - Can be rendered as boolean test (simple ray casting) - Demonstrates 3D coordinate folding</p>
<hr>
</section>
</section>
<section id="exercises" class="level2" data-number="1.10">
<h2 data-number="1.10" class="anchored" data-anchor-id="exercises"><span class="header-section-number">1.10</span> Exercises</h2>
<section id="exercise-1-hexagonal-sierpinski" class="level3">
<h3 class="anchored" data-anchor-id="exercise-1-hexagonal-sierpinski">Exercise 1: Hexagonal Sierpinski</h3>
<p>Create a Sierpinski gasket based on a hexagon instead of a triangle: - Use 6-fold symmetry - Scale by factor of 3 - Remove appropriate regions</p>
</section>
<section id="exercise-2-animate-the-scale-factor" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2-animate-the-scale-factor">Exercise 2: Animate the Scale Factor</h3>
<p>Modify the Sierpinski carpet to have a time-varying scale factor:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> scale <span class="op">=</span> <span class="fl">3.0</span> <span class="op">+</span> <span class="bu">sin</span><span class="op">(</span>iTime<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Watch how the fractal structure changes!</p>
</section>
<section id="exercise-3-3d-cross" class="level3">
<h3 class="anchored" data-anchor-id="exercise-3-3d-cross">Exercise 3: 3D Cross</h3>
<p>Implement a 3D fractal using only cross-shaped removal (remove only the center cube, not the face centers). Compare to the standard Menger sponge.</p>
</section>
<section id="exercise-4-hybrid-fractal" class="level3">
<h3 class="anchored" data-anchor-id="exercise-4-hybrid-fractal">Exercise 4: Hybrid Fractal</h3>
<p>Combine two different fractals: - First 3 iterations: Sierpinski triangle folding - Next 3 iterations: Sierpinski carpet folding - Observe the unusual resulting structure</p>
</section>
<section id="exercise-5-distance-colored-sponge" class="level3">
<h3 class="anchored" data-anchor-id="exercise-5-distance-colored-sponge">Exercise 5: Distance-Colored Sponge</h3>
<p>Render the Menger sponge with colors based on distance from the surface: - Use <code>sdMengerSponge</code> as a distance field - Color by distance for points outside - Different color for points inside</p>
<hr>
</section>
</section>
<section id="further-reading" class="level2" data-number="1.11">
<h2 data-number="1.11" class="anchored" data-anchor-id="further-reading"><span class="header-section-number">1.11</span> Further Reading</h2>
<section id="mathematical-theory" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-theory">Mathematical Theory</h3>
<ul>
<li>Hausdorff dimension and box-counting dimension</li>
<li>Iterated function systems (IFS)</li>
<li>Self-similar sets and scaling symmetries</li>
</ul>
</section>
<section id="computational-techniques" class="level3">
<h3 class="anchored" data-anchor-id="computational-techniques">Computational Techniques</h3>
<ul>
<li>Escape-time algorithms</li>
<li>Distance estimation for fractals</li>
<li>Efficient rendering of fractal geometry</li>
</ul>
</section>
<section id="applications" class="level3">
<h3 class="anchored" data-anchor-id="applications">Applications</h3>
<ul>
<li>Procedural generation in games/graphics</li>
<li>Antenna design (fractal antennas)</li>
<li>Modeling natural phenomena (coastlines, plants)</li>
<li>Compression algorithms</li>
</ul>
<hr>
</section>
</section>
<section id="summary" class="level2" data-number="1.12">
<h2 data-number="1.12" class="anchored" data-anchor-id="summary"><span class="header-section-number">1.12</span> Summary</h2>
<p>Folding fractals demonstrate: 1. <strong>Iteration + scaling</strong> creates self-similar structure 2. <strong>Simple operations</strong> produce complex results 3. <strong>GPU parallelism</strong> enables real-time fractal rendering 4. <strong>Fractals connect</strong> to many course topics (iteration, symmetry, 3D)</p>
<p>The techniques here—folding, scaling, iteration—are fundamental to both mathematical fractals and computer graphics. These methods extend naturally from 2D to 3D, and from static to animated, making them powerful tools for mathematical visualization.</p>
<p><strong>Key takeaway</strong>: Fractals aren’t just beautiful—they’re computationally accessible. A few dozen lines of shader code can generate infinite complexity!</p>
<hr>
</section>
<section id="complete-example-animated-sierpinski-carpet" class="level2" data-number="1.13">
<h2 data-number="1.13" class="anchored" data-anchor-id="complete-example-animated-sierpinski-carpet"><span class="header-section-number">1.13</span> Complete Example: Animated Sierpinski Carpet</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="sourceCode glsl code-with-copy"><code class="sourceCode glsl"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="dt">vec3</span> <span class="fu">palette</span><span class="op">(</span><span class="dt">float</span> t<span class="op">)</span> <span class="op">{</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec3</span> a <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.5</span><span class="op">);</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec3</span> b <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.5</span><span class="op">);</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec3</span> c <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec3</span> d <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.33</span><span class="op">,</span> <span class="fl">0.67</span><span class="op">);</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> a <span class="op">+</span> b <span class="op">*</span> <span class="bu">cos</span><span class="op">(</span><span class="fl">6.28318</span> <span class="op">*</span> <span class="op">(</span>c <span class="op">*</span> t <span class="op">+</span> d<span class="op">));</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> <span class="fu">inCarpet</span><span class="op">(</span><span class="dt">vec2</span> p<span class="op">,</span> <span class="dt">int</span> iterations<span class="op">)</span> <span class="op">{</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> p <span class="op">*</span> <span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> iterations<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">vec2</span> cell <span class="op">=</span> <span class="bu">floor</span><span class="op">(</span>p <span class="op">*</span> <span class="fl">3.0</span><span class="op">);</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span>cell<span class="op">.</span><span class="fu">x</span> <span class="op">==</span> <span class="fl">1.0</span> <span class="op">&amp;&amp;</span> cell<span class="op">.</span><span class="fu">y</span> <span class="op">==</span> <span class="fl">1.0</span><span class="op">)</span> <span class="kw">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="bu">fract</span><span class="op">(</span>p <span class="op">*</span> <span class="fl">3.0</span><span class="op">);</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">mainImage</span><span class="op">(</span><span class="dt">out</span> <span class="dt">vec4</span> fragColor<span class="op">,</span> <span class="dt">in</span> <span class="dt">vec2</span> fragCoord<span class="op">)</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec2</span> uv <span class="op">=</span> fragCoord <span class="op">/</span> iResolution<span class="op">.</span><span class="fu">xy</span><span class="op">;</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    uv <span class="op">=</span> <span class="op">(</span>uv <span class="op">-</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2.0</span><span class="op">;</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>    uv<span class="op">.</span><span class="fu">x</span> <span class="op">*=</span> iResolution<span class="op">.</span><span class="fu">x</span> <span class="op">/</span> iResolution<span class="op">.</span><span class="fu">y</span><span class="op">;</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Zoom animation</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> zoom <span class="op">=</span> <span class="bu">exp</span><span class="op">(</span><span class="bu">sin</span><span class="op">(</span>iTime <span class="op">*</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2.0</span><span class="op">);</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>    uv <span class="op">*=</span> zoom<span class="op">;</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Rotation animation</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> angle <span class="op">=</span> iTime <span class="op">*</span> <span class="fl">0.2</span><span class="op">;</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> c <span class="op">=</span> <span class="bu">cos</span><span class="op">(</span>angle<span class="op">),</span> s <span class="op">=</span> <span class="bu">sin</span><span class="op">(</span>angle<span class="op">);</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>    uv <span class="op">=</span> <span class="dt">vec2</span><span class="op">(</span>c <span class="op">*</span> uv<span class="op">.</span><span class="fu">x</span> <span class="op">-</span> s <span class="op">*</span> uv<span class="op">.</span><span class="fu">y</span><span class="op">,</span> s <span class="op">*</span> uv<span class="op">.</span><span class="fu">x</span> <span class="op">+</span> c <span class="op">*</span> uv<span class="op">.</span><span class="fu">y</span><span class="op">);</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> iterations <span class="op">=</span> <span class="dv">6</span><span class="op">;</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> inFractal <span class="op">=</span> <span class="fu">inCarpet</span><span class="op">(</span>uv<span class="op">,</span> iterations<span class="op">);</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vec3</span> color<span class="op">;</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span><span class="op">(</span>inFractal<span class="op">)</span> <span class="op">{</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Color based on distance from center</span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> d <span class="op">=</span> <span class="bu">length</span><span class="op">(</span>uv<span class="op">);</span></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> <span class="fu">palette</span><span class="op">(</span>d <span class="op">*</span> <span class="fl">0.5</span> <span class="op">+</span> iTime <span class="op">*</span> <span class="fl">0.1</span><span class="op">);</span></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> <span class="dt">vec3</span><span class="op">(</span><span class="fl">0.05</span><span class="op">,</span> <span class="fl">0.05</span><span class="op">,</span> <span class="fl">0.1</span><span class="op">);</span></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>    fragColor <span class="op">=</span> <span class="dt">vec4</span><span class="op">(</span>color<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This creates a beautiful, animated Sierpinski carpet that zooms and rotates, with colors flowing through the fractal structure!</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>